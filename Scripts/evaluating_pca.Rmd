---
title: "Performing Cluster Analysis on TAD boundaries & Annotations"
author: "Spiro Stilianoudakis"
date: "March 14, 2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Loading Libraries

```{r}
library(GenomicRanges)
library(caret)
library(data.table)
library(gbm)
library(randomForest)
library(glmnet)
library(pROC)
library(plyr)
library(dplyr)
library(ggplot2)
library(DMwR)
library(gridExtra)
library(pROC)
library(ROCR)
#library(leaps)
library(cluster)
library(ggpubr)
library(scales)
library(GGally)
library(VennDiagram)
library(network)
library(sna)
library(gtable)
library(grid)
library(magrittr) 
library(DT)
library(tidyverse)
library(reshape)
library(ROSE)
library(lattice)
library(corrplot)
library(cluster)
library(RColorBrewer)
library(factoextra)
library(FactoMineR)
library(ggfortify)
library(fpc)
```

# Clustering Annotations

## GM12878

### 10kb

```{r}
pcadat_gm12878_10kb_count <- readRDS("Z:/TAD_data_analysis/GM12878/10kb/Ensemble/PCA/pcadat_gm12878_10kb_count.rds")
pcadat_gm12878_10kb_perc <- readRDS("Z:/TAD_data_analysis/GM12878/10kb/Ensemble/PCA/pcadat_gm12878_10kb_perc.rds")
pcadat_gm12878_10kb_dist <- readRDS("Z:/TAD_data_analysis/GM12878/10kb/Ensemble/PCA/pcadat_gm12878_10kb_dist.rds")

#performing log2 transformation on distances
pcadat_gm12878_10kb_dist <- apply(pcadat_gm12878_10kb_dist,2,function(x){log(x + 1, base=2)})

cleancolnames <- function(x){gsub(paste(c("`", 
                                          "_",
                                          #"-",
                                          #"Gm12878", 
                                          #"Haib", 
                                          #"Sydh",
                                          #"Uta",
                                          #"Uw",
                                          #"Broad",
                                          #"Uchicago",
                                          "dist",
                                          "count",
                                          "perc"), collapse = "|"),"", 
                                  colnames(x))}

colnames(pcadat_gm12878_10kb_count) <- cleancolnames(pcadat_gm12878_10kb_count)
colnames(pcadat_gm12878_10kb_perc) <- cleancolnames(pcadat_gm12878_10kb_perc)
colnames(pcadat_gm12878_10kb_dist) <- cleancolnames(pcadat_gm12878_10kb_dist)

pcadat_gm12878_10kb_count <- t(pcadat_gm12878_10kb_count)
pcadat_gm12878_10kb_perc <- t(pcadat_gm12878_10kb_perc)
pcadat_gm12878_10kb_dist <- t(pcadat_gm12878_10kb_dist)

#pcadat_gm12878_10kb_count <- data.frame(pcadat_gm12878_10kb_count)
#pcadat_gm12878_10kb_perc <- data.frame(pcadat_gm12878_10kb_perc)
#pcadat_gm12878_10kb_dist <- data.frame(pcadat_gm12878_10kb_dist)

#pcadat_gm12878_10kb_count$Type <- "Counts"
#pcadat_gm12878_10kb_perc$Type <- "Percent"
#pcadat_gm12878_10kb_dist$Type <- "Distance"

```

#### Chromatin States

```{r}
chromstatevars <- gsub(".bed","",list.files("Z:/TAD_data_analysis/annotations/BroadHMM"))
```

##### Overlap Counts

```{r}
pcadat_gm12878_10kb_count_chromstates <- pcadat_gm12878_10kb_count[which(rownames(pcadat_gm12878_10kb_count) %in% chromstatevars),]

##with loadings
autoplot(prcomp(pcadat_gm12878_10kb_count_chromstates),
         loadings = TRUE,
         label = TRUE, 
         label.size = 3,
         label.repel=T) +
  theme_bw()
##without loadings
autoplot(prcomp(pcadat_gm12878_10kb_count_chromstates),
         #loadings = TRUE,
         label = TRUE, 
         label.size = 3,
         label.repel=T) +
  theme_bw()
##kmeans clustering algorithm to group annotations
wss <- (nrow(pcadat_gm12878_10kb_count_chromstates)-1)*sum(apply(pcadat_gm12878_10kb_count_chromstates,2,var))
  for (i in 2:5) wss[i] <- sum(kmeans(pcadat_gm12878_10kb_count_chromstates,
                                       centers=i, nstart=25, iter.max = 1000)$withinss)
plot(1:5, wss, type="b", xlab="Number of Clusters",
     ylab="Within groups sum of squares")

set.seed(1)
autoplot(kmeans(pcadat_gm12878_10kb_count_chromstates, 3, nstart=25, iter.max = 1000),
         data=pcadat_gm12878_10kb_count_chromstates,
         #frame = TRUE,
         #frame.type = 'norm',
         label = TRUE, 
         label.size = 3, 
         label.repel=T,
         label.show.legend = FALSE) + 
  #guides(fill=FALSE) +
  theme_bw()

```

##### Overlap Percents

```{r}
pcadat_gm12878_10kb_perc_chromstates <- pcadat_gm12878_10kb_perc[which(rownames(pcadat_gm12878_10kb_perc) %in% chromstatevars),]

##with loadings
autoplot(prcomp(pcadat_gm12878_10kb_perc_chromstates),
         loadings = TRUE,
         label = TRUE, 
         label.size = 3,
         label.repel=T) +
  theme_bw()
##without loadings
autoplot(prcomp(pcadat_gm12878_10kb_perc_chromstates),
         #loadings = TRUE,
         label = TRUE, 
         label.size = 3,
         label.repel=T) +
  theme_bw()
##kmeans clustering algorithm to group annotations
wss <- (nrow(pcadat_gm12878_10kb_perc_chromstates)-1)*sum(apply(pcadat_gm12878_10kb_perc_chromstates,2,var))
  for (i in 2:5) wss[i] <- sum(kmeans(pcadat_gm12878_10kb_perc_chromstates,
                                       centers=i, nstart=25, iter.max = 1000)$withinss)
plot(1:5, wss, type="b", xlab="Number of Clusters",
     ylab="Within groups sum of squares")

set.seed(1)
autoplot(kmeans(pcadat_gm12878_10kb_perc_chromstates, 3, nstart=25, iter.max = 1000),
         data=pcadat_gm12878_10kb_perc_chromstates,
         #frame = TRUE,
         #frame.type = 'norm',
         label = TRUE, 
         label.size = 3, 
         label.repel=T,
         label.show.legend = FALSE) + 
  #guides(fill=FALSE) +
  theme_bw()

```

#####Distance

```{r}
pcadat_gm12878_10kb_dist_chromstates <- pcadat_gm12878_10kb_dist[which(rownames(pcadat_gm12878_10kb_dist) %in% chromstatevars),]

##with loadings
autoplot(prcomp(pcadat_gm12878_10kb_dist_chromstates),
         loadings = TRUE,
         label = TRUE, 
         label.size = 3,
         label.repel=T) +
  theme_bw()
##without loadings
autoplot(prcomp(pcadat_gm12878_10kb_dist_chromstates),
         #loadings = TRUE,
         label = TRUE, 
         label.size = 3,
         label.repel=T) +
  theme_bw()
##kmeans clustering algorithm to group annotations
wss <- (nrow(pcadat_gm12878_10kb_dist_chromstates)-1)*sum(apply(pcadat_gm12878_10kb_dist_chromstates,2,var))
  for (i in 2:5) wss[i] <- sum(kmeans(pcadat_gm12878_10kb_dist_chromstates,
                                       centers=i, nstart=25, iter.max = 1000)$withinss)
plot(1:5, wss, type="b", xlab="Number of Clusters",
     ylab="Within groups sum of squares")

set.seed(1)
autoplot(kmeans(pcadat_gm12878_10kb_dist_chromstates, 4, nstart=25, iter.max = 1000),
         data=pcadat_gm12878_10kb_dist_chromstates,
         #frame = TRUE,
         #frame.type = 'norm',
         label = TRUE, 
         label.size = 3, 
         label.repel=T,
         label.show.legend = FALSE) + 
  #guides(fill=FALSE) +
  theme_bw()

```

#### Histone Modifications

```{r}
histonevars <- gsub(".bed","",list.files("Z:/TAD_data_analysis/annotations/HistoneModifications"))
```

##### Overlap Counts

```{r}
pcadat_gm12878_10kb_count_histones <- pcadat_gm12878_10kb_count[which(rownames(pcadat_gm12878_10kb_count) %in% histonevars),]

##with loadings
autoplot(prcomp(pcadat_gm12878_10kb_count_histones),
         loadings = TRUE,
         label = TRUE, 
         label.size = 3,
         label.repel=T) +
  theme_bw()
##without loadings
autoplot(prcomp(pcadat_gm12878_10kb_count_histones),
         #loadings = TRUE,
         label = TRUE, 
         label.size = 3,
         label.repel=T) +
  theme_bw()
##kmeans clustering algorithm to group annotations
wss <- (nrow(pcadat_gm12878_10kb_count_histones)-1)*sum(apply(pcadat_gm12878_10kb_count_histones,2,var))
  for (i in 2:5) wss[i] <- sum(kmeans(pcadat_gm12878_10kb_count_histones,
                                       centers=i, nstart=25, iter.max = 1000)$withinss)
plot(1:5, wss, type="b", xlab="Number of Clusters",
     ylab="Within groups sum of squares")

set.seed(1)
autoplot(kmeans(pcadat_gm12878_10kb_count_histones, 3, nstart=25, iter.max = 1000),
         data=pcadat_gm12878_10kb_count_histones,
         #frame = TRUE,
         #frame.type = 'norm',
         label = TRUE, 
         label.size = 3, 
         label.repel=T,
         label.show.legend = FALSE) + 
  #guides(fill=FALSE) +
  theme_bw()

```

##### Overlap Percents

```{r}
pcadat_gm12878_10kb_perc_histones <- pcadat_gm12878_10kb_perc[which(rownames(pcadat_gm12878_10kb_perc) %in% histonevars),]

##with loadings
autoplot(prcomp(pcadat_gm12878_10kb_perc_histones),
         loadings = TRUE,
         label = TRUE, 
         label.size = 3,
         label.repel=T) +
  theme_bw()
##without loadings
autoplot(prcomp(pcadat_gm12878_10kb_perc_histones),
         #loadings = TRUE,
         label = TRUE, 
         label.size = 3,
         label.repel=T) +
  theme_bw()
##kmeans clustering algorithm to group annotations
wss <- (nrow(pcadat_gm12878_10kb_perc_histones)-1)*sum(apply(pcadat_gm12878_10kb_perc_histones,2,var))
  for (i in 2:5) wss[i] <- sum(kmeans(pcadat_gm12878_10kb_perc_histones,
                                       centers=i, nstart=25, iter.max = 1000)$withinss)
plot(1:5, wss, type="b", xlab="Number of Clusters",
     ylab="Within groups sum of squares")

set.seed(1)
autoplot(kmeans(pcadat_gm12878_10kb_perc_histones, 4, nstart=25, iter.max = 1000),
         data=pcadat_gm12878_10kb_perc_histones,
         #frame = TRUE,
         #frame.type = 'norm',
         label = TRUE, 
         label.size = 3, 
         label.repel=T,
         label.show.legend = FALSE) + 
  #guides(fill=FALSE) +
  theme_bw()

```

#####Distance

```{r}
pcadat_gm12878_10kb_dist_histones <- pcadat_gm12878_10kb_dist[which(rownames(pcadat_gm12878_10kb_dist) %in% histonevars),]

##with loadings
autoplot(prcomp(pcadat_gm12878_10kb_dist_histones),
         loadings = TRUE,
         label = TRUE, 
         label.size = 3,
         label.repel=T) +
  theme_bw()
##without loadings
autoplot(prcomp(pcadat_gm12878_10kb_dist_histones),
         #loadings = TRUE,
         label = TRUE, 
         label.size = 3,
         label.repel=T) +
  theme_bw()
##kmeans clustering algorithm to group annotations
wss <- (nrow(pcadat_gm12878_10kb_dist_histones)-1)*sum(apply(pcadat_gm12878_10kb_dist_histones,2,var))
  for (i in 2:5) wss[i] <- sum(kmeans(pcadat_gm12878_10kb_dist_histones,
                                       centers=i, nstart=25, iter.max = 1000)$withinss)
plot(1:5, wss, type="b", xlab="Number of Clusters",
     ylab="Within groups sum of squares")

set.seed(1)
autoplot(kmeans(pcadat_gm12878_10kb_dist_histones, 4, nstart=25, iter.max = 1000),
         data=pcadat_gm12878_10kb_dist_histones,
         #frame = TRUE,
         #frame.type = 'norm',
         label = TRUE, 
         label.size = 3, 
         label.repel=T,
         label.show.legend = FALSE) + 
  #guides(fill=FALSE) +
  theme_bw()

```

#### TFBS

```{r}
tfbsvars <-  gsub(".bed","",list.files("Z:/TAD_data_analysis/annotations/tfbs/cell_type_specific/gm12878"))
```

##### Overlap Counts

```{r}
pcadat_gm12878_10kb_count_tfbs <- pcadat_gm12878_10kb_count[which(rownames(pcadat_gm12878_10kb_count) %in% tfbsvars),]

##with loadings
autoplot(prcomp(pcadat_gm12878_10kb_count_tfbs),
         loadings = TRUE,
         label = TRUE, 
         label.size = 3,
         label.repel=T) +
  theme_bw()
##without loadings
autoplot(prcomp(pcadat_gm12878_10kb_count_tfbs),
         #loadings = TRUE,
         label = TRUE, 
         label.size = 3,
         label.repel=T) +
  theme_bw()
##kmeans clustering algorithm to group annotations
wss <- (nrow(pcadat_gm12878_10kb_count_tfbs)-1)*sum(apply(pcadat_gm12878_10kb_count_tfbs,2,var))
  for (i in 2:50) wss[i] <- sum(kmeans(pcadat_gm12878_10kb_count_tfbs,
                                       centers=i, nstart=25, iter.max = 1000)$withinss)
plot(1:50, wss, type="b", xlab="Number of Clusters",
     ylab="Within groups sum of squares")

set.seed(1)
autoplot(kmeans(pcadat_gm12878_10kb_count_tfbs, 3, nstart=25, iter.max = 1000),
         data=pcadat_gm12878_10kb_count_tfbs,
         #frame = TRUE,
         #frame.type = 'norm',
         label = TRUE, 
         label.size = 3, 
         label.repel=T,
         label.show.legend = FALSE) + 
  #guides(fill=FALSE) +
  theme_bw()

```

##### Overlap Percents

```{r}
pcadat_gm12878_10kb_perc_tfbs <- pcadat_gm12878_10kb_perc[which(rownames(pcadat_gm12878_10kb_perc) %in% tfbsvars),]

##with loadings
autoplot(prcomp(pcadat_gm12878_10kb_perc_tfbs),
         loadings = TRUE,
         label = TRUE, 
         label.size = 3,
         label.repel=T) +
  theme_bw()
##without loadings
autoplot(prcomp(pcadat_gm12878_10kb_perc_tfbs),
         #loadings = TRUE,
         label = TRUE, 
         label.size = 3,
         label.repel=T) +
  theme_bw()
##kmeans clustering algorithm to group annotations
wss <- (nrow(pcadat_gm12878_10kb_perc_tfbs)-1)*sum(apply(pcadat_gm12878_10kb_perc_tfbs,2,var))
  for (i in 2:50) wss[i] <- sum(kmeans(pcadat_gm12878_10kb_perc_tfbs,
                                       centers=i, nstart=25, iter.max = 1000)$withinss)
plot(1:50, wss, type="b", xlab="Number of Clusters",
     ylab="Within groups sum of squares")

set.seed(1)
autoplot(kmeans(pcadat_gm12878_10kb_perc_tfbs, 4, nstart=25, iter.max = 1000),
         data=pcadat_gm12878_10kb_perc_tfbs,
         #frame = TRUE,
         #frame.type = 'norm',
         label = TRUE, 
         label.size = 3, 
         label.repel=T,
         label.show.legend = FALSE) + 
  #guides(fill=FALSE) +
  theme_bw()

```

#####Distance

```{r}
pcadat_gm12878_10kb_dist_tfbs <- pcadat_gm12878_10kb_dist[which(rownames(pcadat_gm12878_10kb_dist) %in% tfbsvars),]

##with loadings
autoplot(prcomp(pcadat_gm12878_10kb_dist_tfbs),
         loadings = TRUE,
         label = TRUE, 
         label.size = 3,
         label.repel=T) +
  theme_bw()
##without loadings
autoplot(prcomp(pcadat_gm12878_10kb_dist_tfbs),
         #loadings = TRUE,
         label = TRUE, 
         label.size = 3,
         label.repel=T) +
  theme_bw()
##kmeans clustering algorithm to group annotations
wss <- (nrow(pcadat_gm12878_10kb_dist_tfbs)-1)*sum(apply(pcadat_gm12878_10kb_dist_tfbs,2,var))
  for (i in 2:50) wss[i] <- sum(kmeans(pcadat_gm12878_10kb_dist_tfbs,
                                       centers=i, nstart=25, iter.max = 1000)$withinss)
plot(1:50, wss, type="b", xlab="Number of Clusters",
     ylab="Within groups sum of squares")

set.seed(1)
autoplot(kmeans(pcadat_gm12878_10kb_dist_tfbs, 5, nstart=25, iter.max = 1000),
         data=pcadat_gm12878_10kb_dist_tfbs,
         #frame = TRUE,
         #frame.type = 'norm',
         label = TRUE, 
         label.size = 3, 
         label.repel=T,
         label.show.legend = FALSE) + 
  #guides(fill=FALSE) +
  theme_bw()

```

### 25kb

```{r}
pcadat_gm12878_25kb_count <- readRDS("Z:/TAD_data_analysis/GM12878/25kb/Ensemble/PCA/pcadat_gm12878_25kb_count.rds")
pcadat_gm12878_25kb_perc <- readRDS("Z:/TAD_data_analysis/GM12878/25kb/Ensemble/PCA/pcadat_gm12878_25kb_perc.rds")
pcadat_gm12878_25kb_dist <- readRDS("Z:/TAD_data_analysis/GM12878/25kb/Ensemble/PCA/pcadat_gm12878_25kb_dist.rds")

#performing log2 transformation on distances
pcadat_gm12878_25kb_dist <- apply(pcadat_gm12878_25kb_dist,2,function(x){log(x + 1, base=2)})

cleancolnames <- function(x){gsub(paste(c("`", 
                                          "_",
                                          #"-",
                                          #"Gm12878", 
                                          #"Haib", 
                                          #"Sydh",
                                          #"Uta",
                                          #"Uw",
                                          #"Broad",
                                          #"Uchicago",
                                          "dist",
                                          "count",
                                          "perc"), collapse = "|"),"", 
                                  colnames(x))}

colnames(pcadat_gm12878_25kb_count) <- cleancolnames(pcadat_gm12878_25kb_count)
colnames(pcadat_gm12878_25kb_perc) <- cleancolnames(pcadat_gm12878_25kb_perc)
colnames(pcadat_gm12878_25kb_dist) <- cleancolnames(pcadat_gm12878_25kb_dist)

pcadat_gm12878_25kb_count <- t(pcadat_gm12878_25kb_count)
pcadat_gm12878_25kb_perc <- t(pcadat_gm12878_25kb_perc)
pcadat_gm12878_25kb_dist <- t(pcadat_gm12878_25kb_dist)

#pcadat_gm12878_25kb_count <- data.frame(pcadat_gm12878_25kb_count)
#pcadat_gm12878_25kb_perc <- data.frame(pcadat_gm12878_25kb_perc)
#pcadat_gm12878_25kb_dist <- data.frame(pcadat_gm12878_25kb_dist)

#pcadat_gm12878_25kb_count$Type <- "Counts"
#pcadat_gm12878_25kb_perc$Type <- "Percent"
#pcadat_gm12878_25kb_dist$Type <- "Distance"

```

#### Chromatin States

```{r}
chromstatevars <- gsub(".bed","",list.files("Z:/TAD_data_analysis/annotations/BroadHMM"))
```

##### Overlap Counts

```{r}
pcadat_gm12878_25kb_count_chromstates <- pcadat_gm12878_25kb_count[which(rownames(pcadat_gm12878_25kb_count) %in% chromstatevars),]

##with loadings
autoplot(prcomp(pcadat_gm12878_25kb_count_chromstates),
         loadings = TRUE,
         label = TRUE, 
         label.size = 3,
         label.repel=T) +
  theme_bw()
##without loadings
autoplot(prcomp(pcadat_gm12878_25kb_count_chromstates),
         #loadings = TRUE,
         label = TRUE, 
         label.size = 3,
         label.repel=T) +
  theme_bw()
##kmeans clustering algorithm to group annotations
wss <- (nrow(pcadat_gm12878_25kb_count_chromstates)-1)*sum(apply(pcadat_gm12878_25kb_count_chromstates,2,var))
  for (i in 2:5) wss[i] <- sum(kmeans(pcadat_gm12878_25kb_count_chromstates,
                                       centers=i, nstart=25, iter.max = 1000)$withinss)
plot(1:5, wss, type="b", xlab="Number of Clusters",
     ylab="Within groups sum of squares")

set.seed(1)
autoplot(kmeans(pcadat_gm12878_25kb_count_chromstates, 3, nstart=25, iter.max = 1000),
         data=pcadat_gm12878_25kb_count_chromstates,
         #frame = TRUE,
         #frame.type = 'norm',
         label = TRUE, 
         label.size = 3, 
         label.repel=T,
         label.show.legend = FALSE) + 
  #guides(fill=FALSE) +
  theme_bw()

```

##### Overlap Percents

```{r}
pcadat_gm12878_25kb_perc_chromstates <- pcadat_gm12878_25kb_perc[which(rownames(pcadat_gm12878_25kb_perc) %in% chromstatevars),]

##with loadings
autoplot(prcomp(pcadat_gm12878_25kb_perc_chromstates),
         loadings = TRUE,
         label = TRUE, 
         label.size = 3,
         label.repel=T) +
  theme_bw()
##without loadings
autoplot(prcomp(pcadat_gm12878_25kb_perc_chromstates),
         #loadings = TRUE,
         label = TRUE, 
         label.size = 3,
         label.repel=T) +
  theme_bw()
##kmeans clustering algorithm to group annotations
wss <- (nrow(pcadat_gm12878_25kb_perc_chromstates)-1)*sum(apply(pcadat_gm12878_25kb_perc_chromstates,2,var))
  for (i in 2:5) wss[i] <- sum(kmeans(pcadat_gm12878_25kb_perc_chromstates,
                                       centers=i, nstart=25, iter.max = 1000)$withinss)
plot(1:5, wss, type="b", xlab="Number of Clusters",
     ylab="Within groups sum of squares")

set.seed(1)
autoplot(kmeans(pcadat_gm12878_25kb_perc_chromstates, 3, nstart=25, iter.max = 1000),
         data=pcadat_gm12878_25kb_perc_chromstates,
         #frame = TRUE,
         #frame.type = 'norm',
         label = TRUE, 
         label.size = 3, 
         label.repel=T,
         label.show.legend = FALSE) + 
  #guides(fill=FALSE) +
  theme_bw()

```

#####Distance

```{r}
pcadat_gm12878_25kb_dist_chromstates <- pcadat_gm12878_25kb_dist[which(rownames(pcadat_gm12878_25kb_dist) %in% chromstatevars),]

##with loadings
autoplot(prcomp(pcadat_gm12878_25kb_dist_chromstates),
         loadings = TRUE,
         label = TRUE, 
         label.size = 3,
         label.repel=T) +
  theme_bw()
##without loadings
autoplot(prcomp(pcadat_gm12878_25kb_dist_chromstates),
         #loadings = TRUE,
         label = TRUE, 
         label.size = 3,
         label.repel=T) +
  theme_bw()
##kmeans clustering algorithm to group annotations
wss <- (nrow(pcadat_gm12878_25kb_dist_chromstates)-1)*sum(apply(pcadat_gm12878_25kb_dist_chromstates,2,var))
  for (i in 2:5) wss[i] <- sum(kmeans(pcadat_gm12878_25kb_dist_chromstates,
                                       centers=i, nstart=25, iter.max = 1000)$withinss)
plot(1:5, wss, type="b", xlab="Number of Clusters",
     ylab="Within groups sum of squares")

set.seed(1)
autoplot(kmeans(pcadat_gm12878_25kb_dist_chromstates, 4, nstart=25, iter.max = 1000),
         data=pcadat_gm12878_25kb_dist_chromstates,
         #frame = TRUE,
         #frame.type = 'norm',
         label = TRUE, 
         label.size = 3, 
         label.repel=T,
         label.show.legend = FALSE) + 
  #guides(fill=FALSE) +
  theme_bw()

```

#### Histone Modifications

```{r}
histonevars <- gsub(".bed","",list.files("Z:/TAD_data_analysis/annotations/HistoneModifications"))
```

##### Overlap Counts

```{r}
pcadat_gm12878_25kb_count_histones <- pcadat_gm12878_25kb_count[which(rownames(pcadat_gm12878_25kb_count) %in% histonevars),]

##with loadings
autoplot(prcomp(pcadat_gm12878_25kb_count_histones),
         loadings = TRUE,
         label = TRUE, 
         label.size = 3,
         label.repel=T) +
  theme_bw()
##without loadings
autoplot(prcomp(pcadat_gm12878_25kb_count_histones),
         #loadings = TRUE,
         label = TRUE, 
         label.size = 3,
         label.repel=T) +
  theme_bw()
##kmeans clustering algorithm to group annotations
wss <- (nrow(pcadat_gm12878_25kb_count_histones)-1)*sum(apply(pcadat_gm12878_25kb_count_histones,2,var))
  for (i in 2:5) wss[i] <- sum(kmeans(pcadat_gm12878_25kb_count_histones,
                                       centers=i, nstart=25, iter.max = 1000)$withinss)
plot(1:5, wss, type="b", xlab="Number of Clusters",
     ylab="Within groups sum of squares")

set.seed(1)
autoplot(kmeans(pcadat_gm12878_25kb_count_histones, 3, nstart=25, iter.max = 1000),
         data=pcadat_gm12878_25kb_count_histones,
         #frame = TRUE,
         #frame.type = 'norm',
         label = TRUE, 
         label.size = 3, 
         label.repel=T,
         label.show.legend = FALSE) + 
  #guides(fill=FALSE) +
  theme_bw()

```

##### Overlap Percents

```{r}
pcadat_gm12878_25kb_perc_histones <- pcadat_gm12878_25kb_perc[which(rownames(pcadat_gm12878_25kb_perc) %in% histonevars),]

##with loadings
autoplot(prcomp(pcadat_gm12878_25kb_perc_histones),
         loadings = TRUE,
         label = TRUE, 
         label.size = 3,
         label.repel=T) +
  theme_bw()
##without loadings
autoplot(prcomp(pcadat_gm12878_25kb_perc_histones),
         #loadings = TRUE,
         label = TRUE, 
         label.size = 3,
         label.repel=T) +
  theme_bw()
##kmeans clustering algorithm to group annotations
wss <- (nrow(pcadat_gm12878_25kb_perc_histones)-1)*sum(apply(pcadat_gm12878_25kb_perc_histones,2,var))
  for (i in 2:5) wss[i] <- sum(kmeans(pcadat_gm12878_25kb_perc_histones,
                                       centers=i, nstart=25, iter.max = 1000)$withinss)
plot(1:5, wss, type="b", xlab="Number of Clusters",
     ylab="Within groups sum of squares")

set.seed(1)
autoplot(kmeans(pcadat_gm12878_25kb_perc_histones, 4, nstart=25, iter.max = 1000),
         data=pcadat_gm12878_25kb_perc_histones,
         #frame = TRUE,
         #frame.type = 'norm',
         label = TRUE, 
         label.size = 3, 
         label.repel=T,
         label.show.legend = FALSE) + 
  #guides(fill=FALSE) +
  theme_bw()

```

#####Distance

```{r}
pcadat_gm12878_25kb_dist_histones <- pcadat_gm12878_25kb_dist[which(rownames(pcadat_gm12878_25kb_dist) %in% histonevars),]

##with loadings
autoplot(prcomp(pcadat_gm12878_25kb_dist_histones),
         loadings = TRUE,
         label = TRUE, 
         label.size = 3,
         label.repel=T) +
  theme_bw()
##without loadings
autoplot(prcomp(pcadat_gm12878_25kb_dist_histones),
         #loadings = TRUE,
         label = TRUE, 
         label.size = 3,
         label.repel=T) +
  theme_bw()
##kmeans clustering algorithm to group annotations
wss <- (nrow(pcadat_gm12878_25kb_dist_histones)-1)*sum(apply(pcadat_gm12878_25kb_dist_histones,2,var))
  for (i in 2:5) wss[i] <- sum(kmeans(pcadat_gm12878_25kb_dist_histones,
                                       centers=i, nstart=25, iter.max = 1000)$withinss)
plot(1:5, wss, type="b", xlab="Number of Clusters",
     ylab="Within groups sum of squares")

set.seed(1)
autoplot(kmeans(pcadat_gm12878_25kb_dist_histones, 4, nstart=25, iter.max = 1000),
         data=pcadat_gm12878_25kb_dist_histones,
         #frame = TRUE,
         #frame.type = 'norm',
         label = TRUE, 
         label.size = 3, 
         label.repel=T,
         label.show.legend = FALSE) + 
  #guides(fill=FALSE) +
  theme_bw()

```

#### TFBS

```{r}
tfbsvars <-  gsub(".bed","",list.files("Z:/TAD_data_analysis/annotations/tfbs/cell_type_specific/gm12878"))
```

##### Overlap Counts

```{r}
pcadat_gm12878_25kb_count_tfbs <- pcadat_gm12878_25kb_count[which(rownames(pcadat_gm12878_25kb_count) %in% tfbsvars),]

##with loadings
autoplot(prcomp(pcadat_gm12878_25kb_count_tfbs),
         loadings = TRUE,
         label = TRUE, 
         label.size = 3,
         label.repel=T) +
  theme_bw()
##without loadings
autoplot(prcomp(pcadat_gm12878_25kb_count_tfbs),
         #loadings = TRUE,
         label = TRUE, 
         label.size = 3,
         label.repel=T) +
  theme_bw()
##kmeans clustering algorithm to group annotations
wss <- (nrow(pcadat_gm12878_25kb_count_tfbs)-1)*sum(apply(pcadat_gm12878_25kb_count_tfbs,2,var))
  for (i in 2:50) wss[i] <- sum(kmeans(pcadat_gm12878_25kb_count_tfbs,
                                       centers=i, nstart=25, iter.max = 1000)$withinss)
plot(1:50, wss, type="b", xlab="Number of Clusters",
     ylab="Within groups sum of squares")

set.seed(1)
autoplot(kmeans(pcadat_gm12878_25kb_count_tfbs, 3, nstart=25, iter.max = 1000),
         data=pcadat_gm12878_25kb_count_tfbs,
         #frame = TRUE,
         #frame.type = 'norm',
         label = TRUE, 
         label.size = 3, 
         label.repel=T,
         label.show.legend = FALSE) + 
  #guides(fill=FALSE) +
  theme_bw()

```

##### Overlap Percents

```{r}
pcadat_gm12878_25kb_perc_tfbs <- pcadat_gm12878_25kb_perc[which(rownames(pcadat_gm12878_25kb_perc) %in% tfbsvars),]

##with loadings
autoplot(prcomp(pcadat_gm12878_25kb_perc_tfbs),
         loadings = TRUE,
         label = TRUE, 
         label.size = 3,
         label.repel=T) +
  theme_bw()
##without loadings
autoplot(prcomp(pcadat_gm12878_25kb_perc_tfbs),
         #loadings = TRUE,
         label = TRUE, 
         label.size = 3,
         label.repel=T) +
  theme_bw()
##kmeans clustering algorithm to group annotations
wss <- (nrow(pcadat_gm12878_25kb_perc_tfbs)-1)*sum(apply(pcadat_gm12878_25kb_perc_tfbs,2,var))
  for (i in 2:50) wss[i] <- sum(kmeans(pcadat_gm12878_25kb_perc_tfbs,
                                       centers=i, nstart=25, iter.max = 1000)$withinss)
plot(1:50, wss, type="b", xlab="Number of Clusters",
     ylab="Within groups sum of squares")

set.seed(1)
autoplot(kmeans(pcadat_gm12878_25kb_perc_tfbs, 4, nstart=25, iter.max = 1000),
         data=pcadat_gm12878_25kb_perc_tfbs,
         #frame = TRUE,
         #frame.type = 'norm',
         label = TRUE, 
         label.size = 3, 
         label.repel=T,
         label.show.legend = FALSE) + 
  #guides(fill=FALSE) +
  theme_bw()

```

#####Distance

```{r}
pcadat_gm12878_25kb_dist_tfbs <- pcadat_gm12878_25kb_dist[which(rownames(pcadat_gm12878_25kb_dist) %in% tfbsvars),]

##with loadings
autoplot(prcomp(pcadat_gm12878_25kb_dist_tfbs),
         loadings = TRUE,
         label = TRUE, 
         label.size = 3,
         label.repel=T) +
  theme_bw()
##without loadings
autoplot(prcomp(pcadat_gm12878_25kb_dist_tfbs),
         #loadings = TRUE,
         label = TRUE, 
         label.size = 3,
         label.repel=T) +
  theme_bw()
##kmeans clustering algorithm to group annotations
wss <- (nrow(pcadat_gm12878_25kb_dist_tfbs)-1)*sum(apply(pcadat_gm12878_25kb_dist_tfbs,2,var))
  for (i in 2:50) wss[i] <- sum(kmeans(pcadat_gm12878_25kb_dist_tfbs,
                                       centers=i, nstart=25, iter.max = 1000)$withinss)
plot(1:50, wss, type="b", xlab="Number of Clusters",
     ylab="Within groups sum of squares")

set.seed(1)
autoplot(kmeans(pcadat_gm12878_25kb_dist_tfbs, 5, nstart=25, iter.max = 1000),
         data=pcadat_gm12878_25kb_dist_tfbs,
         #frame = TRUE,
         #frame.type = 'norm',
         label = TRUE, 
         label.size = 3, 
         label.repel=T,
         label.show.legend = FALSE) + 
  #guides(fill=FALSE) +
  theme_bw()

```

### 50kb

```{r}
pcadat_gm12878_50kb_count <- readRDS("Z:/TAD_data_analysis/GM12878/50kb/Ensemble/PCA/pcadat_gm12878_50kb_count.rds")
pcadat_gm12878_50kb_perc <- readRDS("Z:/TAD_data_analysis/GM12878/50kb/Ensemble/PCA/pcadat_gm12878_50kb_perc.rds")
pcadat_gm12878_50kb_dist <- readRDS("Z:/TAD_data_analysis/GM12878/50kb/Ensemble/PCA/pcadat_gm12878_50kb_dist.rds")

#performing log2 transformation on distances
pcadat_gm12878_50kb_dist <- apply(pcadat_gm12878_50kb_dist,2,function(x){log(x + 1, base=2)})

cleancolnames <- function(x){gsub(paste(c("`", 
                                          "_",
                                          #"-",
                                          #"Gm12878", 
                                          #"Haib", 
                                          #"Sydh",
                                          #"Uta",
                                          #"Uw",
                                          #"Broad",
                                          #"Uchicago",
                                          "dist",
                                          "count",
                                          "perc"), collapse = "|"),"", 
                                  colnames(x))}

colnames(pcadat_gm12878_50kb_count) <- cleancolnames(pcadat_gm12878_50kb_count)
colnames(pcadat_gm12878_50kb_perc) <- cleancolnames(pcadat_gm12878_50kb_perc)
colnames(pcadat_gm12878_50kb_dist) <- cleancolnames(pcadat_gm12878_50kb_dist)

pcadat_gm12878_50kb_count <- t(pcadat_gm12878_50kb_count)
pcadat_gm12878_50kb_perc <- t(pcadat_gm12878_50kb_perc)
pcadat_gm12878_50kb_dist <- t(pcadat_gm12878_50kb_dist)

#pcadat_gm12878_50kb_count <- data.frame(pcadat_gm12878_50kb_count)
#pcadat_gm12878_50kb_perc <- data.frame(pcadat_gm12878_50kb_perc)
#pcadat_gm12878_50kb_dist <- data.frame(pcadat_gm12878_50kb_dist)

#pcadat_gm12878_50kb_count$Type <- "Counts"
#pcadat_gm12878_50kb_perc$Type <- "Percent"
#pcadat_gm12878_50kb_dist$Type <- "Distance"

```

#### Chromatin States

```{r}
chromstatevars <- gsub(".bed","",list.files("Z:/TAD_data_analysis/annotations/BroadHMM"))
```

##### Overlap Counts

```{r}
pcadat_gm12878_50kb_count_chromstates <- pcadat_gm12878_50kb_count[which(rownames(pcadat_gm12878_50kb_count) %in% chromstatevars),]

##with loadings
autoplot(prcomp(pcadat_gm12878_50kb_count_chromstates),
         loadings = TRUE,
         label = TRUE, 
         label.size = 3,
         label.repel=T) +
  theme_bw()
##without loadings
autoplot(prcomp(pcadat_gm12878_50kb_count_chromstates),
         #loadings = TRUE,
         label = TRUE, 
         label.size = 3,
         label.repel=T) +
  theme_bw()
##kmeans clustering algorithm to group annotations
wss <- (nrow(pcadat_gm12878_50kb_count_chromstates)-1)*sum(apply(pcadat_gm12878_50kb_count_chromstates,2,var))
  for (i in 2:5) wss[i] <- sum(kmeans(pcadat_gm12878_50kb_count_chromstates,
                                       centers=i, nstart=25, iter.max = 1000)$withinss)
plot(1:5, wss, type="b", xlab="Number of Clusters",
     ylab="Within groups sum of squares")

set.seed(1)
autoplot(kmeans(pcadat_gm12878_50kb_count_chromstates, 3, nstart=25, iter.max = 1000),
         data=pcadat_gm12878_50kb_count_chromstates,
         #frame = TRUE,
         #frame.type = 'norm',
         label = TRUE, 
         label.size = 3, 
         label.repel=T,
         label.show.legend = FALSE) + 
  #guides(fill=FALSE) +
  theme_bw()

```

##### Overlap Percents

```{r}
pcadat_gm12878_50kb_perc_chromstates <- pcadat_gm12878_50kb_perc[which(rownames(pcadat_gm12878_50kb_perc) %in% chromstatevars),]

##with loadings
autoplot(prcomp(pcadat_gm12878_50kb_perc_chromstates),
         loadings = TRUE,
         label = TRUE, 
         label.size = 3,
         label.repel=T) +
  theme_bw()
##without loadings
autoplot(prcomp(pcadat_gm12878_50kb_perc_chromstates),
         #loadings = TRUE,
         label = TRUE, 
         label.size = 3,
         label.repel=T) +
  theme_bw()
##kmeans clustering algorithm to group annotations
wss <- (nrow(pcadat_gm12878_50kb_perc_chromstates)-1)*sum(apply(pcadat_gm12878_50kb_perc_chromstates,2,var))
  for (i in 2:5) wss[i] <- sum(kmeans(pcadat_gm12878_50kb_perc_chromstates,
                                       centers=i, nstart=25, iter.max = 1000)$withinss)
plot(1:5, wss, type="b", xlab="Number of Clusters",
     ylab="Within groups sum of squares")

set.seed(1)
autoplot(kmeans(pcadat_gm12878_50kb_perc_chromstates, 3, nstart=25, iter.max = 1000),
         data=pcadat_gm12878_50kb_perc_chromstates,
         #frame = TRUE,
         #frame.type = 'norm',
         label = TRUE, 
         label.size = 3, 
         label.repel=T,
         label.show.legend = FALSE) + 
  #guides(fill=FALSE) +
  theme_bw()

```

#####Distance

```{r}
pcadat_gm12878_50kb_dist_chromstates <- pcadat_gm12878_50kb_dist[which(rownames(pcadat_gm12878_50kb_dist) %in% chromstatevars),]

##with loadings
autoplot(prcomp(pcadat_gm12878_50kb_dist_chromstates),
         loadings = TRUE,
         label = TRUE, 
         label.size = 3,
         label.repel=T) +
  theme_bw()
##without loadings
autoplot(prcomp(pcadat_gm12878_50kb_dist_chromstates),
         #loadings = TRUE,
         label = TRUE, 
         label.size = 3,
         label.repel=T) +
  theme_bw()
##kmeans clustering algorithm to group annotations
wss <- (nrow(pcadat_gm12878_50kb_dist_chromstates)-1)*sum(apply(pcadat_gm12878_50kb_dist_chromstates,2,var))
  for (i in 2:5) wss[i] <- sum(kmeans(pcadat_gm12878_50kb_dist_chromstates,
                                       centers=i, nstart=25, iter.max = 1000)$withinss)
plot(1:5, wss, type="b", xlab="Number of Clusters",
     ylab="Within groups sum of squares")

set.seed(1)
autoplot(kmeans(pcadat_gm12878_50kb_dist_chromstates, 4, nstart=25, iter.max = 1000),
         data=pcadat_gm12878_50kb_dist_chromstates,
         #frame = TRUE,
         #frame.type = 'norm',
         label = TRUE, 
         label.size = 3, 
         label.repel=T,
         label.show.legend = FALSE) + 
  #guides(fill=FALSE) +
  theme_bw()

```

#### Histone Modifications

```{r}
histonevars <- gsub(".bed","",list.files("Z:/TAD_data_analysis/annotations/HistoneModifications"))
```

##### Overlap Counts

```{r}
pcadat_gm12878_50kb_count_histones <- pcadat_gm12878_50kb_count[which(rownames(pcadat_gm12878_50kb_count) %in% histonevars),]

##with loadings
autoplot(prcomp(pcadat_gm12878_50kb_count_histones),
         loadings = TRUE,
         label = TRUE, 
         label.size = 3,
         label.repel=T) +
  theme_bw()
##without loadings
autoplot(prcomp(pcadat_gm12878_50kb_count_histones),
         #loadings = TRUE,
         label = TRUE, 
         label.size = 3,
         label.repel=T) +
  theme_bw()
##kmeans clustering algorithm to group annotations
wss <- (nrow(pcadat_gm12878_50kb_count_histones)-1)*sum(apply(pcadat_gm12878_50kb_count_histones,2,var))
  for (i in 2:5) wss[i] <- sum(kmeans(pcadat_gm12878_50kb_count_histones,
                                       centers=i, nstart=25, iter.max = 1000)$withinss)
plot(1:5, wss, type="b", xlab="Number of Clusters",
     ylab="Within groups sum of squares")

set.seed(1)
autoplot(kmeans(pcadat_gm12878_50kb_count_histones, 3, nstart=25, iter.max = 1000),
         data=pcadat_gm12878_50kb_count_histones,
         #frame = TRUE,
         #frame.type = 'norm',
         label = TRUE, 
         label.size = 3, 
         label.repel=T,
         label.show.legend = FALSE) + 
  #guides(fill=FALSE) +
  theme_bw()

```

##### Overlap Percents

```{r}
pcadat_gm12878_50kb_perc_histones <- pcadat_gm12878_50kb_perc[which(rownames(pcadat_gm12878_50kb_perc) %in% histonevars),]

##with loadings
autoplot(prcomp(pcadat_gm12878_50kb_perc_histones),
         loadings = TRUE,
         label = TRUE, 
         label.size = 3,
         label.repel=T) +
  theme_bw()
##without loadings
autoplot(prcomp(pcadat_gm12878_50kb_perc_histones),
         #loadings = TRUE,
         label = TRUE, 
         label.size = 3,
         label.repel=T) +
  theme_bw()
##kmeans clustering algorithm to group annotations
wss <- (nrow(pcadat_gm12878_50kb_perc_histones)-1)*sum(apply(pcadat_gm12878_50kb_perc_histones,2,var))
  for (i in 2:5) wss[i] <- sum(kmeans(pcadat_gm12878_50kb_perc_histones,
                                       centers=i, nstart=25, iter.max = 1000)$withinss)
plot(1:5, wss, type="b", xlab="Number of Clusters",
     ylab="Within groups sum of squares")

set.seed(1)
autoplot(kmeans(pcadat_gm12878_50kb_perc_histones, 4, nstart=25, iter.max = 1000),
         data=pcadat_gm12878_50kb_perc_histones,
         #frame = TRUE,
         #frame.type = 'norm',
         label = TRUE, 
         label.size = 3, 
         label.repel=T,
         label.show.legend = FALSE) + 
  #guides(fill=FALSE) +
  theme_bw()

```

#####Distance

```{r}
pcadat_gm12878_50kb_dist_histones <- pcadat_gm12878_50kb_dist[which(rownames(pcadat_gm12878_50kb_dist) %in% histonevars),]

##with loadings
autoplot(prcomp(pcadat_gm12878_50kb_dist_histones),
         loadings = TRUE,
         label = TRUE, 
         label.size = 3,
         label.repel=T) +
  theme_bw()
##without loadings
autoplot(prcomp(pcadat_gm12878_50kb_dist_histones),
         #loadings = TRUE,
         label = TRUE, 
         label.size = 3,
         label.repel=T) +
  theme_bw()
##kmeans clustering algorithm to group annotations
wss <- (nrow(pcadat_gm12878_50kb_dist_histones)-1)*sum(apply(pcadat_gm12878_50kb_dist_histones,2,var))
  for (i in 2:5) wss[i] <- sum(kmeans(pcadat_gm12878_50kb_dist_histones,
                                       centers=i, nstart=25, iter.max = 1000)$withinss)
plot(1:5, wss, type="b", xlab="Number of Clusters",
     ylab="Within groups sum of squares")

set.seed(1)
autoplot(kmeans(pcadat_gm12878_50kb_dist_histones, 4, nstart=25, iter.max = 1000),
         data=pcadat_gm12878_50kb_dist_histones,
         #frame = TRUE,
         #frame.type = 'norm',
         label = TRUE, 
         label.size = 3, 
         label.repel=T,
         label.show.legend = FALSE) + 
  #guides(fill=FALSE) +
  theme_bw()

```

#### TFBS

```{r}
tfbsvars <-  gsub(".bed","",list.files("Z:/TAD_data_analysis/annotations/tfbs/cell_type_specific/gm12878"))
```

##### Overlap Counts

```{r}
pcadat_gm12878_50kb_count_tfbs <- pcadat_gm12878_50kb_count[which(rownames(pcadat_gm12878_50kb_count) %in% tfbsvars),]

##with loadings
autoplot(prcomp(pcadat_gm12878_50kb_count_tfbs),
         loadings = TRUE,
         label = TRUE, 
         label.size = 3,
         label.repel=T) +
  theme_bw()
##without loadings
autoplot(prcomp(pcadat_gm12878_50kb_count_tfbs),
         #loadings = TRUE,
         label = TRUE, 
         label.size = 3,
         label.repel=T) +
  theme_bw()
##kmeans clustering algorithm to group annotations
wss <- (nrow(pcadat_gm12878_50kb_count_tfbs)-1)*sum(apply(pcadat_gm12878_50kb_count_tfbs,2,var))
  for (i in 2:50) wss[i] <- sum(kmeans(pcadat_gm12878_50kb_count_tfbs,
                                       centers=i, nstart=25, iter.max = 1000)$withinss)
plot(1:50, wss, type="b", xlab="Number of Clusters",
     ylab="Within groups sum of squares")

set.seed(1)
autoplot(kmeans(pcadat_gm12878_50kb_count_tfbs, 3, nstart=25, iter.max = 1000),
         data=pcadat_gm12878_50kb_count_tfbs,
         #frame = TRUE,
         #frame.type = 'norm',
         label = TRUE, 
         label.size = 3, 
         label.repel=T,
         label.show.legend = FALSE) + 
  #guides(fill=FALSE) +
  theme_bw()

```

##### Overlap Percents

```{r}
pcadat_gm12878_50kb_perc_tfbs <- pcadat_gm12878_50kb_perc[which(rownames(pcadat_gm12878_50kb_perc) %in% tfbsvars),]

##with loadings
autoplot(prcomp(pcadat_gm12878_50kb_perc_tfbs),
         loadings = TRUE,
         label = TRUE, 
         label.size = 3,
         label.repel=T) +
  theme_bw()
##without loadings
autoplot(prcomp(pcadat_gm12878_50kb_perc_tfbs),
         #loadings = TRUE,
         label = TRUE, 
         label.size = 3,
         label.repel=T) +
  theme_bw()
##kmeans clustering algorithm to group annotations
wss <- (nrow(pcadat_gm12878_50kb_perc_tfbs)-1)*sum(apply(pcadat_gm12878_50kb_perc_tfbs,2,var))
  for (i in 2:50) wss[i] <- sum(kmeans(pcadat_gm12878_50kb_perc_tfbs,
                                       centers=i, nstart=25, iter.max = 1000)$withinss)
plot(1:50, wss, type="b", xlab="Number of Clusters",
     ylab="Within groups sum of squares")

set.seed(1)
autoplot(kmeans(pcadat_gm12878_50kb_perc_tfbs, 4, nstart=25, iter.max = 1000),
         data=pcadat_gm12878_50kb_perc_tfbs,
         #frame = TRUE,
         #frame.type = 'norm',
         label = TRUE, 
         label.size = 3, 
         label.repel=T,
         label.show.legend = FALSE) + 
  #guides(fill=FALSE) +
  theme_bw()

```

#####Distance

```{r}
pcadat_gm12878_50kb_dist_tfbs <- pcadat_gm12878_50kb_dist[which(rownames(pcadat_gm12878_50kb_dist) %in% tfbsvars),]

##with loadings
autoplot(prcomp(pcadat_gm12878_50kb_dist_tfbs),
         loadings = TRUE,
         label = TRUE, 
         label.size = 3,
         label.repel=T) +
  theme_bw()
##without loadings
autoplot(prcomp(pcadat_gm12878_50kb_dist_tfbs),
         #loadings = TRUE,
         label = TRUE, 
         label.size = 3,
         label.repel=T) +
  theme_bw()
##kmeans clustering algorithm to group annotations
wss <- (nrow(pcadat_gm12878_50kb_dist_tfbs)-1)*sum(apply(pcadat_gm12878_50kb_dist_tfbs,2,var))
  for (i in 2:50) wss[i] <- sum(kmeans(pcadat_gm12878_50kb_dist_tfbs,
                                       centers=i, nstart=25, iter.max = 1000)$withinss)
plot(1:50, wss, type="b", xlab="Number of Clusters",
     ylab="Within groups sum of squares")

set.seed(1)
autoplot(kmeans(pcadat_gm12878_50kb_dist_tfbs, 5, nstart=25, iter.max = 1000),
         data=pcadat_gm12878_50kb_dist_tfbs,
         #frame = TRUE,
         #frame.type = 'norm',
         label = TRUE, 
         label.size = 3, 
         label.repel=T,
         label.show.legend = FALSE) + 
  #guides(fill=FALSE) +
  theme_bw()

```

### 100kb

```{r}
pcadat_gm12878_100kb_count <- readRDS("Z:/TAD_data_analysis/GM12878/100kb/Ensemble/PCA/pcadat_gm12878_100kb_count.rds")
pcadat_gm12878_100kb_perc <- readRDS("Z:/TAD_data_analysis/GM12878/100kb/Ensemble/PCA/pcadat_gm12878_100kb_perc.rds")
pcadat_gm12878_100kb_dist <- readRDS("Z:/TAD_data_analysis/GM12878/100kb/Ensemble/PCA/pcadat_gm12878_100kb_dist.rds")

#performing log2 transformation on distances
pcadat_gm12878_100kb_dist <- apply(pcadat_gm12878_100kb_dist,2,function(x){log(x + 1, base=2)})

cleancolnames <- function(x){gsub(paste(c("`", 
                                          "_",
                                          #"-",
                                          #"Gm12878", 
                                          #"Haib", 
                                          #"Sydh",
                                          #"Uta",
                                          #"Uw",
                                          #"Broad",
                                          #"Uchicago",
                                          "dist",
                                          "count",
                                          "perc"), collapse = "|"),"", 
                                  colnames(x))}

colnames(pcadat_gm12878_100kb_count) <- cleancolnames(pcadat_gm12878_100kb_count)
colnames(pcadat_gm12878_100kb_perc) <- cleancolnames(pcadat_gm12878_100kb_perc)
colnames(pcadat_gm12878_100kb_dist) <- cleancolnames(pcadat_gm12878_100kb_dist)

pcadat_gm12878_100kb_count <- t(pcadat_gm12878_100kb_count)
pcadat_gm12878_100kb_perc <- t(pcadat_gm12878_100kb_perc)
pcadat_gm12878_100kb_dist <- t(pcadat_gm12878_100kb_dist)

#pcadat_gm12878_100kb_count <- data.frame(pcadat_gm12878_100kb_count)
#pcadat_gm12878_100kb_perc <- data.frame(pcadat_gm12878_100kb_perc)
#pcadat_gm12878_100kb_dist <- data.frame(pcadat_gm12878_100kb_dist)

#pcadat_gm12878_100kb_count$Type <- "Counts"
#pcadat_gm12878_100kb_perc$Type <- "Percent"
#pcadat_gm12878_100kb_dist$Type <- "Distance"

```

#### Chromatin States

```{r}
chromstatevars <- gsub(".bed","",list.files("Z:/TAD_data_analysis/annotations/BroadHMM"))
```

##### Overlap Counts

```{r}
pcadat_gm12878_100kb_count_chromstates <- pcadat_gm12878_100kb_count[which(rownames(pcadat_gm12878_100kb_count) %in% chromstatevars),]

##with loadings
autoplot(prcomp(pcadat_gm12878_100kb_count_chromstates),
         loadings = TRUE,
         label = TRUE, 
         label.size = 3,
         label.repel=T) +
  theme_bw()
##without loadings
autoplot(prcomp(pcadat_gm12878_100kb_count_chromstates),
         #loadings = TRUE,
         label = TRUE, 
         label.size = 3,
         label.repel=T) +
  theme_bw()
##kmeans clustering algorithm to group annotations
wss <- (nrow(pcadat_gm12878_100kb_count_chromstates)-1)*sum(apply(pcadat_gm12878_100kb_count_chromstates,2,var))
  for (i in 2:5) wss[i] <- sum(kmeans(pcadat_gm12878_100kb_count_chromstates,
                                       centers=i, nstart=25, iter.max = 1000)$withinss)
plot(1:5, wss, type="b", xlab="Number of Clusters",
     ylab="Within groups sum of squares")

set.seed(1)
autoplot(kmeans(pcadat_gm12878_100kb_count_chromstates, 3, nstart=25, iter.max = 1000),
         data=pcadat_gm12878_100kb_count_chromstates,
         #frame = TRUE,
         #frame.type = 'norm',
         label = TRUE, 
         label.size = 3, 
         label.repel=T,
         label.show.legend = FALSE) + 
  #guides(fill=FALSE) +
  theme_bw()

```

##### Overlap Percents

```{r}
pcadat_gm12878_100kb_perc_chromstates <- pcadat_gm12878_100kb_perc[which(rownames(pcadat_gm12878_100kb_perc) %in% chromstatevars),]

##with loadings
autoplot(prcomp(pcadat_gm12878_100kb_perc_chromstates),
         loadings = TRUE,
         label = TRUE, 
         label.size = 3,
         label.repel=T) +
  theme_bw()
##without loadings
autoplot(prcomp(pcadat_gm12878_100kb_perc_chromstates),
         #loadings = TRUE,
         label = TRUE, 
         label.size = 3,
         label.repel=T) +
  theme_bw()
##kmeans clustering algorithm to group annotations
wss <- (nrow(pcadat_gm12878_100kb_perc_chromstates)-1)*sum(apply(pcadat_gm12878_100kb_perc_chromstates,2,var))
  for (i in 2:5) wss[i] <- sum(kmeans(pcadat_gm12878_100kb_perc_chromstates,
                                       centers=i, nstart=25, iter.max = 1000)$withinss)
plot(1:5, wss, type="b", xlab="Number of Clusters",
     ylab="Within groups sum of squares")

set.seed(1)
autoplot(kmeans(pcadat_gm12878_100kb_perc_chromstates, 3, nstart=25, iter.max = 1000),
         data=pcadat_gm12878_100kb_perc_chromstates,
         #frame = TRUE,
         #frame.type = 'norm',
         label = TRUE, 
         label.size = 3, 
         label.repel=T,
         label.show.legend = FALSE) + 
  #guides(fill=FALSE) +
  theme_bw()

```

#####Distance

```{r}
pcadat_gm12878_100kb_dist_chromstates <- pcadat_gm12878_100kb_dist[which(rownames(pcadat_gm12878_100kb_dist) %in% chromstatevars),]

##with loadings
autoplot(prcomp(pcadat_gm12878_100kb_dist_chromstates),
         loadings = TRUE,
         label = TRUE, 
         label.size = 3,
         label.repel=T) +
  theme_bw()
##without loadings
autoplot(prcomp(pcadat_gm12878_100kb_dist_chromstates),
         #loadings = TRUE,
         label = TRUE, 
         label.size = 3,
         label.repel=T) +
  theme_bw()
##kmeans clustering algorithm to group annotations
wss <- (nrow(pcadat_gm12878_100kb_dist_chromstates)-1)*sum(apply(pcadat_gm12878_100kb_dist_chromstates,2,var))
  for (i in 2:5) wss[i] <- sum(kmeans(pcadat_gm12878_100kb_dist_chromstates,
                                       centers=i, nstart=25, iter.max = 1000)$withinss)
plot(1:5, wss, type="b", xlab="Number of Clusters",
     ylab="Within groups sum of squares")

set.seed(1)
autoplot(kmeans(pcadat_gm12878_100kb_dist_chromstates, 4, nstart=25, iter.max = 1000),
         data=pcadat_gm12878_100kb_dist_chromstates,
         #frame = TRUE,
         #frame.type = 'norm',
         label = TRUE, 
         label.size = 3, 
         label.repel=T,
         label.show.legend = FALSE) + 
  #guides(fill=FALSE) +
  theme_bw()

```

#### Histone Modifications

```{r}
histonevars <- gsub(".bed","",list.files("Z:/TAD_data_analysis/annotations/HistoneModifications"))
```

##### Overlap Counts

```{r}
pcadat_gm12878_100kb_count_histones <- pcadat_gm12878_100kb_count[which(rownames(pcadat_gm12878_100kb_count) %in% histonevars),]

##with loadings
autoplot(prcomp(pcadat_gm12878_100kb_count_histones),
         loadings = TRUE,
         label = TRUE, 
         label.size = 3,
         label.repel=T) +
  theme_bw()
##without loadings
autoplot(prcomp(pcadat_gm12878_100kb_count_histones),
         #loadings = TRUE,
         label = TRUE, 
         label.size = 3,
         label.repel=T) +
  theme_bw()
##kmeans clustering algorithm to group annotations
wss <- (nrow(pcadat_gm12878_100kb_count_histones)-1)*sum(apply(pcadat_gm12878_100kb_count_histones,2,var))
  for (i in 2:5) wss[i] <- sum(kmeans(pcadat_gm12878_100kb_count_histones,
                                       centers=i, nstart=25, iter.max = 1000)$withinss)
plot(1:5, wss, type="b", xlab="Number of Clusters",
     ylab="Within groups sum of squares")

set.seed(1)
autoplot(kmeans(pcadat_gm12878_100kb_count_histones, 3, nstart=25, iter.max = 1000),
         data=pcadat_gm12878_100kb_count_histones,
         #frame = TRUE,
         #frame.type = 'norm',
         label = TRUE, 
         label.size = 3, 
         label.repel=T,
         label.show.legend = FALSE) + 
  #guides(fill=FALSE) +
  theme_bw()

```

##### Overlap Percents

```{r}
pcadat_gm12878_100kb_perc_histones <- pcadat_gm12878_100kb_perc[which(rownames(pcadat_gm12878_100kb_perc) %in% histonevars),]

##with loadings
autoplot(prcomp(pcadat_gm12878_100kb_perc_histones),
         loadings = TRUE,
         label = TRUE, 
         label.size = 3,
         label.repel=T) +
  theme_bw()
##without loadings
autoplot(prcomp(pcadat_gm12878_100kb_perc_histones),
         #loadings = TRUE,
         label = TRUE, 
         label.size = 3,
         label.repel=T) +
  theme_bw()
##kmeans clustering algorithm to group annotations
wss <- (nrow(pcadat_gm12878_100kb_perc_histones)-1)*sum(apply(pcadat_gm12878_100kb_perc_histones,2,var))
  for (i in 2:5) wss[i] <- sum(kmeans(pcadat_gm12878_100kb_perc_histones,
                                       centers=i, nstart=25, iter.max = 1000)$withinss)
plot(1:5, wss, type="b", xlab="Number of Clusters",
     ylab="Within groups sum of squares")

set.seed(1)
autoplot(kmeans(pcadat_gm12878_100kb_perc_histones, 4, nstart=25, iter.max = 1000),
         data=pcadat_gm12878_100kb_perc_histones,
         #frame = TRUE,
         #frame.type = 'norm',
         label = TRUE, 
         label.size = 3, 
         label.repel=T,
         label.show.legend = FALSE) + 
  #guides(fill=FALSE) +
  theme_bw()

```

#####Distance

```{r}
pcadat_gm12878_100kb_dist_histones <- pcadat_gm12878_100kb_dist[which(rownames(pcadat_gm12878_100kb_dist) %in% histonevars),]

##with loadings
autoplot(prcomp(pcadat_gm12878_100kb_dist_histones),
         loadings = TRUE,
         label = TRUE, 
         label.size = 3,
         label.repel=T) +
  theme_bw()
##without loadings
autoplot(prcomp(pcadat_gm12878_100kb_dist_histones),
         #loadings = TRUE,
         label = TRUE, 
         label.size = 3,
         label.repel=T) +
  theme_bw()
##kmeans clustering algorithm to group annotations
wss <- (nrow(pcadat_gm12878_100kb_dist_histones)-1)*sum(apply(pcadat_gm12878_100kb_dist_histones,2,var))
  for (i in 2:5) wss[i] <- sum(kmeans(pcadat_gm12878_100kb_dist_histones,
                                       centers=i, nstart=25, iter.max = 1000)$withinss)
plot(1:5, wss, type="b", xlab="Number of Clusters",
     ylab="Within groups sum of squares")

set.seed(1)
autoplot(kmeans(pcadat_gm12878_100kb_dist_histones, 4, nstart=25, iter.max = 1000),
         data=pcadat_gm12878_100kb_dist_histones,
         #frame = TRUE,
         #frame.type = 'norm',
         label = TRUE, 
         label.size = 3, 
         label.repel=T,
         label.show.legend = FALSE) + 
  #guides(fill=FALSE) +
  theme_bw()

```

#### TFBS

```{r}
tfbsvars <-  gsub(".bed","",list.files("Z:/TAD_data_analysis/annotations/tfbs/cell_type_specific/gm12878"))
```

##### Overlap Counts

```{r}
pcadat_gm12878_100kb_count_tfbs <- pcadat_gm12878_100kb_count[which(rownames(pcadat_gm12878_100kb_count) %in% tfbsvars),]

##with loadings
autoplot(prcomp(pcadat_gm12878_100kb_count_tfbs),
         loadings = TRUE,
         label = TRUE, 
         label.size = 3,
         label.repel=T) +
  theme_bw()
##without loadings
autoplot(prcomp(pcadat_gm12878_100kb_count_tfbs),
         #loadings = TRUE,
         label = TRUE, 
         label.size = 3,
         label.repel=T) +
  theme_bw()
##kmeans clustering algorithm to group annotations
wss <- (nrow(pcadat_gm12878_100kb_count_tfbs)-1)*sum(apply(pcadat_gm12878_100kb_count_tfbs,2,var))
  for (i in 2:50) wss[i] <- sum(kmeans(pcadat_gm12878_100kb_count_tfbs,
                                       centers=i, nstart=25, iter.max = 1000)$withinss)
plot(1:50, wss, type="b", xlab="Number of Clusters",
     ylab="Within groups sum of squares")

set.seed(1)
autoplot(kmeans(pcadat_gm12878_100kb_count_tfbs, 3, nstart=25, iter.max = 1000),
         data=pcadat_gm12878_100kb_count_tfbs,
         #frame = TRUE,
         #frame.type = 'norm',
         label = TRUE, 
         label.size = 3, 
         label.repel=T,
         label.show.legend = FALSE) + 
  #guides(fill=FALSE) +
  theme_bw()

```

##### Overlap Percents

```{r}
pcadat_gm12878_100kb_perc_tfbs <- pcadat_gm12878_100kb_perc[which(rownames(pcadat_gm12878_100kb_perc) %in% tfbsvars),]

##with loadings
autoplot(prcomp(pcadat_gm12878_100kb_perc_tfbs),
         loadings = TRUE,
         label = TRUE, 
         label.size = 3,
         label.repel=T) +
  theme_bw()
##without loadings
autoplot(prcomp(pcadat_gm12878_100kb_perc_tfbs),
         #loadings = TRUE,
         label = TRUE, 
         label.size = 3,
         label.repel=T) +
  theme_bw()
##kmeans clustering algorithm to group annotations
wss <- (nrow(pcadat_gm12878_100kb_perc_tfbs)-1)*sum(apply(pcadat_gm12878_100kb_perc_tfbs,2,var))
  for (i in 2:50) wss[i] <- sum(kmeans(pcadat_gm12878_100kb_perc_tfbs,
                                       centers=i, nstart=25, iter.max = 1000)$withinss)
plot(1:50, wss, type="b", xlab="Number of Clusters",
     ylab="Within groups sum of squares")

set.seed(1)
autoplot(kmeans(pcadat_gm12878_100kb_perc_tfbs, 4, nstart=25, iter.max = 1000),
         data=pcadat_gm12878_100kb_perc_tfbs,
         #frame = TRUE,
         #frame.type = 'norm',
         label = TRUE, 
         label.size = 3, 
         label.repel=T,
         label.show.legend = FALSE) + 
  #guides(fill=FALSE) +
  theme_bw()

```

#####Distance

```{r}
pcadat_gm12878_100kb_dist_tfbs <- pcadat_gm12878_100kb_dist[which(rownames(pcadat_gm12878_100kb_dist) %in% tfbsvars),]

##with loadings
autoplot(prcomp(pcadat_gm12878_100kb_dist_tfbs),
         loadings = TRUE,
         label = TRUE, 
         label.size = 3,
         label.repel=T) +
  theme_bw()
##without loadings
autoplot(prcomp(pcadat_gm12878_100kb_dist_tfbs),
         #loadings = TRUE,
         label = TRUE, 
         label.size = 3,
         label.repel=T) +
  theme_bw()
##kmeans clustering algorithm to group annotations
wss <- (nrow(pcadat_gm12878_100kb_dist_tfbs)-1)*sum(apply(pcadat_gm12878_100kb_dist_tfbs,2,var))
  for (i in 2:50) wss[i] <- sum(kmeans(pcadat_gm12878_100kb_dist_tfbs,
                                       centers=i, nstart=25, iter.max = 1000)$withinss)
plot(1:50, wss, type="b", xlab="Number of Clusters",
     ylab="Within groups sum of squares")

set.seed(1)
autoplot(kmeans(pcadat_gm12878_100kb_dist_tfbs, 5, nstart=25, iter.max = 1000),
         data=pcadat_gm12878_100kb_dist_tfbs,
         #frame = TRUE,
         #frame.type = 'norm',
         label = TRUE, 
         label.size = 3, 
         label.repel=T,
         label.show.legend = FALSE) + 
  #guides(fill=FALSE) +
  theme_bw()

```


## K562

### 10kb

```{r}
pcadat_K562_10kb_count <- readRDS("Z:/TAD_data_analysis/K562/10kb/Ensemble/PCA/pcadat_K562_10kb_count.rds")
pcadat_K562_10kb_perc <- readRDS("Z:/TAD_data_analysis/K562/10kb/Ensemble/PCA/pcadat_K562_10kb_perc.rds")
pcadat_K562_10kb_dist <- readRDS("Z:/TAD_data_analysis/K562/10kb/Ensemble/PCA/pcadat_K562_10kb_dist.rds")

#performing log2 transformation on distances
pcadat_K562_10kb_dist <- apply(pcadat_K562_10kb_dist,2,function(x){log(x + 1, base=2)})

cleancolnames <- function(x){gsub(paste(c("`", 
                                          "_",
                                          #"-",
                                          #"K562", 
                                          #"Haib", 
                                          #"Sydh",
                                          #"Uta",
                                          #"Uw",
                                          #"Broad",
                                          #"Uchicago",
                                          "dist",
                                          "count",
                                          "perc"), collapse = "|"),"", 
                                  colnames(x))}

colnames(pcadat_K562_10kb_count) <- cleancolnames(pcadat_K562_10kb_count)
colnames(pcadat_K562_10kb_perc) <- cleancolnames(pcadat_K562_10kb_perc)
colnames(pcadat_K562_10kb_dist) <- cleancolnames(pcadat_K562_10kb_dist)

pcadat_K562_10kb_count <- t(pcadat_K562_10kb_count)
pcadat_K562_10kb_perc <- t(pcadat_K562_10kb_perc)
pcadat_K562_10kb_dist <- t(pcadat_K562_10kb_dist)

#pcadat_K562_10kb_count <- data.frame(pcadat_K562_10kb_count)
#pcadat_K562_10kb_perc <- data.frame(pcadat_K562_10kb_perc)
#pcadat_K562_10kb_dist <- data.frame(pcadat_K562_10kb_dist)

#pcadat_K562_10kb_count$Type <- "Counts"
#pcadat_K562_10kb_perc$Type <- "Percent"
#pcadat_K562_10kb_dist$Type <- "Distance"

```

#### Chromatin States

```{r}
chromstatevars <- gsub(".bed","",list.files("Z:/TAD_data_analysis/annotations/BroadHMM"))
```

##### Overlap Counts

```{r}
pcadat_K562_10kb_count_chromstates <- pcadat_K562_10kb_count[which(rownames(pcadat_K562_10kb_count) %in% chromstatevars),]

##with loadings
autoplot(prcomp(pcadat_K562_10kb_count_chromstates),
         loadings = TRUE,
         label = TRUE, 
         label.size = 3,
         label.repel=T) +
  theme_bw()
##without loadings
autoplot(prcomp(pcadat_K562_10kb_count_chromstates),
         #loadings = TRUE,
         label = TRUE, 
         label.size = 3,
         label.repel=T) +
  theme_bw()
##kmeans clustering algorithm to group annotations
wss <- (nrow(pcadat_K562_10kb_count_chromstates)-1)*sum(apply(pcadat_K562_10kb_count_chromstates,2,var))
  for (i in 2:5) wss[i] <- sum(kmeans(pcadat_K562_10kb_count_chromstates,
                                       centers=i, nstart=25, iter.max = 1000)$withinss)
plot(1:5, wss, type="b", xlab="Number of Clusters",
     ylab="Within groups sum of squares")

set.seed(1)
autoplot(kmeans(pcadat_K562_10kb_count_chromstates, 3, nstart=25, iter.max = 1000),
         data=pcadat_K562_10kb_count_chromstates,
         #frame = TRUE,
         #frame.type = 'norm',
         label = TRUE, 
         label.size = 3, 
         label.repel=T,
         label.show.legend = FALSE) + 
  #guides(fill=FALSE) +
  theme_bw()

```

##### Overlap Percents

```{r}
pcadat_K562_10kb_perc_chromstates <- pcadat_K562_10kb_perc[which(rownames(pcadat_K562_10kb_perc) %in% chromstatevars),]

##with loadings
autoplot(prcomp(pcadat_K562_10kb_perc_chromstates),
         loadings = TRUE,
         label = TRUE, 
         label.size = 3,
         label.repel=T) +
  theme_bw()
##without loadings
autoplot(prcomp(pcadat_K562_10kb_perc_chromstates),
         #loadings = TRUE,
         label = TRUE, 
         label.size = 3,
         label.repel=T) +
  theme_bw()
##kmeans clustering algorithm to group annotations
wss <- (nrow(pcadat_K562_10kb_perc_chromstates)-1)*sum(apply(pcadat_K562_10kb_perc_chromstates,2,var))
  for (i in 2:5) wss[i] <- sum(kmeans(pcadat_K562_10kb_perc_chromstates,
                                       centers=i, nstart=25, iter.max = 1000)$withinss)
plot(1:5, wss, type="b", xlab="Number of Clusters",
     ylab="Within groups sum of squares")

set.seed(1)
autoplot(kmeans(pcadat_K562_10kb_perc_chromstates, 3, nstart=25, iter.max = 1000),
         data=pcadat_K562_10kb_perc_chromstates,
         #frame = TRUE,
         #frame.type = 'norm',
         label = TRUE, 
         label.size = 3, 
         label.repel=T,
         label.show.legend = FALSE) + 
  #guides(fill=FALSE) +
  theme_bw()

```

#####Distance

```{r}
pcadat_K562_10kb_dist_chromstates <- pcadat_K562_10kb_dist[which(rownames(pcadat_K562_10kb_dist) %in% chromstatevars),]

##with loadings
autoplot(prcomp(pcadat_K562_10kb_dist_chromstates),
         loadings = TRUE,
         label = TRUE, 
         label.size = 3,
         label.repel=T) +
  theme_bw()
##without loadings
autoplot(prcomp(pcadat_K562_10kb_dist_chromstates),
         #loadings = TRUE,
         label = TRUE, 
         label.size = 3,
         label.repel=T) +
  theme_bw()
##kmeans clustering algorithm to group annotations
wss <- (nrow(pcadat_K562_10kb_dist_chromstates)-1)*sum(apply(pcadat_K562_10kb_dist_chromstates,2,var))
  for (i in 2:5) wss[i] <- sum(kmeans(pcadat_K562_10kb_dist_chromstates,
                                       centers=i, nstart=25, iter.max = 1000)$withinss)
plot(1:5, wss, type="b", xlab="Number of Clusters",
     ylab="Within groups sum of squares")

set.seed(1)
autoplot(kmeans(pcadat_K562_10kb_dist_chromstates, 4, nstart=25, iter.max = 1000),
         data=pcadat_K562_10kb_dist_chromstates,
         #frame = TRUE,
         #frame.type = 'norm',
         label = TRUE, 
         label.size = 3, 
         label.repel=T,
         label.show.legend = FALSE) + 
  #guides(fill=FALSE) +
  theme_bw()

```

#### Histone Modifications

```{r}
histonevars <- gsub(".bed","",list.files("Z:/TAD_data_analysis/annotations/HistoneModifications"))
```

##### Overlap Counts

```{r}
pcadat_K562_10kb_count_histones <- pcadat_K562_10kb_count[which(rownames(pcadat_K562_10kb_count) %in% histonevars),]

##with loadings
autoplot(prcomp(pcadat_K562_10kb_count_histones),
         loadings = TRUE,
         label = TRUE, 
         label.size = 3,
         label.repel=T) +
  theme_bw()
##without loadings
autoplot(prcomp(pcadat_K562_10kb_count_histones),
         #loadings = TRUE,
         label = TRUE, 
         label.size = 3,
         label.repel=T) +
  theme_bw()
##kmeans clustering algorithm to group annotations
wss <- (nrow(pcadat_K562_10kb_count_histones)-1)*sum(apply(pcadat_K562_10kb_count_histones,2,var))
  for (i in 2:5) wss[i] <- sum(kmeans(pcadat_K562_10kb_count_histones,
                                       centers=i, nstart=25, iter.max = 1000)$withinss)
plot(1:5, wss, type="b", xlab="Number of Clusters",
     ylab="Within groups sum of squares")

set.seed(1)
autoplot(kmeans(pcadat_K562_10kb_count_histones, 3, nstart=25, iter.max = 1000),
         data=pcadat_K562_10kb_count_histones,
         #frame = TRUE,
         #frame.type = 'norm',
         label = TRUE, 
         label.size = 3, 
         label.repel=T,
         label.show.legend = FALSE) + 
  #guides(fill=FALSE) +
  theme_bw()

```

##### Overlap Percents

```{r}
pcadat_K562_10kb_perc_histones <- pcadat_K562_10kb_perc[which(rownames(pcadat_K562_10kb_perc) %in% histonevars),]

##with loadings
autoplot(prcomp(pcadat_K562_10kb_perc_histones),
         loadings = TRUE,
         label = TRUE, 
         label.size = 3,
         label.repel=T) +
  theme_bw()
##without loadings
autoplot(prcomp(pcadat_K562_10kb_perc_histones),
         #loadings = TRUE,
         label = TRUE, 
         label.size = 3,
         label.repel=T) +
  theme_bw()
##kmeans clustering algorithm to group annotations
wss <- (nrow(pcadat_K562_10kb_perc_histones)-1)*sum(apply(pcadat_K562_10kb_perc_histones,2,var))
  for (i in 2:5) wss[i] <- sum(kmeans(pcadat_K562_10kb_perc_histones,
                                       centers=i, nstart=25, iter.max = 1000)$withinss)
plot(1:5, wss, type="b", xlab="Number of Clusters",
     ylab="Within groups sum of squares")

set.seed(1)
autoplot(kmeans(pcadat_K562_10kb_perc_histones, 4, nstart=25, iter.max = 1000),
         data=pcadat_K562_10kb_perc_histones,
         #frame = TRUE,
         #frame.type = 'norm',
         label = TRUE, 
         label.size = 3, 
         label.repel=T,
         label.show.legend = FALSE) + 
  #guides(fill=FALSE) +
  theme_bw()

```

#####Distance

```{r}
pcadat_K562_10kb_dist_histones <- pcadat_K562_10kb_dist[which(rownames(pcadat_K562_10kb_dist) %in% histonevars),]

##with loadings
autoplot(prcomp(pcadat_K562_10kb_dist_histones),
         loadings = TRUE,
         label = TRUE, 
         label.size = 3,
         label.repel=T) +
  theme_bw()
##without loadings
autoplot(prcomp(pcadat_K562_10kb_dist_histones),
         #loadings = TRUE,
         label = TRUE, 
         label.size = 3,
         label.repel=T) +
  theme_bw()
##kmeans clustering algorithm to group annotations
wss <- (nrow(pcadat_K562_10kb_dist_histones)-1)*sum(apply(pcadat_K562_10kb_dist_histones,2,var))
  for (i in 2:5) wss[i] <- sum(kmeans(pcadat_K562_10kb_dist_histones,
                                       centers=i, nstart=25, iter.max = 1000)$withinss)
plot(1:5, wss, type="b", xlab="Number of Clusters",
     ylab="Within groups sum of squares")

set.seed(1)
autoplot(kmeans(pcadat_K562_10kb_dist_histones, 4, nstart=25, iter.max = 1000),
         data=pcadat_K562_10kb_dist_histones,
         #frame = TRUE,
         #frame.type = 'norm',
         label = TRUE, 
         label.size = 3, 
         label.repel=T,
         label.show.legend = FALSE) + 
  #guides(fill=FALSE) +
  theme_bw()

```

#### TFBS

```{r}
tfbsvars <-  gsub(".bed","",list.files("Z:/TAD_data_analysis/annotations/tfbs/cell_type_specific/K562"))
```

##### Overlap Counts

```{r}
pcadat_K562_10kb_count_tfbs <- pcadat_K562_10kb_count[which(rownames(pcadat_K562_10kb_count) %in% tfbsvars),]

##with loadings
autoplot(prcomp(pcadat_K562_10kb_count_tfbs),
         loadings = TRUE,
         label = TRUE, 
         label.size = 3,
         label.repel=T) +
  theme_bw()
##without loadings
autoplot(prcomp(pcadat_K562_10kb_count_tfbs),
         #loadings = TRUE,
         label = TRUE, 
         label.size = 3,
         label.repel=T) +
  theme_bw()
##kmeans clustering algorithm to group annotations
wss <- (nrow(pcadat_K562_10kb_count_tfbs)-1)*sum(apply(pcadat_K562_10kb_count_tfbs,2,var))
  for (i in 2:50) wss[i] <- sum(kmeans(pcadat_K562_10kb_count_tfbs,
                                       centers=i, nstart=25, iter.max = 1000)$withinss)
plot(1:50, wss, type="b", xlab="Number of Clusters",
     ylab="Within groups sum of squares")

set.seed(1)
autoplot(kmeans(pcadat_K562_10kb_count_tfbs, 3, nstart=25, iter.max = 1000),
         data=pcadat_K562_10kb_count_tfbs,
         #frame = TRUE,
         #frame.type = 'norm',
         label = TRUE, 
         label.size = 3, 
         label.repel=T,
         label.show.legend = FALSE) + 
  #guides(fill=FALSE) +
  theme_bw()

```

##### Overlap Percents

```{r}
pcadat_K562_10kb_perc_tfbs <- pcadat_K562_10kb_perc[which(rownames(pcadat_K562_10kb_perc) %in% tfbsvars),]

##with loadings
autoplot(prcomp(pcadat_K562_10kb_perc_tfbs),
         loadings = TRUE,
         label = TRUE, 
         label.size = 3,
         label.repel=T) +
  theme_bw()
##without loadings
autoplot(prcomp(pcadat_K562_10kb_perc_tfbs),
         #loadings = TRUE,
         label = TRUE, 
         label.size = 3,
         label.repel=T) +
  theme_bw()
##kmeans clustering algorithm to group annotations
wss <- (nrow(pcadat_K562_10kb_perc_tfbs)-1)*sum(apply(pcadat_K562_10kb_perc_tfbs,2,var))
  for (i in 2:50) wss[i] <- sum(kmeans(pcadat_K562_10kb_perc_tfbs,
                                       centers=i, nstart=25, iter.max = 1000)$withinss)
plot(1:50, wss, type="b", xlab="Number of Clusters",
     ylab="Within groups sum of squares")

set.seed(1)
autoplot(kmeans(pcadat_K562_10kb_perc_tfbs, 4, nstart=25, iter.max = 1000),
         data=pcadat_K562_10kb_perc_tfbs,
         #frame = TRUE,
         #frame.type = 'norm',
         label = TRUE, 
         label.size = 3, 
         label.repel=T,
         label.show.legend = FALSE) + 
  #guides(fill=FALSE) +
  theme_bw()

```

#####Distance

```{r}
pcadat_K562_10kb_dist_tfbs <- pcadat_K562_10kb_dist[which(rownames(pcadat_K562_10kb_dist) %in% tfbsvars),]

##with loadings
autoplot(prcomp(pcadat_K562_10kb_dist_tfbs),
         loadings = TRUE,
         label = TRUE, 
         label.size = 3,
         label.repel=T) +
  theme_bw()
##without loadings
autoplot(prcomp(pcadat_K562_10kb_dist_tfbs),
         #loadings = TRUE,
         label = TRUE, 
         label.size = 3,
         label.repel=T) +
  theme_bw()
##kmeans clustering algorithm to group annotations
wss <- (nrow(pcadat_K562_10kb_dist_tfbs)-1)*sum(apply(pcadat_K562_10kb_dist_tfbs,2,var))
  for (i in 2:50) wss[i] <- sum(kmeans(pcadat_K562_10kb_dist_tfbs,
                                       centers=i, nstart=25, iter.max = 1000)$withinss)
plot(1:50, wss, type="b", xlab="Number of Clusters",
     ylab="Within groups sum of squares")

set.seed(1)
autoplot(kmeans(pcadat_K562_10kb_dist_tfbs, 5, nstart=25, iter.max = 1000),
         data=pcadat_K562_10kb_dist_tfbs,
         #frame = TRUE,
         #frame.type = 'norm',
         label = TRUE, 
         label.size = 3, 
         label.repel=T,
         label.show.legend = FALSE) + 
  #guides(fill=FALSE) +
  theme_bw()

```

### 25kb

```{r}
pcadat_K562_25kb_count <- readRDS("Z:/TAD_data_analysis/K562/25kb/Ensemble/PCA/pcadat_K562_25kb_count.rds")
pcadat_K562_25kb_perc <- readRDS("Z:/TAD_data_analysis/K562/25kb/Ensemble/PCA/pcadat_K562_25kb_perc.rds")
pcadat_K562_25kb_dist <- readRDS("Z:/TAD_data_analysis/K562/25kb/Ensemble/PCA/pcadat_K562_25kb_dist.rds")

#performing log2 transformation on distances
pcadat_K562_25kb_dist <- apply(pcadat_K562_25kb_dist,2,function(x){log(x + 1, base=2)})

cleancolnames <- function(x){gsub(paste(c("`", 
                                          "_",
                                          #"-",
                                          #"K562", 
                                          #"Haib", 
                                          #"Sydh",
                                          #"Uta",
                                          #"Uw",
                                          #"Broad",
                                          #"Uchicago",
                                          "dist",
                                          "count",
                                          "perc"), collapse = "|"),"", 
                                  colnames(x))}

colnames(pcadat_K562_25kb_count) <- cleancolnames(pcadat_K562_25kb_count)
colnames(pcadat_K562_25kb_perc) <- cleancolnames(pcadat_K562_25kb_perc)
colnames(pcadat_K562_25kb_dist) <- cleancolnames(pcadat_K562_25kb_dist)

pcadat_K562_25kb_count <- t(pcadat_K562_25kb_count)
pcadat_K562_25kb_perc <- t(pcadat_K562_25kb_perc)
pcadat_K562_25kb_dist <- t(pcadat_K562_25kb_dist)

#pcadat_K562_25kb_count <- data.frame(pcadat_K562_25kb_count)
#pcadat_K562_25kb_perc <- data.frame(pcadat_K562_25kb_perc)
#pcadat_K562_25kb_dist <- data.frame(pcadat_K562_25kb_dist)

#pcadat_K562_25kb_count$Type <- "Counts"
#pcadat_K562_25kb_perc$Type <- "Percent"
#pcadat_K562_25kb_dist$Type <- "Distance"

```

#### Chromatin States

```{r}
chromstatevars <- gsub(".bed","",list.files("Z:/TAD_data_analysis/annotations/BroadHMM"))
```

##### Overlap Counts

```{r}
pcadat_K562_25kb_count_chromstates <- pcadat_K562_25kb_count[which(rownames(pcadat_K562_25kb_count) %in% chromstatevars),]

##with loadings
autoplot(prcomp(pcadat_K562_25kb_count_chromstates),
         loadings = TRUE,
         label = TRUE, 
         label.size = 3,
         label.repel=T) +
  theme_bw()
##without loadings
autoplot(prcomp(pcadat_K562_25kb_count_chromstates),
         #loadings = TRUE,
         label = TRUE, 
         label.size = 3,
         label.repel=T) +
  theme_bw()
##kmeans clustering algorithm to group annotations
wss <- (nrow(pcadat_K562_25kb_count_chromstates)-1)*sum(apply(pcadat_K562_25kb_count_chromstates,2,var))
  for (i in 2:5) wss[i] <- sum(kmeans(pcadat_K562_25kb_count_chromstates,
                                       centers=i, nstart=25, iter.max = 1000)$withinss)
plot(1:5, wss, type="b", xlab="Number of Clusters",
     ylab="Within groups sum of squares")

set.seed(1)
autoplot(kmeans(pcadat_K562_25kb_count_chromstates, 3, nstart=25, iter.max = 1000),
         data=pcadat_K562_25kb_count_chromstates,
         #frame = TRUE,
         #frame.type = 'norm',
         label = TRUE, 
         label.size = 3, 
         label.repel=T,
         label.show.legend = FALSE) + 
  #guides(fill=FALSE) +
  theme_bw()

```

##### Overlap Percents

```{r}
pcadat_K562_25kb_perc_chromstates <- pcadat_K562_25kb_perc[which(rownames(pcadat_K562_25kb_perc) %in% chromstatevars),]

##with loadings
autoplot(prcomp(pcadat_K562_25kb_perc_chromstates),
         loadings = TRUE,
         label = TRUE, 
         label.size = 3,
         label.repel=T) +
  theme_bw()
##without loadings
autoplot(prcomp(pcadat_K562_25kb_perc_chromstates),
         #loadings = TRUE,
         label = TRUE, 
         label.size = 3,
         label.repel=T) +
  theme_bw()
##kmeans clustering algorithm to group annotations
wss <- (nrow(pcadat_K562_25kb_perc_chromstates)-1)*sum(apply(pcadat_K562_25kb_perc_chromstates,2,var))
  for (i in 2:5) wss[i] <- sum(kmeans(pcadat_K562_25kb_perc_chromstates,
                                       centers=i, nstart=25, iter.max = 1000)$withinss)
plot(1:5, wss, type="b", xlab="Number of Clusters",
     ylab="Within groups sum of squares")

set.seed(1)
autoplot(kmeans(pcadat_K562_25kb_perc_chromstates, 3, nstart=25, iter.max = 1000),
         data=pcadat_K562_25kb_perc_chromstates,
         #frame = TRUE,
         #frame.type = 'norm',
         label = TRUE, 
         label.size = 3, 
         label.repel=T,
         label.show.legend = FALSE) + 
  #guides(fill=FALSE) +
  theme_bw()

```

#####Distance

```{r}
pcadat_K562_25kb_dist_chromstates <- pcadat_K562_25kb_dist[which(rownames(pcadat_K562_25kb_dist) %in% chromstatevars),]

##with loadings
autoplot(prcomp(pcadat_K562_25kb_dist_chromstates),
         loadings = TRUE,
         label = TRUE, 
         label.size = 3,
         label.repel=T) +
  theme_bw()
##without loadings
autoplot(prcomp(pcadat_K562_25kb_dist_chromstates),
         #loadings = TRUE,
         label = TRUE, 
         label.size = 3,
         label.repel=T) +
  theme_bw()
##kmeans clustering algorithm to group annotations
wss <- (nrow(pcadat_K562_25kb_dist_chromstates)-1)*sum(apply(pcadat_K562_25kb_dist_chromstates,2,var))
  for (i in 2:5) wss[i] <- sum(kmeans(pcadat_K562_25kb_dist_chromstates,
                                       centers=i, nstart=25, iter.max = 1000)$withinss)
plot(1:5, wss, type="b", xlab="Number of Clusters",
     ylab="Within groups sum of squares")

set.seed(1)
autoplot(kmeans(pcadat_K562_25kb_dist_chromstates, 4, nstart=25, iter.max = 1000),
         data=pcadat_K562_25kb_dist_chromstates,
         #frame = TRUE,
         #frame.type = 'norm',
         label = TRUE, 
         label.size = 3, 
         label.repel=T,
         label.show.legend = FALSE) + 
  #guides(fill=FALSE) +
  theme_bw()

```

#### Histone Modifications

```{r}
histonevars <- gsub(".bed","",list.files("Z:/TAD_data_analysis/annotations/HistoneModifications"))
```

##### Overlap Counts

```{r}
pcadat_K562_25kb_count_histones <- pcadat_K562_25kb_count[which(rownames(pcadat_K562_25kb_count) %in% histonevars),]

##with loadings
autoplot(prcomp(pcadat_K562_25kb_count_histones),
         loadings = TRUE,
         label = TRUE, 
         label.size = 3,
         label.repel=T) +
  theme_bw()
##without loadings
autoplot(prcomp(pcadat_K562_25kb_count_histones),
         #loadings = TRUE,
         label = TRUE, 
         label.size = 3,
         label.repel=T) +
  theme_bw()
##kmeans clustering algorithm to group annotations
wss <- (nrow(pcadat_K562_25kb_count_histones)-1)*sum(apply(pcadat_K562_25kb_count_histones,2,var))
  for (i in 2:5) wss[i] <- sum(kmeans(pcadat_K562_25kb_count_histones,
                                       centers=i, nstart=25, iter.max = 1000)$withinss)
plot(1:5, wss, type="b", xlab="Number of Clusters",
     ylab="Within groups sum of squares")

set.seed(1)
autoplot(kmeans(pcadat_K562_25kb_count_histones, 3, nstart=25, iter.max = 1000),
         data=pcadat_K562_25kb_count_histones,
         #frame = TRUE,
         #frame.type = 'norm',
         label = TRUE, 
         label.size = 3, 
         label.repel=T,
         label.show.legend = FALSE) + 
  #guides(fill=FALSE) +
  theme_bw()

```

##### Overlap Percents

```{r}
pcadat_K562_25kb_perc_histones <- pcadat_K562_25kb_perc[which(rownames(pcadat_K562_25kb_perc) %in% histonevars),]

##with loadings
autoplot(prcomp(pcadat_K562_25kb_perc_histones),
         loadings = TRUE,
         label = TRUE, 
         label.size = 3,
         label.repel=T) +
  theme_bw()
##without loadings
autoplot(prcomp(pcadat_K562_25kb_perc_histones),
         #loadings = TRUE,
         label = TRUE, 
         label.size = 3,
         label.repel=T) +
  theme_bw()
##kmeans clustering algorithm to group annotations
wss <- (nrow(pcadat_K562_25kb_perc_histones)-1)*sum(apply(pcadat_K562_25kb_perc_histones,2,var))
  for (i in 2:5) wss[i] <- sum(kmeans(pcadat_K562_25kb_perc_histones,
                                       centers=i, nstart=25, iter.max = 1000)$withinss)
plot(1:5, wss, type="b", xlab="Number of Clusters",
     ylab="Within groups sum of squares")

set.seed(1)
autoplot(kmeans(pcadat_K562_25kb_perc_histones, 4, nstart=25, iter.max = 1000),
         data=pcadat_K562_25kb_perc_histones,
         #frame = TRUE,
         #frame.type = 'norm',
         label = TRUE, 
         label.size = 3, 
         label.repel=T,
         label.show.legend = FALSE) + 
  #guides(fill=FALSE) +
  theme_bw()

```

#####Distance

```{r}
pcadat_K562_25kb_dist_histones <- pcadat_K562_25kb_dist[which(rownames(pcadat_K562_25kb_dist) %in% histonevars),]

##with loadings
autoplot(prcomp(pcadat_K562_25kb_dist_histones),
         loadings = TRUE,
         label = TRUE, 
         label.size = 3,
         label.repel=T) +
  theme_bw()
##without loadings
autoplot(prcomp(pcadat_K562_25kb_dist_histones),
         #loadings = TRUE,
         label = TRUE, 
         label.size = 3,
         label.repel=T) +
  theme_bw()
##kmeans clustering algorithm to group annotations
wss <- (nrow(pcadat_K562_25kb_dist_histones)-1)*sum(apply(pcadat_K562_25kb_dist_histones,2,var))
  for (i in 2:5) wss[i] <- sum(kmeans(pcadat_K562_25kb_dist_histones,
                                       centers=i, nstart=25, iter.max = 1000)$withinss)
plot(1:5, wss, type="b", xlab="Number of Clusters",
     ylab="Within groups sum of squares")

set.seed(1)
autoplot(kmeans(pcadat_K562_25kb_dist_histones, 4, nstart=25, iter.max = 1000),
         data=pcadat_K562_25kb_dist_histones,
         #frame = TRUE,
         #frame.type = 'norm',
         label = TRUE, 
         label.size = 3, 
         label.repel=T,
         label.show.legend = FALSE) + 
  #guides(fill=FALSE) +
  theme_bw()

```

#### TFBS

```{r}
tfbsvars <-  gsub(".bed","",list.files("Z:/TAD_data_analysis/annotations/tfbs/cell_type_specific/K562"))
```

##### Overlap Counts

```{r}
pcadat_K562_25kb_count_tfbs <- pcadat_K562_25kb_count[which(rownames(pcadat_K562_25kb_count) %in% tfbsvars),]

##with loadings
autoplot(prcomp(pcadat_K562_25kb_count_tfbs),
         loadings = TRUE,
         label = TRUE, 
         label.size = 3,
         label.repel=T) +
  theme_bw()
##without loadings
autoplot(prcomp(pcadat_K562_25kb_count_tfbs),
         #loadings = TRUE,
         label = TRUE, 
         label.size = 3,
         label.repel=T) +
  theme_bw()
##kmeans clustering algorithm to group annotations
wss <- (nrow(pcadat_K562_25kb_count_tfbs)-1)*sum(apply(pcadat_K562_25kb_count_tfbs,2,var))
  for (i in 2:50) wss[i] <- sum(kmeans(pcadat_K562_25kb_count_tfbs,
                                       centers=i, nstart=25, iter.max = 1000)$withinss)
plot(1:50, wss, type="b", xlab="Number of Clusters",
     ylab="Within groups sum of squares")

set.seed(1)
autoplot(kmeans(pcadat_K562_25kb_count_tfbs, 3, nstart=25, iter.max = 1000),
         data=pcadat_K562_25kb_count_tfbs,
         #frame = TRUE,
         #frame.type = 'norm',
         label = TRUE, 
         label.size = 3, 
         label.repel=T,
         label.show.legend = FALSE) + 
  #guides(fill=FALSE) +
  theme_bw()

```

##### Overlap Percents

```{r}
pcadat_K562_25kb_perc_tfbs <- pcadat_K562_25kb_perc[which(rownames(pcadat_K562_25kb_perc) %in% tfbsvars),]

##with loadings
autoplot(prcomp(pcadat_K562_25kb_perc_tfbs),
         loadings = TRUE,
         label = TRUE, 
         label.size = 3,
         label.repel=T) +
  theme_bw()
##without loadings
autoplot(prcomp(pcadat_K562_25kb_perc_tfbs),
         #loadings = TRUE,
         label = TRUE, 
         label.size = 3,
         label.repel=T) +
  theme_bw()
##kmeans clustering algorithm to group annotations
wss <- (nrow(pcadat_K562_25kb_perc_tfbs)-1)*sum(apply(pcadat_K562_25kb_perc_tfbs,2,var))
  for (i in 2:50) wss[i] <- sum(kmeans(pcadat_K562_25kb_perc_tfbs,
                                       centers=i, nstart=25, iter.max = 1000)$withinss)
plot(1:50, wss, type="b", xlab="Number of Clusters",
     ylab="Within groups sum of squares")

set.seed(1)
autoplot(kmeans(pcadat_K562_25kb_perc_tfbs, 4, nstart=25, iter.max = 1000),
         data=pcadat_K562_25kb_perc_tfbs,
         #frame = TRUE,
         #frame.type = 'norm',
         label = TRUE, 
         label.size = 3, 
         label.repel=T,
         label.show.legend = FALSE) + 
  #guides(fill=FALSE) +
  theme_bw()

```

#####Distance

```{r}
pcadat_K562_25kb_dist_tfbs <- pcadat_K562_25kb_dist[which(rownames(pcadat_K562_25kb_dist) %in% tfbsvars),]

##with loadings
autoplot(prcomp(pcadat_K562_25kb_dist_tfbs),
         loadings = TRUE,
         label = TRUE, 
         label.size = 3,
         label.repel=T) +
  theme_bw()
##without loadings
autoplot(prcomp(pcadat_K562_25kb_dist_tfbs),
         #loadings = TRUE,
         label = TRUE, 
         label.size = 3,
         label.repel=T) +
  theme_bw()
##kmeans clustering algorithm to group annotations
wss <- (nrow(pcadat_K562_25kb_dist_tfbs)-1)*sum(apply(pcadat_K562_25kb_dist_tfbs,2,var))
  for (i in 2:50) wss[i] <- sum(kmeans(pcadat_K562_25kb_dist_tfbs,
                                       centers=i, nstart=25, iter.max = 1000)$withinss)
plot(1:50, wss, type="b", xlab="Number of Clusters",
     ylab="Within groups sum of squares")

set.seed(1)
autoplot(kmeans(pcadat_K562_25kb_dist_tfbs, 5, nstart=25, iter.max = 1000),
         data=pcadat_K562_25kb_dist_tfbs,
         #frame = TRUE,
         #frame.type = 'norm',
         label = TRUE, 
         label.size = 3, 
         label.repel=T,
         label.show.legend = FALSE) + 
  #guides(fill=FALSE) +
  theme_bw()

```

### 50kb

```{r}
pcadat_K562_50kb_count <- readRDS("Z:/TAD_data_analysis/K562/50kb/Ensemble/PCA/pcadat_K562_50kb_count.rds")
pcadat_K562_50kb_perc <- readRDS("Z:/TAD_data_analysis/K562/50kb/Ensemble/PCA/pcadat_K562_50kb_perc.rds")
pcadat_K562_50kb_dist <- readRDS("Z:/TAD_data_analysis/K562/50kb/Ensemble/PCA/pcadat_K562_50kb_dist.rds")

#performing log2 transformation on distances
pcadat_K562_50kb_dist <- apply(pcadat_K562_50kb_dist,2,function(x){log(x + 1, base=2)})

cleancolnames <- function(x){gsub(paste(c("`", 
                                          "_",
                                          #"-",
                                          #"K562", 
                                          #"Haib", 
                                          #"Sydh",
                                          #"Uta",
                                          #"Uw",
                                          #"Broad",
                                          #"Uchicago",
                                          "dist",
                                          "count",
                                          "perc"), collapse = "|"),"", 
                                  colnames(x))}

colnames(pcadat_K562_50kb_count) <- cleancolnames(pcadat_K562_50kb_count)
colnames(pcadat_K562_50kb_perc) <- cleancolnames(pcadat_K562_50kb_perc)
colnames(pcadat_K562_50kb_dist) <- cleancolnames(pcadat_K562_50kb_dist)

pcadat_K562_50kb_count <- t(pcadat_K562_50kb_count)
pcadat_K562_50kb_perc <- t(pcadat_K562_50kb_perc)
pcadat_K562_50kb_dist <- t(pcadat_K562_50kb_dist)

#pcadat_K562_50kb_count <- data.frame(pcadat_K562_50kb_count)
#pcadat_K562_50kb_perc <- data.frame(pcadat_K562_50kb_perc)
#pcadat_K562_50kb_dist <- data.frame(pcadat_K562_50kb_dist)

#pcadat_K562_50kb_count$Type <- "Counts"
#pcadat_K562_50kb_perc$Type <- "Percent"
#pcadat_K562_50kb_dist$Type <- "Distance"

```

#### Chromatin States

```{r}
chromstatevars <- gsub(".bed","",list.files("Z:/TAD_data_analysis/annotations/BroadHMM"))
```

##### Overlap Counts

```{r}
pcadat_K562_50kb_count_chromstates <- pcadat_K562_50kb_count[which(rownames(pcadat_K562_50kb_count) %in% chromstatevars),]

##with loadings
autoplot(prcomp(pcadat_K562_50kb_count_chromstates),
         loadings = TRUE,
         label = TRUE, 
         label.size = 3,
         label.repel=T) +
  theme_bw()
##without loadings
autoplot(prcomp(pcadat_K562_50kb_count_chromstates),
         #loadings = TRUE,
         label = TRUE, 
         label.size = 3,
         label.repel=T) +
  theme_bw()
##kmeans clustering algorithm to group annotations
wss <- (nrow(pcadat_K562_50kb_count_chromstates)-1)*sum(apply(pcadat_K562_50kb_count_chromstates,2,var))
  for (i in 2:5) wss[i] <- sum(kmeans(pcadat_K562_50kb_count_chromstates,
                                       centers=i, nstart=25, iter.max = 1000)$withinss)
plot(1:5, wss, type="b", xlab="Number of Clusters",
     ylab="Within groups sum of squares")

set.seed(1)
autoplot(kmeans(pcadat_K562_50kb_count_chromstates, 3, nstart=25, iter.max = 1000),
         data=pcadat_K562_50kb_count_chromstates,
         #frame = TRUE,
         #frame.type = 'norm',
         label = TRUE, 
         label.size = 3, 
         label.repel=T,
         label.show.legend = FALSE) + 
  #guides(fill=FALSE) +
  theme_bw()

```

##### Overlap Percents

```{r}
pcadat_K562_50kb_perc_chromstates <- pcadat_K562_50kb_perc[which(rownames(pcadat_K562_50kb_perc) %in% chromstatevars),]

##with loadings
autoplot(prcomp(pcadat_K562_50kb_perc_chromstates),
         loadings = TRUE,
         label = TRUE, 
         label.size = 3,
         label.repel=T) +
  theme_bw()
##without loadings
autoplot(prcomp(pcadat_K562_50kb_perc_chromstates),
         #loadings = TRUE,
         label = TRUE, 
         label.size = 3,
         label.repel=T) +
  theme_bw()
##kmeans clustering algorithm to group annotations
wss <- (nrow(pcadat_K562_50kb_perc_chromstates)-1)*sum(apply(pcadat_K562_50kb_perc_chromstates,2,var))
  for (i in 2:5) wss[i] <- sum(kmeans(pcadat_K562_50kb_perc_chromstates,
                                       centers=i, nstart=25, iter.max = 1000)$withinss)
plot(1:5, wss, type="b", xlab="Number of Clusters",
     ylab="Within groups sum of squares")

set.seed(1)
autoplot(kmeans(pcadat_K562_50kb_perc_chromstates, 3, nstart=25, iter.max = 1000),
         data=pcadat_K562_50kb_perc_chromstates,
         #frame = TRUE,
         #frame.type = 'norm',
         label = TRUE, 
         label.size = 3, 
         label.repel=T,
         label.show.legend = FALSE) + 
  #guides(fill=FALSE) +
  theme_bw()

```

#####Distance

```{r}
pcadat_K562_50kb_dist_chromstates <- pcadat_K562_50kb_dist[which(rownames(pcadat_K562_50kb_dist) %in% chromstatevars),]

##with loadings
autoplot(prcomp(pcadat_K562_50kb_dist_chromstates),
         loadings = TRUE,
         label = TRUE, 
         label.size = 3,
         label.repel=T) +
  theme_bw()
##without loadings
autoplot(prcomp(pcadat_K562_50kb_dist_chromstates),
         #loadings = TRUE,
         label = TRUE, 
         label.size = 3,
         label.repel=T) +
  theme_bw()
##kmeans clustering algorithm to group annotations
wss <- (nrow(pcadat_K562_50kb_dist_chromstates)-1)*sum(apply(pcadat_K562_50kb_dist_chromstates,2,var))
  for (i in 2:5) wss[i] <- sum(kmeans(pcadat_K562_50kb_dist_chromstates,
                                       centers=i, nstart=25, iter.max = 1000)$withinss)
plot(1:5, wss, type="b", xlab="Number of Clusters",
     ylab="Within groups sum of squares")

set.seed(1)
autoplot(kmeans(pcadat_K562_50kb_dist_chromstates, 4, nstart=25, iter.max = 1000),
         data=pcadat_K562_50kb_dist_chromstates,
         #frame = TRUE,
         #frame.type = 'norm',
         label = TRUE, 
         label.size = 3, 
         label.repel=T,
         label.show.legend = FALSE) + 
  #guides(fill=FALSE) +
  theme_bw()

```

#### Histone Modifications

```{r}
histonevars <- gsub(".bed","",list.files("Z:/TAD_data_analysis/annotations/HistoneModifications"))
```

##### Overlap Counts

```{r}
pcadat_K562_50kb_count_histones <- pcadat_K562_50kb_count[which(rownames(pcadat_K562_50kb_count) %in% histonevars),]

##with loadings
autoplot(prcomp(pcadat_K562_50kb_count_histones),
         loadings = TRUE,
         label = TRUE, 
         label.size = 3,
         label.repel=T) +
  theme_bw()
##without loadings
autoplot(prcomp(pcadat_K562_50kb_count_histones),
         #loadings = TRUE,
         label = TRUE, 
         label.size = 3,
         label.repel=T) +
  theme_bw()
##kmeans clustering algorithm to group annotations
wss <- (nrow(pcadat_K562_50kb_count_histones)-1)*sum(apply(pcadat_K562_50kb_count_histones,2,var))
  for (i in 2:5) wss[i] <- sum(kmeans(pcadat_K562_50kb_count_histones,
                                       centers=i, nstart=25, iter.max = 1000)$withinss)
plot(1:5, wss, type="b", xlab="Number of Clusters",
     ylab="Within groups sum of squares")

set.seed(1)
autoplot(kmeans(pcadat_K562_50kb_count_histones, 3, nstart=25, iter.max = 1000),
         data=pcadat_K562_50kb_count_histones,
         #frame = TRUE,
         #frame.type = 'norm',
         label = TRUE, 
         label.size = 3, 
         label.repel=T,
         label.show.legend = FALSE) + 
  #guides(fill=FALSE) +
  theme_bw()

```

##### Overlap Percents

```{r}
pcadat_K562_50kb_perc_histones <- pcadat_K562_50kb_perc[which(rownames(pcadat_K562_50kb_perc) %in% histonevars),]

##with loadings
autoplot(prcomp(pcadat_K562_50kb_perc_histones),
         loadings = TRUE,
         label = TRUE, 
         label.size = 3,
         label.repel=T) +
  theme_bw()
##without loadings
autoplot(prcomp(pcadat_K562_50kb_perc_histones),
         #loadings = TRUE,
         label = TRUE, 
         label.size = 3,
         label.repel=T) +
  theme_bw()
##kmeans clustering algorithm to group annotations
wss <- (nrow(pcadat_K562_50kb_perc_histones)-1)*sum(apply(pcadat_K562_50kb_perc_histones,2,var))
  for (i in 2:5) wss[i] <- sum(kmeans(pcadat_K562_50kb_perc_histones,
                                       centers=i, nstart=25, iter.max = 1000)$withinss)
plot(1:5, wss, type="b", xlab="Number of Clusters",
     ylab="Within groups sum of squares")

set.seed(1)
autoplot(kmeans(pcadat_K562_50kb_perc_histones, 4, nstart=25, iter.max = 1000),
         data=pcadat_K562_50kb_perc_histones,
         #frame = TRUE,
         #frame.type = 'norm',
         label = TRUE, 
         label.size = 3, 
         label.repel=T,
         label.show.legend = FALSE) + 
  #guides(fill=FALSE) +
  theme_bw()

```

#####Distance

```{r}
pcadat_K562_50kb_dist_histones <- pcadat_K562_50kb_dist[which(rownames(pcadat_K562_50kb_dist) %in% histonevars),]

##with loadings
autoplot(prcomp(pcadat_K562_50kb_dist_histones),
         loadings = TRUE,
         label = TRUE, 
         label.size = 3,
         label.repel=T) +
  theme_bw()
##without loadings
autoplot(prcomp(pcadat_K562_50kb_dist_histones),
         #loadings = TRUE,
         label = TRUE, 
         label.size = 3,
         label.repel=T) +
  theme_bw()
##kmeans clustering algorithm to group annotations
wss <- (nrow(pcadat_K562_50kb_dist_histones)-1)*sum(apply(pcadat_K562_50kb_dist_histones,2,var))
  for (i in 2:5) wss[i] <- sum(kmeans(pcadat_K562_50kb_dist_histones,
                                       centers=i, nstart=25, iter.max = 1000)$withinss)
plot(1:5, wss, type="b", xlab="Number of Clusters",
     ylab="Within groups sum of squares")

set.seed(1)
autoplot(kmeans(pcadat_K562_50kb_dist_histones, 4, nstart=25, iter.max = 1000),
         data=pcadat_K562_50kb_dist_histones,
         #frame = TRUE,
         #frame.type = 'norm',
         label = TRUE, 
         label.size = 3, 
         label.repel=T,
         label.show.legend = FALSE) + 
  #guides(fill=FALSE) +
  theme_bw()

```

#### TFBS

```{r}
tfbsvars <-  gsub(".bed","",list.files("Z:/TAD_data_analysis/annotations/tfbs/cell_type_specific/K562"))
```

##### Overlap Counts

```{r}
pcadat_K562_50kb_count_tfbs <- pcadat_K562_50kb_count[which(rownames(pcadat_K562_50kb_count) %in% tfbsvars),]

##with loadings
autoplot(prcomp(pcadat_K562_50kb_count_tfbs),
         loadings = TRUE,
         label = TRUE, 
         label.size = 3,
         label.repel=T) +
  theme_bw()
##without loadings
autoplot(prcomp(pcadat_K562_50kb_count_tfbs),
         #loadings = TRUE,
         label = TRUE, 
         label.size = 3,
         label.repel=T) +
  theme_bw()
##kmeans clustering algorithm to group annotations
wss <- (nrow(pcadat_K562_50kb_count_tfbs)-1)*sum(apply(pcadat_K562_50kb_count_tfbs,2,var))
  for (i in 2:50) wss[i] <- sum(kmeans(pcadat_K562_50kb_count_tfbs,
                                       centers=i, nstart=25, iter.max = 1000)$withinss)
plot(1:50, wss, type="b", xlab="Number of Clusters",
     ylab="Within groups sum of squares")

set.seed(1)
autoplot(kmeans(pcadat_K562_50kb_count_tfbs, 3, nstart=25, iter.max = 1000),
         data=pcadat_K562_50kb_count_tfbs,
         #frame = TRUE,
         #frame.type = 'norm',
         label = TRUE, 
         label.size = 3, 
         label.repel=T,
         label.show.legend = FALSE) + 
  #guides(fill=FALSE) +
  theme_bw()

```

##### Overlap Percents

```{r}
pcadat_K562_50kb_perc_tfbs <- pcadat_K562_50kb_perc[which(rownames(pcadat_K562_50kb_perc) %in% tfbsvars),]

##with loadings
autoplot(prcomp(pcadat_K562_50kb_perc_tfbs),
         loadings = TRUE,
         label = TRUE, 
         label.size = 3,
         label.repel=T) +
  theme_bw()
##without loadings
autoplot(prcomp(pcadat_K562_50kb_perc_tfbs),
         #loadings = TRUE,
         label = TRUE, 
         label.size = 3,
         label.repel=T) +
  theme_bw()
##kmeans clustering algorithm to group annotations
wss <- (nrow(pcadat_K562_50kb_perc_tfbs)-1)*sum(apply(pcadat_K562_50kb_perc_tfbs,2,var))
  for (i in 2:50) wss[i] <- sum(kmeans(pcadat_K562_50kb_perc_tfbs,
                                       centers=i, nstart=25, iter.max = 1000)$withinss)
plot(1:50, wss, type="b", xlab="Number of Clusters",
     ylab="Within groups sum of squares")

set.seed(1)
autoplot(kmeans(pcadat_K562_50kb_perc_tfbs, 4, nstart=25, iter.max = 1000),
         data=pcadat_K562_50kb_perc_tfbs,
         #frame = TRUE,
         #frame.type = 'norm',
         label = TRUE, 
         label.size = 3, 
         label.repel=T,
         label.show.legend = FALSE) + 
  #guides(fill=FALSE) +
  theme_bw()

```

#####Distance

```{r}
pcadat_K562_50kb_dist_tfbs <- pcadat_K562_50kb_dist[which(rownames(pcadat_K562_50kb_dist) %in% tfbsvars),]

##with loadings
autoplot(prcomp(pcadat_K562_50kb_dist_tfbs),
         loadings = TRUE,
         label = TRUE, 
         label.size = 3,
         label.repel=T) +
  theme_bw()
##without loadings
autoplot(prcomp(pcadat_K562_50kb_dist_tfbs),
         #loadings = TRUE,
         label = TRUE, 
         label.size = 3,
         label.repel=T) +
  theme_bw()
##kmeans clustering algorithm to group annotations
wss <- (nrow(pcadat_K562_50kb_dist_tfbs)-1)*sum(apply(pcadat_K562_50kb_dist_tfbs,2,var))
  for (i in 2:50) wss[i] <- sum(kmeans(pcadat_K562_50kb_dist_tfbs,
                                       centers=i, nstart=25, iter.max = 1000)$withinss)
plot(1:50, wss, type="b", xlab="Number of Clusters",
     ylab="Within groups sum of squares")

set.seed(1)
autoplot(kmeans(pcadat_K562_50kb_dist_tfbs, 5, nstart=25, iter.max = 1000),
         data=pcadat_K562_50kb_dist_tfbs,
         #frame = TRUE,
         #frame.type = 'norm',
         label = TRUE, 
         label.size = 3, 
         label.repel=T,
         label.show.legend = FALSE) + 
  #guides(fill=FALSE) +
  theme_bw()

```

### 100kb

```{r}
pcadat_K562_100kb_count <- readRDS("Z:/TAD_data_analysis/K562/100kb/Ensemble/PCA/pcadat_K562_100kb_count.rds")
pcadat_K562_100kb_perc <- readRDS("Z:/TAD_data_analysis/K562/100kb/Ensemble/PCA/pcadat_K562_100kb_perc.rds")
pcadat_K562_100kb_dist <- readRDS("Z:/TAD_data_analysis/K562/100kb/Ensemble/PCA/pcadat_K562_100kb_dist.rds")

#performing log2 transformation on distances
pcadat_K562_100kb_dist <- apply(pcadat_K562_100kb_dist,2,function(x){log(x + 1, base=2)})

cleancolnames <- function(x){gsub(paste(c("`", 
                                          "_",
                                          #"-",
                                          #"K562", 
                                          #"Haib", 
                                          #"Sydh",
                                          #"Uta",
                                          #"Uw",
                                          #"Broad",
                                          #"Uchicago",
                                          "dist",
                                          "count",
                                          "perc"), collapse = "|"),"", 
                                  colnames(x))}

colnames(pcadat_K562_100kb_count) <- cleancolnames(pcadat_K562_100kb_count)
colnames(pcadat_K562_100kb_perc) <- cleancolnames(pcadat_K562_100kb_perc)
colnames(pcadat_K562_100kb_dist) <- cleancolnames(pcadat_K562_100kb_dist)

pcadat_K562_100kb_count <- t(pcadat_K562_100kb_count)
pcadat_K562_100kb_perc <- t(pcadat_K562_100kb_perc)
pcadat_K562_100kb_dist <- t(pcadat_K562_100kb_dist)

#pcadat_K562_100kb_count <- data.frame(pcadat_K562_100kb_count)
#pcadat_K562_100kb_perc <- data.frame(pcadat_K562_100kb_perc)
#pcadat_K562_100kb_dist <- data.frame(pcadat_K562_100kb_dist)

#pcadat_K562_100kb_count$Type <- "Counts"
#pcadat_K562_100kb_perc$Type <- "Percent"
#pcadat_K562_100kb_dist$Type <- "Distance"

```

#### Chromatin States

```{r}
chromstatevars <- gsub(".bed","",list.files("Z:/TAD_data_analysis/annotations/BroadHMM"))
```

##### Overlap Counts

```{r}
pcadat_K562_100kb_count_chromstates <- pcadat_K562_100kb_count[which(rownames(pcadat_K562_100kb_count) %in% chromstatevars),]

##with loadings
autoplot(prcomp(pcadat_K562_100kb_count_chromstates),
         loadings = TRUE,
         label = TRUE, 
         label.size = 3,
         label.repel=T) +
  theme_bw()
##without loadings
autoplot(prcomp(pcadat_K562_100kb_count_chromstates),
         #loadings = TRUE,
         label = TRUE, 
         label.size = 3,
         label.repel=T) +
  theme_bw()
##kmeans clustering algorithm to group annotations
wss <- (nrow(pcadat_K562_100kb_count_chromstates)-1)*sum(apply(pcadat_K562_100kb_count_chromstates,2,var))
  for (i in 2:5) wss[i] <- sum(kmeans(pcadat_K562_100kb_count_chromstates,
                                       centers=i, nstart=25, iter.max = 1000)$withinss)
plot(1:5, wss, type="b", xlab="Number of Clusters",
     ylab="Within groups sum of squares")

set.seed(1)
autoplot(kmeans(pcadat_K562_100kb_count_chromstates, 3, nstart=25, iter.max = 1000),
         data=pcadat_K562_100kb_count_chromstates,
         #frame = TRUE,
         #frame.type = 'norm',
         label = TRUE, 
         label.size = 3, 
         label.repel=T,
         label.show.legend = FALSE) + 
  #guides(fill=FALSE) +
  theme_bw()

```

##### Overlap Percents

```{r}
pcadat_K562_100kb_perc_chromstates <- pcadat_K562_100kb_perc[which(rownames(pcadat_K562_100kb_perc) %in% chromstatevars),]

##with loadings
autoplot(prcomp(pcadat_K562_100kb_perc_chromstates),
         loadings = TRUE,
         label = TRUE, 
         label.size = 3,
         label.repel=T) +
  theme_bw()
##without loadings
autoplot(prcomp(pcadat_K562_100kb_perc_chromstates),
         #loadings = TRUE,
         label = TRUE, 
         label.size = 3,
         label.repel=T) +
  theme_bw()
##kmeans clustering algorithm to group annotations
wss <- (nrow(pcadat_K562_100kb_perc_chromstates)-1)*sum(apply(pcadat_K562_100kb_perc_chromstates,2,var))
  for (i in 2:5) wss[i] <- sum(kmeans(pcadat_K562_100kb_perc_chromstates,
                                       centers=i, nstart=25, iter.max = 1000)$withinss)
plot(1:5, wss, type="b", xlab="Number of Clusters",
     ylab="Within groups sum of squares")

set.seed(1)
autoplot(kmeans(pcadat_K562_100kb_perc_chromstates, 3, nstart=25, iter.max = 1000),
         data=pcadat_K562_100kb_perc_chromstates,
         #frame = TRUE,
         #frame.type = 'norm',
         label = TRUE, 
         label.size = 3, 
         label.repel=T,
         label.show.legend = FALSE) + 
  #guides(fill=FALSE) +
  theme_bw()

```

#####Distance

```{r}
pcadat_K562_100kb_dist_chromstates <- pcadat_K562_100kb_dist[which(rownames(pcadat_K562_100kb_dist) %in% chromstatevars),]

##with loadings
autoplot(prcomp(pcadat_K562_100kb_dist_chromstates),
         loadings = TRUE,
         label = TRUE, 
         label.size = 3,
         label.repel=T) +
  theme_bw()
##without loadings
autoplot(prcomp(pcadat_K562_100kb_dist_chromstates),
         #loadings = TRUE,
         label = TRUE, 
         label.size = 3,
         label.repel=T) +
  theme_bw()
##kmeans clustering algorithm to group annotations
wss <- (nrow(pcadat_K562_100kb_dist_chromstates)-1)*sum(apply(pcadat_K562_100kb_dist_chromstates,2,var))
  for (i in 2:5) wss[i] <- sum(kmeans(pcadat_K562_100kb_dist_chromstates,
                                       centers=i, nstart=25, iter.max = 1000)$withinss)
plot(1:5, wss, type="b", xlab="Number of Clusters",
     ylab="Within groups sum of squares")

set.seed(1)
autoplot(kmeans(pcadat_K562_100kb_dist_chromstates, 4, nstart=25, iter.max = 1000),
         data=pcadat_K562_100kb_dist_chromstates,
         #frame = TRUE,
         #frame.type = 'norm',
         label = TRUE, 
         label.size = 3, 
         label.repel=T,
         label.show.legend = FALSE) + 
  #guides(fill=FALSE) +
  theme_bw()

```

#### Histone Modifications

```{r}
histonevars <- gsub(".bed","",list.files("Z:/TAD_data_analysis/annotations/HistoneModifications"))
```

##### Overlap Counts

```{r}
pcadat_K562_100kb_count_histones <- pcadat_K562_100kb_count[which(rownames(pcadat_K562_100kb_count) %in% histonevars),]

##with loadings
autoplot(prcomp(pcadat_K562_100kb_count_histones),
         loadings = TRUE,
         label = TRUE, 
         label.size = 3,
         label.repel=T) +
  theme_bw()
##without loadings
autoplot(prcomp(pcadat_K562_100kb_count_histones),
         #loadings = TRUE,
         label = TRUE, 
         label.size = 3,
         label.repel=T) +
  theme_bw()
##kmeans clustering algorithm to group annotations
wss <- (nrow(pcadat_K562_100kb_count_histones)-1)*sum(apply(pcadat_K562_100kb_count_histones,2,var))
  for (i in 2:5) wss[i] <- sum(kmeans(pcadat_K562_100kb_count_histones,
                                       centers=i, nstart=25, iter.max = 1000)$withinss)
plot(1:5, wss, type="b", xlab="Number of Clusters",
     ylab="Within groups sum of squares")

set.seed(1)
autoplot(kmeans(pcadat_K562_100kb_count_histones, 3, nstart=25, iter.max = 1000),
         data=pcadat_K562_100kb_count_histones,
         #frame = TRUE,
         #frame.type = 'norm',
         label = TRUE, 
         label.size = 3, 
         label.repel=T,
         label.show.legend = FALSE) + 
  #guides(fill=FALSE) +
  theme_bw()

```

##### Overlap Percents

```{r}
pcadat_K562_100kb_perc_histones <- pcadat_K562_100kb_perc[which(rownames(pcadat_K562_100kb_perc) %in% histonevars),]

##with loadings
autoplot(prcomp(pcadat_K562_100kb_perc_histones),
         loadings = TRUE,
         label = TRUE, 
         label.size = 3,
         label.repel=T) +
  theme_bw()
##without loadings
autoplot(prcomp(pcadat_K562_100kb_perc_histones),
         #loadings = TRUE,
         label = TRUE, 
         label.size = 3,
         label.repel=T) +
  theme_bw()
##kmeans clustering algorithm to group annotations
wss <- (nrow(pcadat_K562_100kb_perc_histones)-1)*sum(apply(pcadat_K562_100kb_perc_histones,2,var))
  for (i in 2:5) wss[i] <- sum(kmeans(pcadat_K562_100kb_perc_histones,
                                       centers=i, nstart=25, iter.max = 1000)$withinss)
plot(1:5, wss, type="b", xlab="Number of Clusters",
     ylab="Within groups sum of squares")

set.seed(1)
autoplot(kmeans(pcadat_K562_100kb_perc_histones, 4, nstart=25, iter.max = 1000),
         data=pcadat_K562_100kb_perc_histones,
         #frame = TRUE,
         #frame.type = 'norm',
         label = TRUE, 
         label.size = 3, 
         label.repel=T,
         label.show.legend = FALSE) + 
  #guides(fill=FALSE) +
  theme_bw()

```

#####Distance

```{r}
pcadat_K562_100kb_dist_histones <- pcadat_K562_100kb_dist[which(rownames(pcadat_K562_100kb_dist) %in% histonevars),]

##with loadings
autoplot(prcomp(pcadat_K562_100kb_dist_histones),
         loadings = TRUE,
         label = TRUE, 
         label.size = 3,
         label.repel=T) +
  theme_bw()
##without loadings
autoplot(prcomp(pcadat_K562_100kb_dist_histones),
         #loadings = TRUE,
         label = TRUE, 
         label.size = 3,
         label.repel=T) +
  theme_bw()
##kmeans clustering algorithm to group annotations
wss <- (nrow(pcadat_K562_100kb_dist_histones)-1)*sum(apply(pcadat_K562_100kb_dist_histones,2,var))
  for (i in 2:5) wss[i] <- sum(kmeans(pcadat_K562_100kb_dist_histones,
                                       centers=i, nstart=25, iter.max = 1000)$withinss)
plot(1:5, wss, type="b", xlab="Number of Clusters",
     ylab="Within groups sum of squares")

set.seed(1)
autoplot(kmeans(pcadat_K562_100kb_dist_histones, 4, nstart=25, iter.max = 1000),
         data=pcadat_K562_100kb_dist_histones,
         #frame = TRUE,
         #frame.type = 'norm',
         label = TRUE, 
         label.size = 3, 
         label.repel=T,
         label.show.legend = FALSE) + 
  #guides(fill=FALSE) +
  theme_bw()

```

#### TFBS

```{r}
tfbsvars <-  gsub(".bed","",list.files("Z:/TAD_data_analysis/annotations/tfbs/cell_type_specific/K562"))
```

##### Overlap Counts

```{r}
pcadat_K562_100kb_count_tfbs <- pcadat_K562_100kb_count[which(rownames(pcadat_K562_100kb_count) %in% tfbsvars),]

##with loadings
autoplot(prcomp(pcadat_K562_100kb_count_tfbs),
         loadings = TRUE,
         label = TRUE, 
         label.size = 3,
         label.repel=T) +
  theme_bw()
##without loadings
autoplot(prcomp(pcadat_K562_100kb_count_tfbs),
         #loadings = TRUE,
         label = TRUE, 
         label.size = 3,
         label.repel=T) +
  theme_bw()
##kmeans clustering algorithm to group annotations
wss <- (nrow(pcadat_K562_100kb_count_tfbs)-1)*sum(apply(pcadat_K562_100kb_count_tfbs,2,var))
  for (i in 2:50) wss[i] <- sum(kmeans(pcadat_K562_100kb_count_tfbs,
                                       centers=i, nstart=25, iter.max = 1000)$withinss)
plot(1:50, wss, type="b", xlab="Number of Clusters",
     ylab="Within groups sum of squares")

set.seed(1)
autoplot(kmeans(pcadat_K562_100kb_count_tfbs, 3, nstart=25, iter.max = 1000),
         data=pcadat_K562_100kb_count_tfbs,
         #frame = TRUE,
         #frame.type = 'norm',
         label = TRUE, 
         label.size = 3, 
         label.repel=T,
         label.show.legend = FALSE) + 
  #guides(fill=FALSE) +
  theme_bw()

```

##### Overlap Percents

```{r}
pcadat_K562_100kb_perc_tfbs <- pcadat_K562_100kb_perc[which(rownames(pcadat_K562_100kb_perc) %in% tfbsvars),]

##with loadings
autoplot(prcomp(pcadat_K562_100kb_perc_tfbs),
         loadings = TRUE,
         label = TRUE, 
         label.size = 3,
         label.repel=T) +
  theme_bw()
##without loadings
autoplot(prcomp(pcadat_K562_100kb_perc_tfbs),
         #loadings = TRUE,
         label = TRUE, 
         label.size = 3,
         label.repel=T) +
  theme_bw()
##kmeans clustering algorithm to group annotations
wss <- (nrow(pcadat_K562_100kb_perc_tfbs)-1)*sum(apply(pcadat_K562_100kb_perc_tfbs,2,var))
  for (i in 2:50) wss[i] <- sum(kmeans(pcadat_K562_100kb_perc_tfbs,
                                       centers=i, nstart=25, iter.max = 1000)$withinss)
plot(1:50, wss, type="b", xlab="Number of Clusters",
     ylab="Within groups sum of squares")

set.seed(1)
autoplot(kmeans(pcadat_K562_100kb_perc_tfbs, 4, nstart=25, iter.max = 1000),
         data=pcadat_K562_100kb_perc_tfbs,
         #frame = TRUE,
         #frame.type = 'norm',
         label = TRUE, 
         label.size = 3, 
         label.repel=T,
         label.show.legend = FALSE) + 
  #guides(fill=FALSE) +
  theme_bw()

```

#####Distance

```{r}
pcadat_K562_100kb_dist_tfbs <- pcadat_K562_100kb_dist[which(rownames(pcadat_K562_100kb_dist) %in% tfbsvars),]

##with loadings
autoplot(prcomp(pcadat_K562_100kb_dist_tfbs),
         loadings = TRUE,
         label = TRUE, 
         label.size = 3,
         label.repel=T) +
  theme_bw()
##without loadings
autoplot(prcomp(pcadat_K562_100kb_dist_tfbs),
         #loadings = TRUE,
         label = TRUE, 
         label.size = 3,
         label.repel=T) +
  theme_bw()
##kmeans clustering algorithm to group annotations
wss <- (nrow(pcadat_K562_100kb_dist_tfbs)-1)*sum(apply(pcadat_K562_100kb_dist_tfbs,2,var))
  for (i in 2:50) wss[i] <- sum(kmeans(pcadat_K562_100kb_dist_tfbs,
                                       centers=i, nstart=25, iter.max = 1000)$withinss)
plot(1:50, wss, type="b", xlab="Number of Clusters",
     ylab="Within groups sum of squares")

set.seed(1)
autoplot(kmeans(pcadat_K562_100kb_dist_tfbs, 5, nstart=25, iter.max = 1000),
         data=pcadat_K562_100kb_dist_tfbs,
         #frame = TRUE,
         #frame.type = 'norm',
         label = TRUE, 
         label.size = 3, 
         label.repel=T,
         label.show.legend = FALSE) + 
  #guides(fill=FALSE) +
  theme_bw()

```



## Saving clustered annotation plots

```{r}
pcaplotfunction <- function(cl, resolution, predictortype, annotation){
  
  #set up variable names to subset
  chromstatevars <- gsub(".bed","",list.files("Z:/TAD_data_analysis/annotations/BroadHMM"))
  histonevars <- gsub(".bed","",list.files("Z:/TAD_data_analysis/annotations/HistoneModifications"))
  if(cl=="GM12878"){
    tfbsvars <-  gsub(".bed","",list.files("Z:/TAD_data_analysis/annotations/tfbs/cell_type_specific/gm12878"))
  } else {
    tfbsvars <-  gsub(".bed","",list.files("Z:/TAD_data_analysis/annotations/tfbs/cell_type_specific/k562"))
  }
  
  if(cl=="GM12878"){
    datadir = paste("Z:/TAD_data_analysis/", cl, "/", resolution, "/Ensemble/PCA", 
                    "/pcadat_gm12878_", resolution, "_", predictortype, ".rds",
                    sep="")
  }else{datadir = paste("Z:/TAD_data_analysis/", cl, "/", resolution, "/Ensemble/PCA", 
                        "/pcadat_", cl, "_", resolution, "_", predictortype, ".rds",
                        sep="")}
  
  data <- readRDS(datadir)
  
  if(predictortype=="dist"){
    #performing log2 transformation on distances
    data <- apply(data,2,function(x){log(x + 1, base=2)})
  }
  
  colnames(data) <- gsub(paste("_", predictortype, sep=""),"",colnames(data))
  
  data <- t(data)
  
  if(annotation=="chromstates"){
    data <- data[which(rownames(data) %in% chromstatevars),];
    rownames(data) <- gsub(paste(c("Gm12878", "K562",
                                   "-",
                                   "_",
                                   "Haib",
                                   "Sydh",
                                   "Uta",
                                   "Uw",
                                   "Broad",
                                   "Uchicago"), collapse = "|"),"", rownames(data))
  } else if(annotation=="histones"){
    data <- data[which(rownames(data) %in% histonevars),];
    rownames(data) <- gsub(paste(c("Gm12878", "K562",
                                   "-",
                                   "_",
                                   "Haib",
                                   "Sydh",
                                   "Uta",
                                   "Uw",
                                   "Broad",
                                   "Uchicago"), collapse = "|"),"", rownames(data))
  } else if(annotation=="tfbs"){
    data <- data[which(rownames(data) %in% tfbsvars),];
    rownames(data) <- gsub(paste(c("Gm12878", "K562",
                                   "-",
                                   "_",
                                   "Haib",
                                   "Sydh",
                                   "Uta",
                                   "Uw",
                                   "Broad",
                                   "Uchicago"), collapse = "|"),"", rownames(data))
  }
  
  #determine optimal number of clusters
  pamk.best <- pamk(data)
  
  #perform PAM clustering
  pam.med <- pam(data, k = pamk.best$nc, diss = FALSE,
                 metric = "manhattan", 
                 #medoids = NULL, 
                 #stand = FALSE, 
                 cluster.only = FALSE,
                 do.swap = TRUE,
                 keep.diss = FALSE,
                 keep.data = FALSE,
                 pamonce = FALSE, 
                 trace.lev = 0)
  
  data <- data.frame(data)
  data$Cluster <- factor(pam.med$clustering)
  data$Medoid <- factor(ifelse(rownames(data) %in% rownames(pam.med$medoids), "Center", "Other"),
                        levels=c("Other", "Center"))
  
  
  png(filename = paste("C:/Users/stili/Documents/TAD_miscellaneous/figures/pca_plots/cluster_by_annotation/", 
                       cl, resolution, predictortype, annotation,
                       ".png", sep=""),
      width=11, height=8, units="in", res = 300)
  print({
    autoplot(prcomp(data[,-c(dim(data)[2]-1,dim(data)[2])]),
           data=data,
           #loadings = TRUE,
           label = TRUE, 
           label.size = 3,
           label.repel=T, 
           colour="Cluster",
           shape="Medoid",
           label.show.legend = FALSE) +
    theme_bw()
  })
  dev.off()
  
}

```


###GM12878

```{r}
pcaplotfunction(cl = "GM12878", resolution = "10kb", predictortype = "count", annotation = "chromstates")
pcaplotfunction(cl = "GM12878", resolution = "10kb", predictortype = "count", annotation = "histones")
pcaplotfunction(cl = "GM12878", resolution = "10kb", predictortype = "count", annotation = "tfbs")

pcaplotfunction(cl = "GM12878", resolution = "10kb", predictortype = "perc", annotation = "chromstates")
pcaplotfunction(cl = "GM12878", resolution = "10kb", predictortype = "perc", annotation = "histones")
pcaplotfunction(cl = "GM12878", resolution = "10kb", predictortype = "perc", annotation = "tfbs")

pcaplotfunction(cl = "GM12878", resolution = "10kb", predictortype = "dist", annotation = "chromstates")
pcaplotfunction(cl = "GM12878", resolution = "10kb", predictortype = "dist", annotation = "histones")
pcaplotfunction(cl = "GM12878", resolution = "10kb", predictortype = "dist", annotation = "tfbs")

pcaplotfunction(cl = "GM12878", resolution = "25kb", predictortype = "count", annotation = "chromstates")
pcaplotfunction(cl = "GM12878", resolution = "25kb", predictortype = "count", annotation = "histones")
pcaplotfunction(cl = "GM12878", resolution = "25kb", predictortype = "count", annotation = "tfbs")

pcaplotfunction(cl = "GM12878", resolution = "25kb", predictortype = "perc", annotation = "chromstates")
pcaplotfunction(cl = "GM12878", resolution = "25kb", predictortype = "perc", annotation = "histones")
pcaplotfunction(cl = "GM12878", resolution = "25kb", predictortype = "perc", annotation = "tfbs")

pcaplotfunction(cl = "GM12878", resolution = "25kb", predictortype = "dist", annotation = "chromstates")
pcaplotfunction(cl = "GM12878", resolution = "25kb", predictortype = "dist", annotation = "histones")
pcaplotfunction(cl = "GM12878", resolution = "25kb", predictortype = "dist", annotation = "tfbs")

pcaplotfunction(cl = "GM12878", resolution = "50kb", predictortype = "count", annotation = "chromstates")
pcaplotfunction(cl = "GM12878", resolution = "50kb", predictortype = "count", annotation = "histones")
pcaplotfunction(cl = "GM12878", resolution = "50kb", predictortype = "count", annotation = "tfbs")

pcaplotfunction(cl = "GM12878", resolution = "50kb", predictortype = "perc", annotation = "chromstates")
pcaplotfunction(cl = "GM12878", resolution = "50kb", predictortype = "perc", annotation = "histones")
pcaplotfunction(cl = "GM12878", resolution = "50kb", predictortype = "perc", annotation = "tfbs")

pcaplotfunction(cl = "GM12878", resolution = "50kb", predictortype = "dist", annotation = "chromstates")
pcaplotfunction(cl = "GM12878", resolution = "50kb", predictortype = "dist", annotation = "histones")
pcaplotfunction(cl = "GM12878", resolution = "50kb", predictortype = "dist", annotation = "tfbs")

pcaplotfunction(cl = "GM12878", resolution = "100kb", predictortype = "count", annotation = "chromstates")
pcaplotfunction(cl = "GM12878", resolution = "100kb", predictortype = "count", annotation = "histones")
pcaplotfunction(cl = "GM12878", resolution = "100kb", predictortype = "count", annotation = "tfbs")

pcaplotfunction(cl = "GM12878", resolution = "100kb", predictortype = "perc", annotation = "chromstates")
pcaplotfunction(cl = "GM12878", resolution = "100kb", predictortype = "perc", annotation = "histones")
pcaplotfunction(cl = "GM12878", resolution = "100kb", predictortype = "perc", annotation = "tfbs")

pcaplotfunction(cl = "GM12878", resolution = "100kb", predictortype = "dist", annotation = "chromstates")
pcaplotfunction(cl = "GM12878", resolution = "100kb", predictortype = "dist", annotation = "histones")
pcaplotfunction(cl = "GM12878", resolution = "100kb", predictortype = "dist", annotation = "tfbs")

```

###K562

```{r}
pcaplotfunction(cl = "K562", resolution = "10kb", predictortype = "count", annotation = "chromstates")
pcaplotfunction(cl = "K562", resolution = "10kb", predictortype = "count", annotation = "histones")
pcaplotfunction(cl = "K562", resolution = "10kb", predictortype = "count", annotation = "tfbs")

pcaplotfunction(cl = "K562", resolution = "10kb", predictortype = "perc", annotation = "chromstates")
pcaplotfunction(cl = "K562", resolution = "10kb", predictortype = "perc", annotation = "histones")
pcaplotfunction(cl = "K562", resolution = "10kb", predictortype = "perc", annotation = "tfbs")

pcaplotfunction(cl = "K562", resolution = "10kb", predictortype = "dist", annotation = "chromstates")
pcaplotfunction(cl = "K562", resolution = "10kb", predictortype = "dist", annotation = "histones")
pcaplotfunction(cl = "K562", resolution = "10kb", predictortype = "dist", annotation = "tfbs")

pcaplotfunction(cl = "K562", resolution = "25kb", predictortype = "count", annotation = "chromstates")
pcaplotfunction(cl = "K562", resolution = "25kb", predictortype = "count", annotation = "histones")
pcaplotfunction(cl = "K562", resolution = "25kb", predictortype = "count", annotation = "tfbs")

pcaplotfunction(cl = "K562", resolution = "25kb", predictortype = "perc", annotation = "chromstates")
pcaplotfunction(cl = "K562", resolution = "25kb", predictortype = "perc", annotation = "histones")
pcaplotfunction(cl = "K562", resolution = "25kb", predictortype = "perc", annotation = "tfbs")

pcaplotfunction(cl = "K562", resolution = "25kb", predictortype = "dist", annotation = "chromstates")
pcaplotfunction(cl = "K562", resolution = "25kb", predictortype = "dist", annotation = "histones")
pcaplotfunction(cl = "K562", resolution = "25kb", predictortype = "dist", annotation = "tfbs")

pcaplotfunction(cl = "K562", resolution = "50kb", predictortype = "count", annotation = "chromstates")
pcaplotfunction(cl = "K562", resolution = "50kb", predictortype = "count", annotation = "histones")
pcaplotfunction(cl = "K562", resolution = "50kb", predictortype = "count", annotation = "tfbs")

pcaplotfunction(cl = "K562", resolution = "50kb", predictortype = "perc", annotation = "chromstates")
pcaplotfunction(cl = "K562", resolution = "50kb", predictortype = "perc", annotation = "histones")
pcaplotfunction(cl = "K562", resolution = "50kb", predictortype = "perc", annotation = "tfbs")

pcaplotfunction(cl = "K562", resolution = "50kb", predictortype = "dist", annotation = "chromstates")
pcaplotfunction(cl = "K562", resolution = "50kb", predictortype = "dist", annotation = "histones")
pcaplotfunction(cl = "K562", resolution = "50kb", predictortype = "dist", annotation = "tfbs")

pcaplotfunction(cl = "K562", resolution = "100kb", predictortype = "count", annotation = "chromstates")
pcaplotfunction(cl = "K562", resolution = "100kb", predictortype = "count", annotation = "histones")
pcaplotfunction(cl = "K562", resolution = "100kb", predictortype = "count", annotation = "tfbs")

pcaplotfunction(cl = "K562", resolution = "100kb", predictortype = "perc", annotation = "chromstates")
pcaplotfunction(cl = "K562", resolution = "100kb", predictortype = "perc", annotation = "histones")
pcaplotfunction(cl = "K562", resolution = "100kb", predictortype = "perc", annotation = "tfbs")

pcaplotfunction(cl = "K562", resolution = "100kb", predictortype = "dist", annotation = "chromstates")
pcaplotfunction(cl = "K562", resolution = "100kb", predictortype = "dist", annotation = "histones")
pcaplotfunction(cl = "K562", resolution = "100kb", predictortype = "dist", annotation = "tfbs")

```



# Clustering TADs

```{r}
tadclusterplotfunction <- function(cl, resolution, predictortype, cluster){
  
  if(cl=="GM12878"){
    datadir = paste("Z:/TAD_data_analysis/", cl, "/", resolution, "/Ensemble/PCA", 
                    "/pcadat_gm12878_", resolution, "_", predictortype, ".rds",
                    sep="")
  }else{datadir = paste("Z:/TAD_data_analysis/", cl, "/", resolution, "/Ensemble/PCA", 
                        "/pcadat_", cl, "_", resolution, "_", predictortype, ".rds",
                        sep="")}
  
  data <- readRDS(datadir)
  
  if(predictortype=="dist"){
    #performing log2 transformation on distances
    data <- apply(data,2,function(x){log(x + 1, base=2)})
  }
  
  colnames(data) <- gsub(paste("_", predictortype, sep=""),"",colnames(data))
  
  #determine optimal number of clusters
  pamk.best <- pamk(data)
  
  if(cluster=="kmedoids"){
    #perform PAM clustering
    clusters <- pam(data, k = pamk.best$nc, diss = FALSE,
                   metric = "manhattan", 
                   #medoids = NULL, 
                   #stand = FALSE, 
                   cluster.only = FALSE,
                   do.swap = TRUE,
                   keep.diss = FALSE,
                   keep.data = FALSE,
                   pamonce = FALSE, 
                   trace.lev = 0)
    
    data <- data.frame(data)
    data$Cluster <- factor(clusters$clustering)
    data$Medoid <- factor(ifelse(rownames(data) %in% rownames(clusters$medoids), "Center", "Other"),
                          levels=c("Other", "Center"))
  }else{
    clusters <- kmeans(data, centers = pamk.best$nc, nstart = 25, iter.max = 1000)
    
    data <- data.frame(data)
    data$Cluster <- factor(clusters$cluster)
    data$Medoid <- NA
  }
  
  png(filename = paste("C:/Users/stili/Documents/TAD_miscellaneous/figures/pca_plots/cluster_by_tad/", 
                       cl, resolution, predictortype, cluster,
                       ".png", sep=""),
      width=11, height=8, units="in", res = 300)
  print({
    autoplot(prcomp(data[,-c(dim(data)[2]-1,dim(data)[2])]),
             data=data,
             #loadings = TRUE,
             label = FALSE, 
             #label.size = 3,
             #label.repel=T, 
             colour="Cluster",
             #shape="Medoid",
             #size=3,
             #frame = TRUE, 
             #frame.type = 'norm',
             label.show.legend = FALSE) +
      theme_bw()
  })
  dev.off()
  
}

```

### Saving clustered tad plots

####GM12878

```{r}
tadclusterplotfunction(cl = "GM12878", resolution = "10kb", predictortype = "count", cluster = "kmedoids")
tadclusterplotfunction(cl = "GM12878", resolution = "10kb", predictortype = "count", cluster = "kmeans")

tadclusterplotfunction(cl = "GM12878", resolution = "10kb", predictortype = "perc", cluster = "kmedoids")
tadclusterplotfunction(cl = "GM12878", resolution = "10kb", predictortype = "perc", cluster = "kmeans")

tadclusterplotfunction(cl = "GM12878", resolution = "10kb", predictortype = "dist", cluster = "kmedoids")
tadclusterplotfunction(cl = "GM12878", resolution = "10kb", predictortype = "dist", cluster = "kmeans")

tadclusterplotfunction(cl = "GM12878", resolution = "25kb", predictortype = "count", cluster = "kmedoids")
tadclusterplotfunction(cl = "GM12878", resolution = "25kb", predictortype = "count", cluster = "kmeans")

tadclusterplotfunction(cl = "GM12878", resolution = "25kb", predictortype = "perc", cluster = "kmedoids")
tadclusterplotfunction(cl = "GM12878", resolution = "25kb", predictortype = "perc", cluster = "kmeans")

tadclusterplotfunction(cl = "GM12878", resolution = "25kb", predictortype = "dist", cluster = "kmedoids")
tadclusterplotfunction(cl = "GM12878", resolution = "25kb", predictortype = "dist", cluster = "kmeans")

tadclusterplotfunction(cl = "GM12878", resolution = "50kb", predictortype = "count", cluster = "kmedoids")
tadclusterplotfunction(cl = "GM12878", resolution = "50kb", predictortype = "count", cluster = "kmeans")

tadclusterplotfunction(cl = "GM12878", resolution = "50kb", predictortype = "perc", cluster = "kmedoids")
tadclusterplotfunction(cl = "GM12878", resolution = "50kb", predictortype = "perc", cluster = "kmeans")

tadclusterplotfunction(cl = "GM12878", resolution = "50kb", predictortype = "dist", cluster = "kmedoids")
tadclusterplotfunction(cl = "GM12878", resolution = "50kb", predictortype = "dist", cluster = "kmeans")

tadclusterplotfunction(cl = "GM12878", resolution = "100kb", predictortype = "count", cluster = "kmedoids")
tadclusterplotfunction(cl = "GM12878", resolution = "100kb", predictortype = "count", cluster = "kmeans")

tadclusterplotfunction(cl = "GM12878", resolution = "100kb", predictortype = "perc", cluster = "kmedoids")
tadclusterplotfunction(cl = "GM12878", resolution = "100kb", predictortype = "perc", cluster = "kmeans")

tadclusterplotfunction(cl = "GM12878", resolution = "100kb", predictortype = "dist", cluster = "kmedoids")
tadclusterplotfunction(cl = "GM12878", resolution = "100kb", predictortype = "dist", cluster = "kmeans")

```


#### K562

```{r}
tadclusterplotfunction(cl = "K562", resolution = "10kb", predictortype = "count", cluster = "kmedoids")
tadclusterplotfunction(cl = "K562", resolution = "10kb", predictortype = "count", cluster = "kmeans")

tadclusterplotfunction(cl = "K562", resolution = "10kb", predictortype = "perc", cluster = "kmedoids")
tadclusterplotfunction(cl = "K562", resolution = "10kb", predictortype = "perc", cluster = "kmeans")

tadclusterplotfunction(cl = "K562", resolution = "10kb", predictortype = "dist", cluster = "kmedoids")
tadclusterplotfunction(cl = "K562", resolution = "10kb", predictortype = "dist", cluster = "kmeans")

tadclusterplotfunction(cl = "K562", resolution = "25kb", predictortype = "count", cluster = "kmedoids")
tadclusterplotfunction(cl = "K562", resolution = "25kb", predictortype = "count", cluster = "kmeans")

tadclusterplotfunction(cl = "K562", resolution = "25kb", predictortype = "perc", cluster = "kmedoids")
tadclusterplotfunction(cl = "K562", resolution = "25kb", predictortype = "perc", cluster = "kmeans")

tadclusterplotfunction(cl = "K562", resolution = "25kb", predictortype = "dist", cluster = "kmedoids")
tadclusterplotfunction(cl = "K562", resolution = "25kb", predictortype = "dist", cluster = "kmeans")

tadclusterplotfunction(cl = "K562", resolution = "50kb", predictortype = "count", cluster = "kmedoids")
tadclusterplotfunction(cl = "K562", resolution = "50kb", predictortype = "count", cluster = "kmeans")

tadclusterplotfunction(cl = "K562", resolution = "50kb", predictortype = "perc", cluster = "kmedoids")
tadclusterplotfunction(cl = "K562", resolution = "50kb", predictortype = "perc", cluster = "kmeans")

tadclusterplotfunction(cl = "K562", resolution = "50kb", predictortype = "dist", cluster = "kmedoids")
tadclusterplotfunction(cl = "K562", resolution = "50kb", predictortype = "dist", cluster = "kmeans")

tadclusterplotfunction(cl = "K562", resolution = "100kb", predictortype = "count", cluster = "kmedoids")
tadclusterplotfunction(cl = "K562", resolution = "100kb", predictortype = "count", cluster = "kmeans")

tadclusterplotfunction(cl = "K562", resolution = "100kb", predictortype = "perc", cluster = "kmedoids")
tadclusterplotfunction(cl = "K562", resolution = "100kb", predictortype = "perc", cluster = "kmeans")

tadclusterplotfunction(cl = "K562", resolution = "100kb", predictortype = "dist", cluster = "kmedoids")
tadclusterplotfunction(cl = "K562", resolution = "100kb", predictortype = "dist", cluster = "kmeans")

```

