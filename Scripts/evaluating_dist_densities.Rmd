---
title: "Evaluating Distance Densities"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Loading Libraries

```{r}
library(GenomicRanges)
library(caret)
library(data.table)
library(gbm)
library(randomForest)
library(glmnet)
library(pROC)
library(plyr)
library(dplyr)
library(ggplot2)
library(DMwR)
library(gridExtra)
library(pROC)
library(ROCR)
#library(leaps)
library(cluster)
library(ggpubr)
library(scales)
library(GGally)
library(VennDiagram)
library(network)
library(sna)
library(gtable)
library(grid)
library(magrittr) 
library(DT)
library(tidyverse)
library(reshape)
library(ROSE)
library(lattice)

```


# Evaluating Distance Densities
##GM12878

```{r}
NTdistance_list_gm12878 <- readRDS("Z:/TAD_data_analysis/distance_densities/NTdistance_list_gm12878.rds")

LTdistance_list_gm12878 <- readRDS("Z:/TAD_data_analysis/distance_densities/LTdistance_list_gm12878.rds")

```

### 10kb
```{r}
#no transformation
ntplot10kb_gm12878 <- ggplot(NTdistance_list_gm12878[[1]], aes(x=value, group=variable, color="red")) + 
  geom_density(alpha=.5) +
  guides(color = FALSE)+ 
	xlim(0,30000000) + 
  xlab("") +
	ylab("") + 
  scale_x_continuous(limits = c(0,3e+7),
                     breaks = c(0, 1e+07, 2e+07, 3e+07),
                     labels = c(0,1,2,3))+
  theme_minimal() +
  theme_bw() +
  theme(axis.text.x = element_text(size=15),
     axis.text.y = element_blank(),
     axis.title.x = element_text(size = 20),
     axis.title.y = element_text(size = 20),
     legend.text=element_text(size=15),
     legend.title=element_text(size=20),
     plot.title = element_text(size=20))
  
#log transformation
ltplot10kb_gm12878 <- ggplot(LTdistance_list_gm12878[[1]], aes(x=value, group=variable)) + 
  geom_density(alpha=.5, color="blue") +
  guides(color = FALSE)+ 
	#xlim(0,30000000) + 
  xlab("") +
	ylab("") + 
  #scale_x_continuous(limits = c(0,3e+7),
  #                   breaks = c(0, 1e+07, 2e+07, 3e+07),
  #                   labels = c(0,1,2,3))+
  theme_minimal() +
  theme_bw() +
  theme(axis.text.x = element_text(size=15),
     axis.text.y = element_blank(),
     axis.title.x = element_text(size = 20),
     axis.title.y = element_text(size = 20),
     legend.text=element_text(size=15),
     legend.title=element_text(size=20),
     plot.title = element_text(size=20))

```


### 25kb
```{r}
#no transformation
ntplot25kb_gm12878 <- ggplot(NTdistance_list_gm12878[[2]], aes(x=value, group=variable, color="red")) + 
  geom_density(alpha=.5) +
  guides(color = FALSE)+ 
	xlim(0,30000000) + 
  xlab("") +
	ylab("") + 
  scale_x_continuous(limits = c(0,3e+7),
                     breaks = c(0, 1e+07, 2e+07, 3e+07),
                     labels = c(0,1,2,3))+
  theme_minimal() +
  theme_bw() +
  theme(axis.text.x = element_text(size=15),
     axis.text.y = element_blank(),
     axis.title.x = element_text(size = 20),
     axis.title.y = element_text(size = 20),
     legend.text=element_text(size=15),
     legend.title=element_text(size=20),
     plot.title = element_text(size=20))
  
#log transformation
ltplot25kb_gm12878 <- ggplot(LTdistance_list_gm12878[[2]], aes(x=value, group=variable)) + 
  geom_density(alpha=.5, color="blue") +
  guides(color = FALSE)+ 
	#xlim(0,30000000) + 
  xlab("") +
	ylab("") + 
  #scale_x_continuous(limits = c(0,3e+7),
  #                   breaks = c(0, 1e+07, 2e+07, 3e+07),
  #                   labels = c(0,1,2,3))+
  theme_minimal() +
  theme_bw() +
  theme(axis.text.x = element_text(size=15),
     axis.text.y = element_blank(),
     axis.title.x = element_text(size = 20),
     axis.title.y = element_text(size = 20),
     legend.text=element_text(size=15),
     legend.title=element_text(size=20),
     plot.title = element_text(size=20))

```

### 50kb
```{r}
#no transformation
ntplot50kb_gm12878 <- ggplot(NTdistance_list_gm12878[[3]], aes(x=value, group=variable, color="red")) + 
  geom_density(alpha=.5) +
  guides(color = FALSE)+ 
	xlim(0,30000000) + 
  xlab("") +
	ylab("") + 
  scale_x_continuous(limits = c(0,3e+7),
                     breaks = c(0, 1e+07, 2e+07, 3e+07),
                     labels = c(0,1,2,3))+
  theme_minimal() +
  theme_bw() +
  theme(axis.text.x = element_text(size=15),
     axis.text.y = element_blank(),
     axis.title.x = element_text(size = 20),
     axis.title.y = element_text(size = 20),
     legend.text=element_text(size=15),
     legend.title=element_text(size=20),
     plot.title = element_text(size=20))
  
#log transformation
ltplot50kb_gm12878 <- ggplot(LTdistance_list_gm12878[[3]], aes(x=value, group=variable)) + 
  geom_density(alpha=.5, color="blue") +
  guides(color = FALSE)+ 
	#xlim(0,30000000) + 
  xlab("") +
	ylab("") + 
  #scale_x_continuous(limits = c(0,3e+7),
  #                   breaks = c(0, 1e+07, 2e+07, 3e+07),
  #                   labels = c(0,1,2,3))+
  theme_minimal() +
  theme_bw() +
  theme(axis.text.x = element_text(size=15),
     axis.text.y = element_blank(),
     axis.title.x = element_text(size = 20),
     axis.title.y = element_text(size = 20),
     legend.text=element_text(size=15),
     legend.title=element_text(size=20),
     plot.title = element_text(size=20))

```

### 100kb
```{r}
#no transformation
ntplot100kb_gm12878 <- ggplot(NTdistance_list_gm12878[[4]], aes(x=value, group=variable, color="red")) + 
  geom_density(alpha=.5) +
  guides(color = FALSE)+ 
	xlim(0,30000000) + 
  xlab("") +
	ylab("") + 
  scale_x_continuous(limits = c(0,3e+7),
                     breaks = c(0, 1e+07, 2e+07, 3e+07),
                     labels = c(0,1,2,3))+
  theme_minimal() +
  theme_bw() +
  theme(axis.text.x = element_text(size=15),
     axis.text.y = element_blank(),
     axis.title.x = element_text(size = 20),
     axis.title.y = element_text(size = 20),
     legend.text=element_text(size=15),
     legend.title=element_text(size=20),
     plot.title = element_text(size=20))
  
#log transformation
ltplot100kb_gm12878 <- ggplot(LTdistance_list_gm12878[[4]], aes(x=value, group=variable)) + 
  geom_density(alpha=.5, color="blue") +
  guides(color = FALSE)+ 
	#xlim(0,30000000) + 
  xlab("") +
	ylab("") + 
  #scale_x_continuous(limits = c(0,3e+7),
  #                   breaks = c(0, 1e+07, 2e+07, 3e+07),
  #                   labels = c(0,1,2,3))+
  theme_minimal() +
  theme_bw() +
  theme(axis.text.x = element_text(size=15),
     axis.text.y = element_blank(),
     axis.title.x = element_text(size = 20),
     axis.title.y = element_text(size = 20),
     legend.text=element_text(size=15),
     legend.title=element_text(size=20),
     plot.title = element_text(size=20))

```


##K562

```{r}
NTdistance_list_K562 <- readRDS("Z:/TAD_data_analysis/distance_densities/NTdistance_list_K562.rds")

LTdistance_list_K562 <- readRDS("Z:/TAD_data_analysis/distance_densities/LTdistance_list_K562.rds")


```

### 10kb
```{r}
#no transformation
ntplot10kb_K562 <- ggplot(NTdistance_list_K562[[1]], aes(x=value, group=variable, color="red")) + 
  geom_density(alpha=.5) +
  guides(color = FALSE)+ 
	xlim(0,30000000) + 
  xlab("") +
	ylab("") + 
  scale_x_continuous(limits = c(0,3e+7),
                     breaks = c(0, 1e+07, 2e+07, 3e+07),
                     labels = c(0,1,2,3))+
  theme_minimal() +
  theme_bw() +
  theme(axis.text.x = element_text(size=15),
     axis.text.y = element_blank(),
     axis.title.x = element_text(size = 20),
     axis.title.y = element_text(size = 20),
     legend.text=element_text(size=15),
     legend.title=element_text(size=20),
     plot.title = element_text(size=20))
  
#log transformation
ltplot10kb_K562 <- ggplot(LTdistance_list_K562[[1]], aes(x=value, group=variable)) + 
  geom_density(alpha=.5, color="blue") +
  guides(color = FALSE)+ 
	#xlim(0,30000000) + 
  xlab("") +
	ylab("") + 
  #scale_x_continuous(limits = c(0,3e+7),
  #                   breaks = c(0, 1e+07, 2e+07, 3e+07),
  #                   labels = c(0,1,2,3))+
  theme_minimal() +
  theme_bw() +
  theme(axis.text.x = element_text(size=15),
     axis.text.y = element_blank(),
     axis.title.x = element_text(size = 20),
     axis.title.y = element_text(size = 20),
     legend.text=element_text(size=15),
     legend.title=element_text(size=20),
     plot.title = element_text(size=20))

```


### 25kb
```{r}
#no transformation
ntplot25kb_K562 <- ggplot(NTdistance_list_K562[[2]], aes(x=value, group=variable, color="red")) + 
  geom_density(alpha=.5) +
  guides(color = FALSE)+ 
	xlim(0,30000000) + 
  xlab("") +
	ylab("") + 
  scale_x_continuous(limits = c(0,3e+7),
                     breaks = c(0, 1e+07, 2e+07, 3e+07),
                     labels = c(0,1,2,3))+
  theme_minimal() +
  theme_bw() +
  theme(axis.text.x = element_text(size=15),
     axis.text.y = element_blank(),
     axis.title.x = element_text(size = 20),
     axis.title.y = element_text(size = 20),
     legend.text=element_text(size=15),
     legend.title=element_text(size=20),
     plot.title = element_text(size=20))
  
#log transformation
ltplot25kb_K562 <- ggplot(LTdistance_list_K562[[2]], aes(x=value, group=variable)) + 
  geom_density(alpha=.5, color="blue") +
  guides(color = FALSE)+ 
	#xlim(0,30000000) + 
  xlab("") +
	ylab("") + 
  #scale_x_continuous(limits = c(0,3e+7),
  #                   breaks = c(0, 1e+07, 2e+07, 3e+07),
  #                   labels = c(0,1,2,3))+
  theme_minimal() +
  theme_bw() +
  theme(axis.text.x = element_text(size=15),
     axis.text.y = element_blank(),
     axis.title.x = element_text(size = 20),
     axis.title.y = element_text(size = 20),
     legend.text=element_text(size=15),
     legend.title=element_text(size=20),
     plot.title = element_text(size=20))

```

### 50kb
```{r}
#no transformation
ntplot50kb_K562 <- ggplot(NTdistance_list_K562[[3]], aes(x=value, group=variable, color="red")) + 
  geom_density(alpha=.5) +
  guides(color = FALSE)+ 
	xlim(0,30000000) + 
  xlab("") +
	ylab("") + 
  scale_x_continuous(limits = c(0,3e+7),
                     breaks = c(0, 1e+07, 2e+07, 3e+07),
                     labels = c(0,1,2,3))+
  theme_minimal() +
  theme_bw() +
  theme(axis.text.x = element_text(size=15),
     axis.text.y = element_blank(),
     axis.title.x = element_text(size = 20),
     axis.title.y = element_text(size = 20),
     legend.text=element_text(size=15),
     legend.title=element_text(size=20),
     plot.title = element_text(size=20))
  
#log transformation
ltplot50kb_K562 <- ggplot(LTdistance_list_K562[[3]], aes(x=value, group=variable)) + 
  geom_density(alpha=.5, color="blue") +
  guides(color = FALSE)+ 
	#xlim(0,30000000) + 
  xlab("") +
	ylab("") + 
  #scale_x_continuous(limits = c(0,3e+7),
  #                   breaks = c(0, 1e+07, 2e+07, 3e+07),
  #                   labels = c(0,1,2,3))+
  theme_minimal() +
  theme_bw() +
  theme(axis.text.x = element_text(size=15),
     axis.text.y = element_blank(),
     axis.title.x = element_text(size = 20),
     axis.title.y = element_text(size = 20),
     legend.text=element_text(size=15),
     legend.title=element_text(size=20),
     plot.title = element_text(size=20))

```

### 100kb
```{r}
#no transformation
ntplot100kb_K562 <- ggplot(NTdistance_list_K562[[4]], aes(x=value, group=variable, color="red")) + 
  geom_density(alpha=.5) +
  guides(color = FALSE)+ 
	xlim(0,30000000) + 
  xlab("") +
	ylab("") + 
  scale_x_continuous(limits = c(0,3e+7),
                     breaks = c(0, 1e+07, 2e+07, 3e+07),
                     labels = c(0,1,2,3))+
  theme_minimal() +
  theme_bw() +
  theme(axis.text.x = element_text(size=15),
     axis.text.y = element_blank(),
     axis.title.x = element_text(size = 20),
     axis.title.y = element_text(size = 20),
     legend.text=element_text(size=15),
     legend.title=element_text(size=20),
     plot.title = element_text(size=20))
  
#log transformation
ltplot100kb_K562 <- ggplot(LTdistance_list_K562[[4]], aes(x=value, group=variable)) + 
  geom_density(alpha=.5, color="blue") +
  guides(color = FALSE)+ 
	#xlim(0,30000000) + 
  xlab("") +
	ylab("") + 
  #scale_x_continuous(limits = c(0,3e+7),
  #                   breaks = c(0, 1e+07, 2e+07, 3e+07),
  #                   labels = c(0,1,2,3))+
  theme_minimal() +
  theme_bw() +
  theme(axis.text.x = element_text(size=15),
     axis.text.y = element_blank(),
     axis.title.x = element_text(size = 20),
     axis.title.y = element_text(size = 20),
     legend.text=element_text(size=15),
     legend.title=element_text(size=20),
     plot.title = element_text(size=20))

```


##Combined

###GM12878
```{r}

gm12878_nt_plot <- ggplot(gm12878_dist_densities[which(gm12878_dist_densities$Transformation=="Untransformed"),], aes(x=value, group=variable)) + 
  facet_grid(Transformation ~ Resolution, scales="free") +
  geom_density(alpha=.5, color="red") + 
  xlim(0,30000000) +
  scale_x_continuous(limits = c(0,3e+7),
                     breaks = c(0, 1e+07, 2e+07, 3e+07),
                     labels = c(0,1,2,3))+
  xlab("") + ylab("") +
  theme_minimal() +
  theme_bw() +
  theme(axis.text.x = element_text(size=15),
     axis.text.y = element_blank(),
     axis.title.x = element_text(size = 20),
     axis.title.y = element_text(size = 20),
     strip.text.x = element_text(size = 15),
     strip.text.y = element_text(size = 15),
     legend.text=element_text(size=15),
     legend.title=element_text(size=20),
     plot.title = element_text(size=20))

gm12878_lt_plot <- ggplot(gm12878_dist_densities[-which(gm12878_dist_densities$Transformation=="Untransformed"),], aes(x=value, group=variable)) + 
  facet_grid(Transformation ~ Resolution, scales="free") +
  geom_density(alpha=.5, color="blue") + 
  xlab("") + ylab("") +
  theme_minimal() +
  theme_bw() +
  theme(axis.text.x = element_text(size=15),
     axis.text.y = element_blank(),
     axis.title.x = element_text(size = 20),
     axis.title.y = element_text(size = 20),
     strip.text.x = element_text(size = 15),
     strip.text.y = element_text(size = 15),
     legend.text=element_text(size=15),
     legend.title=element_text(size=20),
     plot.title = element_text(size=20))

allplots_gm12878 <- ggarrange(gm12878_nt_plot,
                          gm12878_lt_plot, 
          ncol=1, 
          nrow=2,
          labels = "AUTO",
          font.label = list(size=20))
allplots_gm12878
annotate_figure(allplots_gm12878,
                bottom = text_grob("Distance (mb)", 
                                   color = "black", 
                                   face = "bold", 
                                   size = 15),
                left = text_grob("Density", 
                                 color = "black",
                                 size = 15,
                                 rot = 90))
```

###K562

```{r}
K562_dist_densities <- rbind.data.frame(NTdistance_list_K562[[1]],
                                           NTdistance_list_K562[[2]],
                                           NTdistance_list_K562[[3]],
                                           NTdistance_list_K562[[4]],
                                           LTdistance_list_K562[[1]],
                                           LTdistance_list_K562[[2]],
                                           LTdistance_list_K562[[3]],
                                           LTdistance_list_K562[[4]])
K562_dist_densities$Transformation <- c(rep("Untransformed", dim(NTdistance_list_K562[[1]])[1] + 
                                                                dim(NTdistance_list_K562[[2]])[1] +
                                                                dim(NTdistance_list_K562[[3]])[1] +
                                                                dim(NTdistance_list_K562[[4]])[1]),
                                           rep("Log2 Transformed", dim(LTdistance_list_K562[[1]])[1] + 
                                                                dim(LTdistance_list_K562[[2]])[1] +
                                                                dim(LTdistance_list_K562[[3]])[1] +
                                                                dim(LTdistance_list_K562[[4]])[1]))
K562_dist_densities$Resolution <- c(rep("10 kb", dim(NTdistance_list_K562[[1]])[1]),
                                       rep("25 kb", dim(NTdistance_list_K562[[2]])[1]),
                                       rep("50 kb", dim(NTdistance_list_K562[[3]])[1]),
                                       rep("100 kb", dim(NTdistance_list_K562[[4]])[1]),
                                       rep("10 kb", dim(LTdistance_list_K562[[1]])[1]),
                                       rep("25 kb", dim(LTdistance_list_K562[[2]])[1]),
                                       rep("50 kb", dim(LTdistance_list_K562[[3]])[1]),
                                       rep("100 kb", dim(LTdistance_list_K562[[4]])[1]))
K562_dist_densities$Transformation <- factor(K562_dist_densities$Transformation, levels=c("Untransformed", "Log2 Transformed"))
K562_dist_densities$Resolution <- factor(K562_dist_densities$Resolution, levels=c("10 kb", "25 kb", "50 kb", "100 kb"))

K562_nt_plot <- ggplot(K562_dist_densities[which(K562_dist_densities$Transformation=="Untransformed"),], aes(x=value, group=variable)) + 
  facet_grid(Transformation ~ Resolution, scales="free") +
  geom_density(alpha=.5, color="red") + 
  xlim(0,30000000) +
  scale_x_continuous(limits = c(0,3e+7),
                     breaks = c(0, 1e+07, 2e+07, 3e+07),
                     labels = c(0,1,2,3))+
  xlab("") + ylab("") +
  theme_minimal() +
  theme_bw() +
  theme(axis.text.x = element_text(size=15),
        axis.text.y = element_blank(),
        axis.title.x = element_text(size = 20),
        axis.title.y = element_text(size = 20),
        strip.text.x = element_text(size = 15),
        strip.text.y = element_text(size = 15),
        legend.text=element_text(size=15),
        legend.title=element_text(size=20),
        plot.title = element_text(size=20))

K562_lt_plot <- ggplot(K562_dist_densities[-which(K562_dist_densities$Transformation=="Untransformed"),], aes(x=value, group=variable)) + 
  facet_grid(Transformation ~ Resolution, scales="free") +
  geom_density(alpha=.5, color="blue") + 
  xlab("") + ylab("") +
  theme_minimal() +
  theme_bw() +
  theme(axis.text.x = element_text(size=15),
        axis.text.y = element_blank(),
        axis.title.x = element_text(size = 20),
        axis.title.y = element_text(size = 20),
        strip.text.x = element_text(size = 15),
        strip.text.y = element_text(size = 15),
        legend.text=element_text(size=15),
        legend.title=element_text(size=20),
        plot.title = element_text(size=20))

allplots_K562 <- ggarrange(K562_nt_plot,
                              K562_lt_plot, 
                              ncol=1, 
                              nrow=2,
                              labels = "AUTO",
                              font.label = list(size=20))
allplots_K562
annotate_figure(allplots_K562,
                bottom = text_grob("Distance (mb)", 
                                   color = "black", 
                                   face = "bold", 
                                   size = 15),
                left = text_grob("Density", 
                                 color = "black",
                                 size = 15,
                                 rot = 90))
```

