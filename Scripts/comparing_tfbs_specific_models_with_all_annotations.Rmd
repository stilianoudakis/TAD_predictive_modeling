---
title: "Investigating TFBS Specific Model Performances"
author: "Spiro Stilianoudakis"
date: "April 11, 2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Loading Libraries

```{r}
library(GenomicRanges)
library(caret)
library(data.table)
library(gbm)
library(randomForest)
library(glmnet)
library(pROC)
library(plyr)
library(dplyr)
library(ggplot2)
library(DMwR)
library(gridExtra)
library(pROC)
library(ROCR)
#library(leaps)
library(cluster)
library(ggpubr)
library(scales)
library(GGally)
library(VennDiagram)
library(network)
library(sna)
library(gtable)
library(grid)
library(magrittr) 
library(DT)
library(tidyverse)
library(reshape)
library(ROSE)
library(lattice)
library(corrplot)
library(cluster)
library(RColorBrewer)

```


# GM12878; smote; distance types

## 10kb

```{r}
mccdata_gm12878_10kb <- numeric()

for(i in paste0("CHR", c(1:8,10:22))){
	for(j in c("chromstates", "histones", "tfbs", "all")){
	  if(j %in% c("chromstates", "histones", "tfbs")){
	    perfdata <- readRDS(paste0("Z:/TAD_data_analysis/GM12878/10kb/results_by_chr/",
									   i, 
									   "/smote/distance/enet/rfperf_",
									   j, 
									   ".rds"))
	  }else{
	    perfdata <- readRDS(paste0("Z:/TAD_data_analysis/GM12878/10kb/results_by_chr/",
									   i, 
									   "/smote/distance/enet/rfperf.rds"))
	  }
									   
			mccdata_gm12878_10kb <- rbind(mccdata_gm12878_10kb,
										  perfdata[15,2])
		
	}
}


```

## 25kb

```{r}
mccdata_gm12878_25kb <- numeric()

for(i in paste0("CHR", c(1:8,10:22))){
	for(j in c("chromstates", "histones", "tfbs", "all")){
	  if(j %in% c("chromstates", "histones", "tfbs")){
	    perfdata <- readRDS(paste0("Z:/TAD_data_analysis/GM12878/25kb/results_by_chr/",
									   i, 
									   "/smote/distance/enet/rfperf_",
									   j, 
									   ".rds"))
	  }else{
	    perfdata <- readRDS(paste0("Z:/TAD_data_analysis/GM12878/25kb/results_by_chr/",
									   i, 
									   "/smote/distance/enet/rfperf.rds"))
	  }
									   
			mccdata_gm12878_25kb <- rbind(mccdata_gm12878_25kb,
										  perfdata[15,2])
		
	}
}


```

## 50kb

```{r}
mccdata_gm12878_50kb <- numeric()

for(i in paste0("CHR", c(1:8,10:22))){
	for(j in c("chromstates", "histones", "tfbs", "all")){
	  if(j %in% c("chromstates", "histones", "tfbs")){
	    perfdata <- readRDS(paste0("Z:/TAD_data_analysis/GM12878/50kb/results_by_chr/",
									   i, 
									   "/smote/distance/enet/rfperf_",
									   j, 
									   ".rds"))
	  }else{
	    perfdata <- readRDS(paste0("Z:/TAD_data_analysis/GM12878/50kb/results_by_chr/",
									   i, 
									   "/smote/distance/enet/rfperf.rds"))
	  }
									   
			mccdata_gm12878_50kb <- rbind(mccdata_gm12878_50kb,
										  perfdata[15,2])
		
	}
}

```

## 100kb

```{r}
mccdata_gm12878_100kb <- numeric()

for(i in paste0("CHR", c(1:8,10:22))){
	for(j in c("chromstates", "histones", "tfbs", "all")){
	  if(j %in% c("chromstates", "histones", "tfbs")){
	    perfdata <- readRDS(paste0("Z:/TAD_data_analysis/GM12878/100kb/results_by_chr/",
									   i, 
									   "/smote/distance/enet/rfperf_",
									   j, 
									   ".rds"))
	  }else{
	    perfdata <- readRDS(paste0("Z:/TAD_data_analysis/GM12878/100kb/results_by_chr/",
									   i, 
									   "/smote/distance/enet/rfperf.rds"))
	  }
									   
			mccdata_gm12878_100kb <- rbind(mccdata_gm12878_100kb,
										  perfdata[15,2])
		
	}
}

```

# K562; smote; distance types

## 10kb

```{r}
mccdata_K562_10kb <- numeric()

for(i in paste0("CHR", c(1:8,10:22))){
	for(j in c("chromstates", "histones", "tfbs", "all")){
	  if(j %in% c("chromstates", "histones", "tfbs")){
	    perfdata <- readRDS(paste0("Z:/TAD_data_analysis/K562/10kb/results_by_chr/",
									   i, 
									   "/smote/distance/enet/rfperf_",
									   j, 
									   ".rds"))
	  }else{
	    perfdata <- readRDS(paste0("Z:/TAD_data_analysis/K562/10kb/results_by_chr/",
									   i, 
									   "/smote/distance/enet/rfperf.rds"))
	  }
									   
			mccdata_K562_10kb <- rbind(mccdata_K562_10kb,
										  perfdata[15,2])
		
	}
}


```

## 25kb

```{r}
mccdata_K562_25kb <- numeric()

for(i in paste0("CHR", c(1:8,10:22))){
	for(j in c("chromstates", "histones", "tfbs", "all")){
	  if(j %in% c("chromstates", "histones", "tfbs")){
	    perfdata <- readRDS(paste0("Z:/TAD_data_analysis/K562/25kb/results_by_chr/",
									   i, 
									   "/smote/distance/enet/rfperf_",
									   j, 
									   ".rds"))
	  }else{
	    perfdata <- readRDS(paste0("Z:/TAD_data_analysis/K562/25kb/results_by_chr/",
									   i, 
									   "/smote/distance/enet/rfperf.rds"))
	  }
									   
			mccdata_K562_25kb <- rbind(mccdata_K562_25kb,
										  perfdata[15,2])
		
	}
}


```

## 50kb

```{r}
mccdata_K562_50kb <- numeric()

for(i in paste0("CHR", c(1:8,10:22))){
	for(j in c("chromstates", "histones", "tfbs", "all")){
	  if(j %in% c("chromstates", "histones", "tfbs")){
	    perfdata <- readRDS(paste0("Z:/TAD_data_analysis/K562/50kb/results_by_chr/",
									   i, 
									   "/smote/distance/enet/rfperf_",
									   j, 
									   ".rds"))
	  }else{
	    perfdata <- readRDS(paste0("Z:/TAD_data_analysis/K562/50kb/results_by_chr/",
									   i, 
									   "/smote/distance/enet/rfperf.rds"))
	  }
									   
			mccdata_K562_50kb <- rbind(mccdata_K562_50kb,
										  perfdata[15,2])
		
	}
}

```

## 100kb

```{r}
mccdata_K562_100kb <- numeric()

for(i in paste0("CHR", c(1:8,10:22))){
	for(j in c("chromstates", "histones", "tfbs", "all")){
	  if(j %in% c("chromstates", "histones", "tfbs")){
	    perfdata <- readRDS(paste0("Z:/TAD_data_analysis/K562/100kb/results_by_chr/",
									   i, 
									   "/smote/distance/enet/rfperf_",
									   j, 
									   ".rds"))
	  }else{
	    perfdata <- readRDS(paste0("Z:/TAD_data_analysis/K562/100kb/results_by_chr/",
									   i, 
									   "/smote/distance/enet/rfperf.rds"))
	  }
									   
			mccdata_K562_100kb <- rbind(mccdata_K562_100kb,
										  perfdata[15,2])
		
	}
}

```


# Plots

```{r}
all_rfperfs <- rbind.data.frame(mccdata_gm12878_10kb,
                                mccdata_gm12878_25kb,
                                mccdata_gm12878_50kb,
                                mccdata_gm12878_100kb,
                                mccdata_K562_10kb,
                                mccdata_K562_25kb,
                                mccdata_K562_50kb,
                                mccdata_K562_100kb)
all_rfperfs$CL <- c(rep("GM12878", length(mccdata_gm12878_10kb)*4), rep("K562", length(mccdata_K562_10kb)*4))
all_rfperfs$Resolution <- rep(c(rep("10 kb", 84),
                            rep("25 kb", 84),
                            rep("50 kb", 84),
                            rep("100 kb", 84)))
all_rfperfs$Annotation <- rep(c("CSS","HM","TFBS","Combined"),168)
all_rfperfs$Chromosome <- rep(c(rep("CHR1", 4),
                            rep("CHR2", 4),
                            rep("CHR3", 4),
                            rep("CHR4", 4),
                            rep("CHR5", 4),
                            rep("CHR6", 4),
                            rep("CHR7", 4),
                            rep("CHR8", 4),
                            rep("CHR10", 4),
                            rep("CHR11", 4),
                            rep("CHR12", 4),
                            rep("CHR13", 4),
                            rep("CHR14", 4),
                            rep("CHR15", 4),
                            rep("CHR16", 4),
                            rep("CHR17", 4),
                            rep("CHR18", 4),
                            rep("CHR19", 4),
                            rep("CHR20", 4),
                            rep("CHR21", 4),
                            rep("CHR22", 4)),8)

all_rfperfs$CL <- factor(all_rfperfs$CL, levels = c("GM12878", "K562"))
all_rfperfs$Resolution <- factor(all_rfperfs$Resolution, levels = c("10 kb", "25 kb", "50 kb", "100 kb"))
all_rfperfs$Annotation <- factor(all_rfperfs$Annotation, levels = c("HM", "CSS", "TFBS", "Combined"))
all_rfperfs$Chromosome <- factor(all_rfperfs$Chromosome, levels = paste0("CHR", c(1:8,10:22)))

all_rfperfs_mcc <- all_rfperfs %>%
  dplyr::group_by(CL, Resolution, Annotation) %>%
  dplyr::summarise(MCC = mean(V1, na.rm = TRUE),
            MCCSD = sd(V1, na.rm = TRUE))

#GM12878
a <- ggplot(all_rfperfs_mcc[which(all_rfperfs_mcc$CL=="GM12878"),], aes(x=Resolution, y=MCC, group=Annotation, fill=Annotation)) +
  geom_bar(stat="identity", position = position_dodge()) +
  geom_errorbar(aes(ymin=MCC-MCCSD, ymax=MCC+MCCSD), width=.5,
                 position=position_dodge(.9), alpha=0.75) +
  theme_minimal() +
  theme_bw()+
  xlab("") + ylab("MCC") + 
  scale_fill_discrete(name="Annotation Group")+
  ggtitle("GM12878") +
  theme(axis.text.x = element_text(size=15,
                                  angle = 45, 
                                  #margin = ggplot2::margin(t = 35),
                                  hjust = 1
  ),
  axis.text.y = element_text(size = 15),
  axis.title.x = element_text(size = 20),
  axis.title.y = element_text(size = 20),
  legend.text=element_text(size=15),
  legend.title=element_text(size=20),
  plot.title = element_text(size=20))

#K562
b <- ggplot(all_rfperfs_mcc[which(all_rfperfs_mcc$CL=="K562"),], aes(x=Resolution, y=MCC, group=Annotation, fill=Annotation)) +
  geom_bar(stat="identity", position = position_dodge()) +
  geom_errorbar(aes(ymin=MCC-MCCSD, ymax=MCC+MCCSD), width=.5,
                 position=position_dodge(.9), alpha=0.75) +
  theme_minimal() +
  theme_bw()+
  xlab("") + ylab("") +
  scale_fill_discrete(name="Annotation\nGroup")+
  ggtitle("K562") +
  theme(axis.text.x = element_text(size=15,
                                  angle = 45, 
                                  #margin = ggplot2::margin(t = 35),
                                  hjust = 1
  ),
  axis.text.y = element_text(size = 15),
  axis.title.x = element_text(size = 20),
  axis.title.y = element_text(size = 20),
  legend.text=element_text(size=15),
  legend.title=element_text(size=20),
  plot.title = element_text(size=20))

figure <- ggarrange(a,b,
                ncol = 2, nrow = 1, 
                common.legend = TRUE, 
                legend = "bottom")
figure
```

# Plots v2

```{r}
ggplot(all_rfperfs_mcc, aes(x=Resolution, y=MCC, group=Annotation, fill=Annotation)) +
  geom_bar(stat="identity", position = position_dodge()) +
  geom_errorbar(aes(ymin=MCC-MCCSD, ymax=MCC+MCCSD), width=.5,
                 position=position_dodge(.9), alpha=0.75) +
  facet_grid(~ CL) +
  theme_minimal() +
  theme_bw()+
  #xlab("") + ylab("") + ylim(-.05,.5) +
  scale_fill_discrete(name="Annotation Group")+
  guides(shape=FALSE, linetype=FALSE)+
  theme(axis.text.x = element_text(size=15,
                                  angle = 45, 
                                  #margin = ggplot2::margin(t = 35),
                                  hjust = 1
  ),
  axis.text.y = element_text(size = 15),
  axis.title.x = element_text(size = 20),
  axis.title.y = element_text(size = 20),
  strip.text.x = element_text(size = 15),
  panel.spacing = unit(2, "lines"),
  legend.text=element_text(size=15),
  legend.title=element_text(size=20),
  plot.title = element_text(size=20),
  legend.position = "bottom")
```

