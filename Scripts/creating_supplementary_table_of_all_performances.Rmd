---
title: "Creating Supplementary Table of all Performances"
author: "Spiro Stilianoudakis"
date: "April 8, 2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Reading in all model results in the ensemble framework

## GM12878

```{r}
rfperf_metric <- as.character()
rfperf_chr <- as.character()
rfperf_res <- as.character()
rfperf_samp <- as.character()
rfperf_pred <- as.character()
rfperf_perf <- as.numeric()

for(i in c("10kb", "25kb", "50kb", "100kb")){
  for(j in paste0("CHR", c(1:8,10:22))){
    for(k in c("none", "ros", "rus", "smote")){
      for(l in c("oc","op","distance")){
        perfdat <- readRDS(paste0("Z:/TAD_data_analysis/GM12878/",
                                 i,
                                 "/results_by_chr/",
                                 j,
                                 "/",
                                 k,
                                 "/",
                                 l,
                                 "/enet/rfperf.rds"))
        
        rfperf_res <- c(rfperf_res, rep(i,8))
        rfperf_chr <- c(rfperf_chr,rep(j,8))
        rfperf_samp <- c(rfperf_samp,rep(k,8))
        rfperf_pred <- c(rfperf_pred,rep(l,8))
        rfperf_metric <- c(rfperf_metric, as.character(perfdat$Metric[c(6,7,9,10,15:17,19)]))
        rfperf_perf <- c(rfperf_perf, perfdat$Performance[c(6,7,9,10,15:17,19)])
        
      }
    }
  }
}

gm12878_all_perfs <- cbind.data.frame(rfperf_res, rfperf_chr, rfperf_samp, rfperf_pred, rfperf_metric, rfperf_perf)
colnames(gm12878_all_perfs) <- c("Resolution", "CHR", "Resampling", "Predictor", "Metric", "Performance")

gm12878_all_perfs$Resolution <- factor(gm12878_all_perfs$Resolution, levels=c("10kb","25kb","50kb","100kb"))
gm12878_all_perfs$CHR <- factor(gm12878_all_perfs$CHR, levels=paste0("CHR", c(1:8,10:22)))
gm12878_all_perfs$Resampling <- factor(gm12878_all_perfs$Resampling, levels=c("none", "ros", "rus", "smote"))
gm12878_all_perfs$Predictor <- factor(gm12878_all_perfs$Predictor, levels=c("oc","op","distance"))
gm12878_all_perfs$Metric <- factor(gm12878_all_perfs$Metric, levels=c("Sensitivity", "Specificity", "Accuracy", "Precision", "MCC", "F1", "AUC", "AUPRC"))


gm12878_all_perfs_summ <- gm12878_all_perfs %>%
  group_by(Resolution, Resampling, Predictor, Metric) %>%
  dplyr::summarise(AvePerf = mean(Performance, na.rm = TRUE),
            SDPerf = sd(Performance, na.rm = TRUE))

gm12878_all_perfs_summ$AvePerf <- round(gm12878_all_perfs_summ$AvePerf, 3)
gm12878_all_perfs_summ$SDPerf <- round(gm12878_all_perfs_summ$SDPerf, 3)

```

## K562

```{r}
rfperf_metric <- as.character()
rfperf_chr <- as.character()
rfperf_res <- as.character()
rfperf_samp <- as.character()
rfperf_pred <- as.character()
rfperf_perf <- as.numeric()

for(i in c("10kb", "25kb", "50kb", "100kb")){
  for(j in paste0("CHR", c(1:8,10:22))){
    for(k in c("none", "ros", "rus", "smote")){
      for(l in c("oc","op","distance")){
        perfdat <- readRDS(paste0("Z:/TAD_data_analysis/K562/",
                                 i,
                                 "/results_by_chr/",
                                 j,
                                 "/",
                                 k,
                                 "/",
                                 l,
                                 "/enet/rfperf.rds"))
        
        rfperf_res <- c(rfperf_res, rep(i,8))
        rfperf_chr <- c(rfperf_chr,rep(j,8))
        rfperf_samp <- c(rfperf_samp,rep(k,8))
        rfperf_pred <- c(rfperf_pred,rep(l,8))
        rfperf_metric <- c(rfperf_metric, as.character(perfdat$Metric[c(6,7,9,10,15:17,19)]))
        rfperf_perf <- c(rfperf_perf, perfdat$Performance[c(6,7,9,10,15:17,19)])
        
      }
    }
  }
}

K562_all_perfs <- cbind.data.frame(rfperf_res, rfperf_chr, rfperf_samp, rfperf_pred, rfperf_metric, rfperf_perf)
colnames(K562_all_perfs) <- c("Resolution", "CHR", "Resampling", "Predictor", "Metric", "Performance")

K562_all_perfs$Resolution <- factor(K562_all_perfs$Resolution, levels=c("10kb","25kb","50kb","100kb"))
K562_all_perfs$CHR <- factor(K562_all_perfs$CHR, levels=paste0("CHR", c(1:8,10:22)))
K562_all_perfs$Resampling <- factor(K562_all_perfs$Resampling, levels=c("none", "ros", "rus", "smote"))
K562_all_perfs$Predictor <- factor(K562_all_perfs$Predictor, levels=c("oc","op","distance"))
K562_all_perfs$Metric <- factor(K562_all_perfs$Metric, levels=c("Sensitivity", "Specificity", "Accuracy", "Precision", "MCC", "F1", "AUC", "AUPRC"))


K562_all_perfs_summ <- K562_all_perfs %>%
  group_by(Resolution, Resampling, Predictor, Metric) %>%
  dplyr::summarise(AvePerf = mean(Performance, na.rm = TRUE),
            SDPerf = sd(Performance, na.rm = TRUE))

K562_all_perfs_summ$AvePerf <- round(K562_all_perfs_summ$AvePerf, 3)
K562_all_perfs_summ$SDPerf <- round(K562_all_perfs_summ$SDPerf, 3)

```
