---
title: "preciseTAD: A machine learning framework for precise TAD boundary prediction at base pair resolution"
csl: styles.ref/genomebiology.csl
output:
  word_document:
    reference_docx: styles.doc/NIH_grant_style.docx
  pdf_document: default
bibliography: References/references.bib
--- 

Spiro C. Stilianoudakis^1^ (stilianoudasc@mymail.vcu.edu), Mikhail G. Dozmorov^1\*^ (mikhail.dozmorov@vcuhealth.org)

^1^ Dept. of Biostatistics, Virginia Commonwealth University, Richmond, VA, 23298, USA  
^\*^ To whom correspondence should be addressed: Virginia Commonwealth University, Richmond, VA, 23298, 804-827-2055, mikhail.dozmorov@vcuhealth.org

# ABSTRACT (Spiro version)

Chromosome conformation capture combined with high-throughput sequencing experiments (Hi-C) have revealed that chromatin undergoes layers of compaction through DNA looping and folding, forming dynamic 3D structures. Among these are Topologically Associating Domains (TADs), which are known to play critical roles in cell dynamics like gene regulation and cell differentiation. Precise TAD mapping remains difficult, as it is strongly reliant on Hi-C data resolution. Obtaining genome-wide chromatin interactions at high-resolution is costly resulting in variability in true TAD boundary location by TAD calling algorithms. To aid in the precise identification of TAD boundaries we developed preciseTAD, a machine learning framework that leverages the spatial relationship of many high resolution ChIP-seq defined genomic elements, coupled with density-based clustering  and scalable partitioning techniques. Our framework precisely predicts chromosome-specific TAD boundaries on multiple cell types. We show that known molecular drivers of 3D chromatin including CTCF, RAD21, and SMC3 are more enriched at our predicted TAD boundaries compared to the boundaries identified by the popular ARROWHEAD TAD caller. Our results provide useful insights into the 3D organization of the human genome.

# ABSTRACT (MD version)

**Background.** Topologically Associated Domains (TADs) represent fundamental building blocks of the three-dimensional (3D) genome organization and regulation. Several epigenetic marks, such as CTCF, are highly enriched at TAD boundaries, suggesting a strong epigenetic component of TAD boundary formation. Several methods have been developed to leverage the growing amount of (epi)genomic annotation data for predicting TAD boundaries; however, they overlooked key characteristics of the data, such as spatial associations between a genomic annotation and a boundary. Furthermore, the number of regions containing TAD boundaries is much smaller than the rest of the genome, creating a class imbalance problem. 

**Methods.** To investigate the problem of spatial genomic relationships and class imbalance, we developed an ensemble framework for optimizing prediction of TAD boundaries. We utilized several resampling techniques (random over- and undersampling, Synthetic Minority Over-sampling TEchnique (SMOTE)) coupled with various metrics for classifier performance evaluation (Area Under Receiver Operating Characteristics (AUROC) curve, Precision-Recall curve (AUPRC), F1, Matthews Correlation Coefficient (MCC), among others) to select the best predictive model in class imbalance settings.

**Results.** Using different feature engineering and resampling strategies, coupled with elastic net-based feature selection, we systematically compared the performance of models predicting the location of TAD boundaries (Gm12878 and K562 Hi-C data at 10kb to 100kb resolutions). Precision-Recall curves were found to be best suited for evaluating model performance in class imbalance settings. Random undersampling and SMOTE-resampled data performed best for optimal parameter selection. Transcription Factor Binding Sites (TFBSs) were the best type of genomic annotations for predicting TAD boundaries when directly compared with histone modifications and chromatin states; we identified well-known CTCF, SMC3, RAD21, and several novel TFBSs as best predictors of TAD boundaries. Importantly, spatial relationships (distance between TAD boundaries and genomic annotations) were best predictors of TAD boundaries as compared with commonly used overlap counts or percent overlap measures.

**Conclusions.** Our results outline strategies for predictive modeling of 3D genomic domains using 1D genome annotation data. The accurate modeling of TAD boundaries will improve our understanding of how epigenetics shapes the 3D structure of the genome.

# Introduction

The advent of chromosome conformation capture (3C) sequencing technologies, and its successor Hi-C, have revealed a hierarchy of important 3-dimensional (3D) spatial constructs within the human genome such as chromatin loops [@rao20143d], Topologically Associated Domains (TADs) [@nora2012spatial;@dixon2012topological], and A/B compartments [@lieberman2009comprehensive]. At kilobase scale, gene promoters are often connected via distal regulatory elements, such as enhancers, through chromatin loops, thereby regulating gene expression [@Lupianez:2015aa; @Franke:2016aa]. Further out, at the megabase scale, TADs represent regions on the linear genome, that are highly self-interacting. Emerging evidence has linked TADs to critical roles in cell dynamics and cell differentiation. Studies have shown that TADs themselves are highly conserved across species and cell lines [@dixon2012topological; @krefting2018evolutionary; @nora2012spatial; @dixon2015chromatin; @rao20143d; @Schmitt2016aa]. Likewise, disruption of the boundaries that demarcate TADs and loops have been shown to lead to cancer [@hnisz2016activation; @taberlay2016three] and other disorders [@lupianez2016breaking;@Sun:2018aa;@Meaburn:2007aa]. Therefore, precisely identifying the location of TAD and chromatin loop boundaries remains a top priority in our goal to fully understand the functionality of the human genome.

Several methods have been proposed to identify the genomic coordinates of TAD boundaries throughout the linear genome (reviewed in [@Zufferey:2018aa; @forcato2017comparison]), less so for chromatin loops [@rao20143d; @Ay:2014aa; @Heinz:2010aa].  However, a key limitation among most of these TAD- and loop callers, referred hereafter as TAD callers for brevity, is that they are heavily reliant on Hi-C data *resolution*. Resolution refers to the sizes of genomic bins used to segment the linear genome as a way to deal with low signal-to-noise incurred by the high dimensional nature of Hi-C data [@li2019comparison]. Lower resolutions contribute to larger bin sizes, which lead to uncertainty in the location of TAD boundaries. Due to high sequencing costs, most available Hi-C datasets have relatively low resolution, ranging from 25 kb to 100 kb. Because increasing the resolution of Hi-C data requires a quadratic increase in the total sequencing depth, obtaining high resolution remains difficult [@schmitt2016genome]. While these low resolution Hi-C datasets can be used to probe higher order genomic patterns such as A/B compartments, more refined resolutions are necessary to accurately define TADs and chromatin loops [@fudenberg2016formation].

Another limitation among TAD callers is that they disregard prior knowledge about functional genomic elements associated with TAD and loop boundaries. The insulator binding protein, CTCF, and additional cofactors such as SMC3 and RAD21 have been hypothesized to comprise components of the loop extrusion model, whereby DNA is extruded through cohesin rings forming chromatin loops [@hansen2018recent;@sanborn2015chromatin; @fudenberg2016formation; @alipour2012self; @Mirny:2019aa; @Davidson:2019aa]. Additionally, distinct patterns of histone modifications have also been shown to be featured at boundaries, including H3K36 timethylation (H3K36me3) [@lieberman2009comprehensive;@dixon2012topological;@libbrecht2015joint]. These elements are annotated on the genome using chromatin immunoprecipitation followed by high-throughput DNA sequencing (ChIP-seq). Even at its highest (750 bp [@bonev2017multiscale]), Hi-C sequencing resolution still remains well below the resolution of ChIP-seq experiments, which ranges in the tens of base pairs [@mendoza2009genome]. Therefore, leveraging such elements in a supervised machine learning framework lends itself to the possibility of more precisely predicting the locations of TAD (or loop) boundaries at much higher resolutions. 

Here we present *preciseTAD*, an R package for precise identification of TAD(or loop) boundaries under a supervised machine learning framework. Our method builds upon an optimized random forest (RF) classification model that leverages high resolution ChIP-seq data in the form of regulatory elements (BroadHMM), histone modifications (HM), and transcription factor binding sites (TFBS). We introduce a novel technique for building RF classifiers in a boundary prediction setting composed of a resolution-specific binning process and feature engineering procedure. *preciseTAD* then employs density-based clustering (DBSCAN) and scalable partitioning around medoids (CLARA) on prediction probabilities to select the most biologically meaningful boundary coordinates on the linear genome, thereby circumventing resolution restrictions of conventional TAD- and chromatin loop-callers. We demonstrate that predictions made by *preciseTAD* are more enriched for known molecular drivers of 3D chromatin including CTCF, RAD21, SMC3, and ZNF143. Further, we show that *preciseTAD* boundaries are more conserved across cell lines, highlighting their biological significance. This improved precision in TAD and loop boundary location can provide insight into the role that epigenomics has on the spatial architecture of the human genome. [??? Rewrite. Say the main methodology first - model on 4 TFBSs, uses distance, RUS, technique for bp-level prediction, one sentence per point. Detail next - BroadHMM and histone were tested, OC, OP were tested, various sampling techniques. Conclude with findings and package availability. For MD, last part when ready to write an abstract]

# Methods

## Data sources

Within this study we used both TAD boundary and loop boundary data derived from the publically available tools ARROWHEAD [@durand2016juicebox] and Peakachu [@salameh2019supervised] respectively. ARROWHEAD is part of the Juicer suite of tools for Hi-C data analysis and visualization. To obtain TAD boundaries we applied ARROWHEAD using downloaded primary Hi-C data from Geo GSE63525 [@rao20143d] for the GM12878 and K562 cell lines (libraries HIC001-HIC018 and HIC069-HIC074 for GM12878 and K562 respectively) [??? Were they threated separately?;!!!fixed] produced with the MboI restriction enzyme (Supplementary Table 1). The contact matrices were constructed from all read pairs that uniquely aligned to the genome (MAPQ>0). The default tools for ARROWHEAD were used when extracting the autosomal genomic coordinates (GRCh37/hg19 human genome assembly) of TAD boundaries at 5 kb, 10 kb, 25 kb, 50 kb, and 100 kb resolutions (Additional File 1). For chromatin loop boundaries, we used loops identified by Peakachu at 10 kb for the GM12878 and K562 cell lines [@salameh2019supervised]. Unique boundaries were considered as the midpoints within the coordinate of each chromatin loop. Chromosome 9 was excluded from all downstream analyses due to the sparsity of the contact matrix at the 5 kb and 10 kb resolutions for the K562 cell line. Cell line-specific genomic annotations were obtained from the UCSC Genome Browser Database [@Tyner:2017aa] in the form of BroadHMM chromatin segmentations (BroadHMM), histone modifications (HM), and transcription factor binding sites (TFBS) (GRCh37/hg19 human genome assembly, Supplementary Table 2). 

[???added spectralTAD]

## Shifted-binning for binary classification

In Hi-C, each chromosome is binned into non-overlapping regions of length *r*, typically 5 kb and above. The *r* parameter defines the resolution of Hi-C data. Here, we designed a strategy called _shifted binning_ that partitions the genome into regions of the same length *r*, but with middle points corresponding to boundaries defined by the original binning. 

To create shifted binning, the first shifted bin was set to start at half of the resolution *r*, and continued in intervals of length *r* until the end of the chromosome (*mod r* + *r/2*). The shifted bins, referred hereafted as bins for simplicity, were then defined as boundary-containing regions (*Y = 1*) if they contained a TAD (or loop) boundary, and non-boundary regions (*Y = 0*) otherwise, thus establishing the binary response vector (**Y**) used for classification (Figure 1).

## Feature engineering

Cell line-specific genomic annotations were used to build the predictor space for our boundary prediction framework. Bins were annotated by one of either the number of overlaps with an annotation (*Overlap Count (OC)*), the percent of overlap between the bin and the total width of genomic annotation regions overlapping it (*Overlap Percent (OP)*), the average signal strength of the corresponding annotation (*Peak Signal Strength*), or the distance in bases from the center of the bin to the center of the nearest genomic annotation region (*Distance*). A ($log_2$+1)-transformation [??? Shouldn't it be log2 + 1?; yes, fixed] of distance was used to account for the skewness present in the distributions of genomic distances (Supplementary Figure 1). Models built using a *Peak Signal Strength* predictor space were only composed of histone modifications and transcription factor binding sites because BroadHMM chromatin segmentations lack signal values.

## Addressing class imbalance

To assess the impact of class imbalance (CI), defined as the proportion of boundary regions to non-boundary regions, we evaluated three re-sampling techniques including *Random Over-Sampling (ROS)*, *Random Under-Sampling (RUS)*, and *Synthetic Minority Over-Sampling Technique (SMOTE)*. For ROS, the minority class was sampled with replacement to obtain the same number of data points in the majority class. For RUS, the majority class was sampled without replacement to obtain the same number of data points in the minority class. For SMOTE, under-sampling was performed without replacement from the majority class, while over-sampling was performed by creating new synthetic observations using the $k=5$ minority class nearest neighbors [@chawla2002smote] (implemented in the `DMwR` v.0.4.1 R package). We restricted the algorithm to 100% over-sampling and 200% under-sampling, which creates perfectly balanced classes. 

## Establishing optimal data level characteristics for TAD boundary region prediction

Random forest (RF) classification models (the `caret` v.6.0 R package [@kuhn2012caret]) were built to compare model performances between combinations of data resolutions, feature engineering procedures, and re-sampling techniques. A *holdout chromosome* technique was devised as a way for unbiased model evaluation on each autosomal chromosome. The $i^{th}$ holdout chromosome was identified and a data matrix, $A_{N \times (p+1)}$, was constructed by combining the binned genome from the remaining chromosomes ($1,2,\cdots, i-1,i+1,\cdots,21,22$), where $N=[n_{1} n_{2} \cdots n_{21} n_{22}]'$ and $n_{k}$ is the length of chromosome *k* after being binned into non-overlapping regions of resolution *r*, such that $k \ne i$. Re-sampling was then performed on $A$ and an RF classifier was trained on $A$ using 3-fold cross-validation to tune for the number of annotations, *p*, to consider at each node (*mtry*). The number of trees (*ntree*) that were aggregated for each RF model was set to 500. The minimum number of observations per root node (*nodesize*) was set to 1. The binned data for the holdout chromosome $i$ was reserved for testing. Models were evaluated using Balanced Accuracy (BA), defined as the average of sensitivity and specificity:

$$BA = \dfrac{1}{2}\left( sensitivity + specificity \right) = \dfrac{1}{2}\left( \dfrac{TP}{TP+FN} + \dfrac{TN}{TN+FP} \right)$$

where TP refers to the number of bins correctly identified as containing a boundary (true positives), FP refers to the number of bins incorrectly identified as containing a boundary (false positives), TN refers to the number of bins correctly identified as not containing a boundary (true negatives), and FN refers to the number of bins incorrectly identified as not containing a boundary (false negatives). Each of these quantities are obtained from the confusion matrix created by validating the model on the test data. The process was repeated for each $i^{th}$ holdout chromosome and performances were aggregated using means and standard deviations.
[??? Define N and p asap introducing. What is i? also define immediately. Adjust this whole paragraph accordingly. There's a term "hold-out" - isn't it how you should define it?; !!!rewrote] 

## Feature selection and predictive importance

Many genomic annotations, notably architectural proteins, tend to exhibit an extensive pattern of colocalization (correlation) [@van2014insulator]. To suitably reduce the predictor space and improve computational efficiency, while maintaining optimal performance, we implemented recursive feature elimination (RFE). In doing so, we estimated the near optimal number of necessary features to include in the best fitting RF model. The best performing subset was identified, ranging from 2 to the maximum number of features by powers of 2. We then aggregated the predictive importance of the union of the optimal set of features across chromosomes using the mean decrease in node impurity among permuted features in out-of-bag samples to determine the most common and top ranked annotations for predicting boundary regions. 

## Boundary prediction at bp resolution using *preciseTAD*

To investigate whether we could alleviate resolution limitations of conventional TAD and chromatin loop calling tools, we developed *preciseTAD*, an algorithm that leverages a random forest model in conjunction with density-based and partitioning techniques to predict boundaries at base pair (bp) resolution. To demonstrate, we implemented an optimally built RF model using the framework described above. That is, a random forest model was built on the optimal combination of data resolution (binning), predictor type (predictor space), re-sampling technique (class balancing correction), and top ranked annotations (most informative genomic elements). 

[??? There is a big gap there. Describe the construction of dependent vector Y and predictor matrix _for each base_;!!!talk about in meeting; specify that each base pair has own prob; don't use "base pair" only "base" or "base level"]

First the vector, $p_{n_{i}}$, denoting each base pair's probability of being a boundary point from the RF model, was extracted, where $n_{i}$ represents the length of chromosome $i$. Next, DBSCAN [??? We need to define what to italicize. Check below, make consistent throughout the manuscript;!!!talk about in meeting] (version 1.1-5) was applied to the matrix of pairwise genomic distances between base pairs with $p_{n_{i}}=1$. This was to avoid the inflation of predicted boundaries that can occur naturally when dealing with such fine resolution, namely, due to spatially close base pairs with similar predictor profiles (i.e. similar overlap counts, distances, etc.). The DBSCAN algorithm takes two parameters, *eps* ($\epsilon$) and *MinPts*. The *eps* parameter was assigned as the respective data resolution. The heuristic being that density-reachable base pairs with genomic distances less than resolution should occupy the same designated cluster. The corresponding *MinPts* parameter was set to recommended value of 3, representing $1+dim(data)$ [@hahsler2019dbscan]. The resulting clusters of highly predictive base pairs identified by DBSCAN were termed *preciseTAD boundary regions* (PTBR). To precisely identify a single base pair among each PTBR, preciseTAD then implements an extension of partitioning around medoids (PAM), known as CLARA (Clustering Large Applications) for better scaling and more computational efficiency [@reynolds2006clustering; @wei2000empirical]. The corresponding cluster medoid was defined as a *preciseTAD boundary point* (PTBP), making it the most representative and biologically meaningful base pair coordinate within each clustered PTBR.

## Comparing called vs. predicted boundaries

Next, we assessed the biological significance of our predicted boundaries with respect to the enrichment profiles of several known molecular drivers of 3D chromatin architecture including CTCF, RAD21, SMC3, and ZNF143 ChIP-Seq peaks. To do so, we used the computeMatrix [??? Again, I expected italics, but decide and correct;!!!talk about in meeting] and plotHeatmap tools offered by deepTools version 2.0 [@ramirez2016deeptools2] via integration with Galaxy version 3.3.2.0.0 [@afgan2018galaxy]. Additionally, we compared the median $log_2$ genomic distances between TAD boundaries and the same top predictive ChIP-seq annotations using Wilcoxon Rank-Sum test. Furthermore, we compared the overlap between predicted and called boundaries in GM12878 and K562 cell lines. Boundaries were first flanked by resolution, *r*, and overlaps were visualized using Venn diagrams from the `Vennerable` R package (version 3.1.0). Overlaps were further quantified using Jaccard index defined as

$$J_{(A,B)} = \dfrac{A \cap B}{A \cup B}$$

where A and B represent genomic regions created by flanking called and predicted boundaries. That is, between cell lines, the number of overlapping flanked boundaries divided by the total number of flanked boundaries. Wilcoxon rank sum tests were used to compare chromosome-specific Jaccard indices across cell lines, between *preciseTAD* boundaries and both ARROWHEAD and Peakachu boundaries, respectively. All statistical analyses were performed in R version 4.0.1. The alpha level of significance was set to 0.05 for all statistical tests.

<!--using the `EnrichedHeatmap` R package (version 1.14.0) [@gu2018enrichedheatmap]. For each boundary (both called and predicted), a 5000 bp flank was created on either side. The flanking was broken up into 50 bp segments, for a total of 100 windows on both sides of a given boundary. A coverage value was generated for each window with respect to a given ChIP-seq annotation, as the mean signal averaged by the width of the window, denoted by,

$$v_{c} = \dfrac{\Sigma_{j}^{m} \Sigma_{i}^{n}x_{ij}w_{ij}}{L}$$

where $x_{ij}$ is the total number of base pairs of annotation $i$ in window $j$ and $w_{ij}$ is the number of base pairs that overlap between annotation $i$ and window $j$. The denominator, $L$, is the width of the windows (here, $L=50$). The rows of the heatmaps are ordered by enriched scores. The enriched scores are calculated as the sum of coverage values weighted by the distance to the flanked boundary, denoted by

$$s_{e} = \Sigma_{d=1}^{n_{1}}\left(\dfrac{x_{1d}* d}{n_{1}} \right) + \Sigma_{u=1}^{n_{2}}\left(\dfrac{x_{2u}* (n_{2} - u + 1)}{n_{2}} \right)$$
where $n_{1}$ and $n_{2}$ represent the number of downstream and upstream coverage values to sum over. Here, $n_{1}=n_{2}=100$.-->

# Results

## Developing a machine learning framework for optimal TAD boundary prediction

We developed a machine learning framework<!--, refered to as *TADRF*,--> aimed at determining the optimal set of data level characteristics necessary for topologically associated domain (TAD) boundary prediction. We chose the random forest (RF) machine learning algorithm as our binary classification tool. The reason for choosing RF was two-fold: (1) In order to devise a tunable prediction rule in a supervised learning framework that is both robust to overfitting and able to handle multiple correlated predictors, and (2) to allow for an interpretable ranking of predictors with respect to their ability to predict boundary regions [@boulesteix2012overview]. We then developed *preciseTAD*, an algorithm which leverages an optimally built RF to precisely predict the genomic coordinates of both TAD and chromatin loop boundaries at base pair resolution.

Our framework is resolution-specific and uses called TAD or loop boundaries as ground truth to establish TAD(loop)-boundary and non-TAD(loop) boundary regions. To demonstrate, we applied our framework to publically available replicate Hi-C data sets from the GM12878 and K562 cell lines obtained from GEO GSE63525 (Supplementary Table 1) [??? Update table and methods with relevant data only, not individual samples;!!!fixed]. TADs were subsequently called using the ARROWHEAD pipeline from the juicer toolbox [@durand2016juicer] at five data resolutions: 5 kb 10 kb, 25 kb, 50 kb, and 100 kb. For loop boundaries, we opted to use boundaries obtained by the Peakachu prediction tool for the GM12878 and K562 cell lines at 10 kb resolution [@salameh2019supervised]. [??? TAD and loop boundaries should be distinguished, to describe when we have all results. For MD] [??? Define that ARROWHEAD data constitute the main results. For MD]

Boundary regions were defined as regions containing a called boundary ($Y = 1$), while non-boundary regions were defined as genomic bins that did not contain a called boundary ($Y = 0$) (Figure 1A, see Methods). The total number of TADs, TAD boundaries, and the number of genomic bins expectedly decreased with the decreased resolution of Hi-C data (Table 1, Supplementary Table 2 [??? I can see numbers for K562 (?) only? There's a discrepancy with legend.!!!fixed, need to added spectralTAD]). The number of non-boundary regions highly outnumbered boundary regions, with results consistent for loop boundaries as well (Supplementary Table 3). Such disproportional presence of examples in one class is known as a "class imbalance" problem that negatively affects predictive modeling [@prati2011survey; @wei2013role]. To address class imbalance, we evaluated the effect of three re-sampling techniques. *Random over-sampling* (ROS) was defined as sampling with replacement from the minority class (boundary regions). *Random under-sampling* (RUS) was defined as sampling with replacement from the majority cluss (non-boundary regions). Lastly, we tested *Synthetic minority over-sampling technique* (SMOTE), which is a combination of both random over- and under-sampling to create balanced classes [@chawla2002smote] (see Methods). 

A total of 77 [??? 77 in the table?;!!!fixed] cell-line-specific functional genomic annotations were used to build the predictor space. These included BroadHMM chromatin segmentations, histone modifications (HM), and transcription factor binding sites (TFBS) (Supplementary Table 4). Four feature engineering procedures were developed to quantify the association between genomic annotations and bins (Figure 1B). These include signal strength association (Signal), direct (OC), proportional (OP), and spatial (Distance) relationships (see Methods). 

![**Resolution-specific data construction and feature engineering used for downstream random forest modeling.** (A) The linear genome was binned into non-overlapping resolution-specific intervals (see Methods). The response vector **Y** was defined as 1/0 if a genomic bin overlapped/did not overlap with a TAD boundary, respectively. (B) Four types of associations between bins and genomic annotations (green shapes) were considered to build the predictor space including _Average Peak Signal_ (Signal), _Overlap Counts_ (OC), _Overlap Percent_ (OP), and ($log_{2}$) _Distance_.](Figures/figure1_model_construction_and_predictor_types.png)

In summary, we considered combinations of data from two cell line *L = {GM12878, K562}*, five resolution *R = {5 kb, 10 kb, 25 kb, 50 kb, 100 kb}*, four types of predictor space *P = {Signal, OC, OP, Distance}*, and three re-sampling technique *S = {None, RUS, ROS, SMOTE}* (Figure 2). Once the model inputs were established, a random forest classifier was trained on $n-1$ autosomal chromosomes, while reserving the $i^{th}$ chromosome for testing. Three-fold cross-validation was used to tune the *mtry* hyperparameter, while *ntree* and *nodesize* were fixed to default values of 500 and 1 respectively. Model performance was evaluated by aggregating the mean balanced accuracy (BA) across each holdout chromosome (see Methods). These strategies allowed us to select the best performing model.

![**A diagram of the machine learning framework.** Step 1 defines the chromosome-specific predictor-response matrix **A** of $N$ genomic bins (rows), $p$ genomic annotations, and one response vector $Y$ ($p+1$ columns). Resolution-specific data (5 kb, 10 kb, 25 kb, 50 kb, or 100 kb) and feature engineering procedure (overlap count (OC), overlap percent (OP), $log_{2}$ distance (Distance)) for the $n-1$ autosomal chromosomes. Step 2 is to reserve the predictor-response matrix for the holdout chromosome $i$ as the test data. Step 3 is to apply a re-sampling technique to the training set (no re-sampling, random over-sampling, random under-sampling, or SMOTE re-sampling). Step 4 is to train the random forest model and perform 3-fold cross-validation to tune for the *mtry* parameter. Finally, step 5 is to validate the model on the separate test data and evaluate model performance using balanced accuracy (BA).](Figures/figure2_ensemble_framework.png) [??? Define all indices, what is N, p+1, i?;!!!defined in methods, define here again?]


<!-- Using ARROWHEAD, we obtained a total of 8052, 7676, 4670, 2349, and 1031 called TADs  across each resolution respectively (Table 1). From the called TADs, a total of 15468, 14253, 8363, 4224, and 1883 unique TAD boundaries were obtained (Table 1). The resolution-specific approach we developed to create boundary vs non-boundary regions resulted in a total of 535363, 267682, 107073, 53537, and 26768 genomic bins. The class imbalance among the genomic bins was both severe and invariant toward resolution, resulting in 0.03, 0.05, 0.08, 0.08, and 0.07 for each resolution respectively (Table 1). Boundary data summaries were similar for K562 cell line, as well as for Peakachu defined boundaries (Supplementary Tables 3-4). -->

| Resolution | Total number of called TADs | Total number of unique TAD boundaries | Total number of genomic bins | Class imbalance |
|:----------:|:---------------------------:|:-------------------------------------:|:----------------------------:|:---------------:|
|5 kb        |8052                         | 15468                                 | 535363                       | 0.03            |
|10 kb	     |7676 	                       | 14253                                 | 267682                       | 0.05            |
|25 kb	     |4670                         | 8363                                  | 107073                       | 0.08            |
|50 kb	     |2349	                       | 4224                                  | 53537                        | 0.08            |
|100 kb	     |1031                         | 1883                                  | 26768                        | 0.07            |
Table: Domain data and class imbalance summaries across resolutions for ARROWHEAD on the GM12878 cell line.

## Random under-sampling, distance-based predictors, and high-resolution Hi-C data provide optimal performance for boundary prediction

Expectedly, when using data with class imbalance present, that is, no re-sampling, the models exhibited low balanced accuracies, with very little variability among different resolutions (Figure 3). Similarly, poor performances were found when using ROS as well. However, RUS and SMOTE re-sampling led to drastic improvement in performance, especially at higher resolutions. We found that RUS marginally outperformed SMOTE as the most optimal class balancing technique for all resolutions and predictor types. These results suggest that simple random under-sampling can significantly improve TAD boundary region prediction. 

Additionally, we found that using a distance-type predictor space yielded substantially higher balanced accuracies when compared to the peak signal stength, overlap count, and overlap percent predictor types. As with class balancing techniques, this improvement was less evident at lower resolutions. These results were consistent for the K562 cell line (Supplementary Figure 2). Random forest models built on Peakachu loop boundaries with SMOTE resampling only marginally outperformed RUS for both GM12878 and K562 cell lines (Supplementary Figure 3). Five kilobase resolution genomic bins was found to result in optimal prediction for both TAD and loop boundaries, on both cell lines. Our results indicate that random under-sampling, distance-type predictors, and high-resolution Hi-C data provide the optimal set of data level characteristics for both TAD and loop boundary prediction.

<!--
Interestingly, for the optimal re-sampling and predictor type, we found that performances peaked at 10 kb resolution and then degraded as data resolution decreased. The reason for the improved performance between 5 kb and 10 kb data resolutions can be attributed to the sparsity in the interaction frequency matrices at finer resolutions. This sparsity may lead to inaccurate TAD calling and, subsequently, to worse model performance. These results suggest that finer resolution of Hi-C data is not always optimal for accurate TAD calling and prediction, and sparsity of the data needs to be considered. Furthermore, performances tended to be much more variable between chromosomes at lower resolutions, evidenced by the wider error bars for the 50 kb and 100 kb resolutions. These results were found to be consistent for the K562 cell line (Supplementary Figure 2). In summary, our computational framework showed that using random under-sampling, distance-type predictors, and Hi-C data at 10kb resolution yields an optimally performing cell line-specific random forest classification model for TAD boundary prediction.
-->

![**???[needs updating with new framework, takes longest, do last - ??? Is this current?;talk about in meeting] Distance-type predictors combined with random under-sampling yielded optimal TAD boundary region predictive performance for GM12879 ARROWHEAD TAD boundaries.** Balanced accuracy is compared across resolution, within each predictor-type: (A) Signal, (B) OC, (C) OP, and (D) Distance, and across re-sampling techniques: no re-sampling (None; red), random over-sampling (ROS; green), random under-sampling (RUS; blue), and synthetic minority over-sampling (SMOTE; purple).](Figures/figure3_performances.png)

## Transcription factor binding sites outperform histone- and chromatin segmentation-specific models

We hypothesized that the type of genomic annotations may also affect the predictive performance. Using the established optimal settings (RUS, Distance), we built separate random forest models using BroadHMM chromatin segmentations, histone modifications (HM), and transcription factor binding sites (TFBS). We found that models built on TFBSs outperformed other annotation-specific models, and these results were consistent for loop boundaries, for both cell lines (Figure 4A; Supplementary Figures 4A). These results suggest that TFBS are the primary drivers of TAD and loop boundary formation in both the GM12878 and K562 cell lines. 

## Predictive importances confirmed biological functionality of CTCF, RAD21, SMC3, and ZNF143 at TAD boundaries

We sought to further optimize our TAD boundary region prediction model by performing recursive feature elimination to avoid overfitting and select only the most influential TFBS across all autosomal chromosomes. We were able to obtain near-optimal performance using approximately eight TFBS (Figure 4B; Supplementary Figures 4B). However, given that we trained our model on chromosome-specific data, the most significant annotations were found to vary for each chromosome. To determine transcription factors most important for boundary prediction, we clustered the predictive importances of the top eight significant TFs across chromosomes. We found that, similar to other studies [@sanborn2015chromatin; @weintraub2017yy1; @gonzalez2017znf143], CTCF, RAD21, SMC3, and ZNF143 transcription factors were most predictive of TAD and loop boundaries for all chromosomes (Figure 4C; Supplementary Figures 4C). We further optimized our model by only considering these top informative TFBS when building the random forest, thereby decreasing computational burden while maintaining high predictive performance. In summary, our framework was able to yield the top molecular drivers of the 3D architecture of the human genome, components of the popular loop extrusion model [@hansen2018recent;@sanborn2015chromatin; @fudenberg2016formation; @alipour2012self; @Mirny:2019aa; @Davidson:2019aa]. 

<!--
To summarize, the optimally built cell line-specific random forest model under our computational framework was found to be one built using 10 kb resolution data, leveraging distance-type predictors for the CTCF, RAD21, SMC3, and ZNF143 transcription factor binding sites, while implementing random under-sampling to balance TAD and non-TAD boundary defined genomic bins.
-->

![**Binding of SMC3, Rad21, CTCF, and Znf143 transcription factors accurately predicts TAD and loop boundaries in GM12878 cell line.** (A) Barplots comparing performances of TAD (ARROWHEAD) and loop (Peakachu) boundary prediction models using histone modifications (HM), cis-regulated elements (BroadHMM), transcription factor binding sites (TFBS), in addition to a model containing all three classes (ALL). (B) Recursive feature elimination (RFE) analysis used to select the optimal number of predictors. Error bars represent standard deviation from the cross-validated accuracy across each chromosome. (C) Clustered heatmap of the predictive importance for the union of the top 8 chromosome-specific most predictive TFBSs.](Figures/figure4_annots_specifc_rfe_importances_arrowhead_peakachu.png)

## *preciseTAD* identifies precise and biologically relevant locations of TAD boundaries

Using our optimally built random forest model trained on ARROWHEAD/Peakachu boundaries, we attempted to predict TAD/loop boundaries at base resolution. Intuitively, the predictor-response space is built on a base-resolution level, and the model trained on a bin-level space predicts the probability of each base being a boundary. Our method, referred to as *preciseTAD*, leverages a user-specified [??? We need pre-trained models and understanding how they perform on different cell lines;!!!working on it] model with density-based hierarchical clustering (DBSCAN) and a scalable partitioning around mediods clustering (CLARA) to predict the boundary location ad base resolution (see Methods).

When built using ARROWHEAD ground truth boundaries at 5 kb, *preciseTAD* was able to predict a total of ??? and ??? boundaries for GM12878 and K562 cell lines respectively. We reported less predicted TAD boundaries than ARROWHEAD (Table 1, Supplementary Table 2) [??? Where is this info?;!!!talk about in meeting]. This can be attributed to ARROWHEAD's boundaries frequently being separated by gaps, the effect especially pronounced near sparse areas of Hi-C contact matrices (Figure 5A) [??? I don't see it, data not shown?]. However, under the framework of *preciseTAD*, any two TADs are inherently conjoined by only one predicted TAD boundary, leading to comparatively less TAD boundaries. [??? Unclear explanation, so what? preciseTAD is driven by genomic annotations. May it be too stringent thresholds? This all may be for the discussion, if we have a good understanding why] We also found that predicted TAD boundaries identified by *preciseTAD* were visually more likely to demarcate high concentrations of inter-chromosomal contacts as seen on a Hi-C contact matrix (Figure 5A). [???add peakachu totals when ready]

Next, we evaluated the biological significance of *preciseTAD* boundaries. Signal heatmaps [??? Make sure to mention DeepTools in Methods;!!!added] indicated that our predicted boundaries were more enriched for CTCF sites than either ARROWHEAD or Peakachu boundaries alone (Figure 5 B-C). Likewise, *preciseTAD* boundaries were also more enriched for other molecular drivers of 3D chromatin including RAD21, SMC3, and ZNF143 for both GM12878 and K562 cell lines (Supplementary Figures 8-9). When compared to called TAD or loop boundaries, *preciseTAD* boundaries were found to be statistically significantly closer to the same cell line-specific top ranked TFBS (p=??? and p=??? vs ARROWHEAD and Peakachu respectively) (Figure 5D, Supplementary Figure 10-11). We also inspected the effect of resolution on locations of our predicted TAD boundaries. We found that *preciseTAD* boundaries exhibited higher pairwise Jaccard indices between adjacent resolutions than ARROWHEAD boundaries, thus implying stronger invariance toward resolution (Figure 5E).

![**preciseTAD boundaries are enriched in CTCF sites.** (A) The location of preciseTAD (green) vs. ARROWHEAD (blue) boundaries on GM12878 (chr 1: 70600000-71530000). The black line represents the probability of each base being a TAD boundary. The green vertical lines represent the *preciseTAD boundary points* (PTBP). A zoomed-in portion of the genome shows a yellow-highlighted cluster of bases with high probability of being a boundary, the *preciseTAD boundary region (PTBR). (B) Heatmaps comparing the enrichment of CTCF signal around preciseTAD and ARROWHEAD TAD boundaries, and (C) around preciseTAD and Peakachu loop boundaries. (D) $Log_{2}$ genomic distances from boundaries to nearest CTCF sites. (E) Pairwise Jaccard indices shows better overlap among *preciseTAD*-detected boundaries across resolutions (upper triangular) as compared to ARROWHEAD (lower triangular).](Figures/figure5_enrichment_and_log2dist_ctcf.png) [??? Panel E - do we have it for Peakachu? - stretched, can be put in figure. Can you color triangulars blue/green for Arrowhead/preciseTAD, green for preciseTAD?;!!!can't be done for peakachu because we only have 1 resolution (10kb)]


## *preciseTAD* boundaries are conserved across cell lines

TAD boundaries are known to be relatively conserved across cell lines [@dixon2012topological; @krefting2018evolutionary; @nora2012spatial; @dixon2015chromatin; @rao20143d; @Schmitt2016aa]. To assess conservation, we evaluated the overlap between cell-line-specific boundaries detected by *preciseTAD*, ARROWHEAD, and Peakachu after flanking them by the resolution of the Hi-C data. Boundaries involving ARROWHEAD were flanked by 5 kb, while boundaries involving Peakachu were flanked by 10 kb. We found that a significant proportion of flanked boundaries predicted by *preciseTAD* overlapped between GM12878 and K562. Specifically, 45%??? and 61%??? of *preciseTAD* boundaries were conserved across cell lines when built on ARROWHEAD and Peakachu boundaries respectively (Figure 6A). Additionally, the median Jaccard index (MJI) was found to be 0.472 (IQR=0.441-0.503; p=???) and 0.647 (IQR=0.646-0.647; p=???) for *preciseTAD* predicted TAD and loop boundaries (Supplementary Table 5). Comparatively, only 25% (MJI=0.284; IQR=0.268-0.301) and 49% (MJI=0.509; IQR=0.503-0.515) of called/predicted ARROWHEAD and Peakachu boundaries were conserved (Figure 6A, Supplementary Table 5). These results demonstrate that boundaries predicted using genomic annotations (*preciseTAD*) are better conserved across cell lines.

The majority of boundaries predicted by the ARROWHEAD-trained *preciseTAD* model represented a subset of the larger group of boundaries predicted by the Peakachu-trained model (Figure 6B). This is expected as loop boundaries (Peackachu) are more abundant, while TAD boundaries (ARROWHEAD) represent the narrower level of the 3D chromatin organization. 83% and 75% of predicted TAD and loop boundaries overlapped with each other for GM12878 and K562 cell lines, respectively (Figure 6B). Together with the results shown on Figure 4, the high overlap between boundaries predicted by ARROWHEAD- and Peakachu-trained models suggests that TAD and loop boundaries may be driven by similar protein complexes.

![**preciseTAD boundaries are more conserved between the GM12878 and K562 cell lines.** (A) Venn diagrams illustrating the overlap between GM12878- and K562-specific predicted and called boundaries. (B) Venn diagrams illustrating the agreement between boundaries predicted using ARROWHEAD- and Peakachu-trained models.](Figures/figure6_venn_diagrams.png) 
[??? What is the difference between leftmost Venn diagrams on panel A?] [??? What are the numbers?;!!!talk in meeting; add indication of what ground truth is for preciseTAD]

# Discussion

We present *preciseTAD*, a machine learning approach for precise prediction of TAD or loop boundaries from functional genomic annotations. *preciseTAD* leverages a random forest (RF) classification model built on ground truth TAD/loop boundaries obtained from a TAD/loop calling tools and ChIP-seq defined genomic annotations as the predictor space. We benchmarked *preciseTAD* against two boundary calling tools, ARROWHEAD [@durand2016juicebox], an established TAD-caller, and Peakachu [@salameh2019supervised] a recently published algorithm for predicting chromatin loops. We applied *preciseTAD* on cell line-specific boundaries and ChIP-seq data from both the GM12878 and K562 cell lines. We first optimized our RF model by systematically comparing different combinations of genome binning (resolution), feature engineering procedures, and re-sampling technique addressing class imbalance. We show that distance between boundary regions and genomic annotations coupled with random undersampling technique help to form the predictor space resulting in optimal model performance. We demonstrate that binding of four transcription factors (SMC3, Rad21, CTCF, Znf143) are sufficient for accurate TAD and loop boundary predictions. The model predicts probability for each base to be a baoundary, and, coupled with spatial clustering (DBSCAN) and scalable partition around medoids clustering (CLARA), allows for the detection of boundaries at the base-level resolution. 

Our random forest framework yielded several interesting observations. First, we showed that RF models built using *distance*-type predictors outperformed models built on previously published feature engineering techniques including signal strength, overlap counts and overlap percents [@mourad2016computational; @Moore:2015aa; @Al-Bkhetan:2018aa; @kai2018predicting]. We further demonstrated that class imbalance hinders boundary prediction, but can be effectively addressed by a simple random under-sampling technique. The unaddressed class imbalance problem in previous studies [@mourad2016computational; @Moore:2015aa; @Al-Bkhetan:2018aa] We showed that information about only four transcription factors (SMC3, Rad21, CTCF, Znf143) is necessary and sufficient transcription for accurate boundary prediction, outperforming histone modification- and BroadHMM-built models [@Moore:2015aa; @Al-Bkhetan:2018aa]. These are known components of the loop extrusion model, an established theory for how loops are made by a ring-shaped adenosine triphosphatase complex called cohesin [@hansen2018recent;@sanborn2015chromatin; @fudenberg2016formation; @alipour2012self; @Mirny:2019aa; @Davidson:2019aa]. Interestingly, the same transcription factors accurately predicted both TAD and loop boundaries, suggesting similarity of the mechanisms of TAD and loop formation. Although our observations contradict a previous study showing histone marks alone were effective in predicting TAD boundaries [@huang2015predicting], our findings are backed by a large body of literature [??? Add REFs]. This suggested that the random forest model, when tuned and feature engineered correctly, is highly effective in predicting boundary regions. 

Besides balanced accuracy (BA), we investigated five other performance metrics, including accuracy, area under the receiver operating characteristic curve (AUROC), precision, F1-score, and area under the precision-recall curve (AUPRC) (Supplementary Tables 6-7 [??? Merge them into one Excel with two sheets - same message]). The accuracy metric can be artificially inflated by true negatives (TN), the set of genomic bins correctly predicted as not containing a ground truth boundary [??? Is it because of class imbalance?; add detail]. AUROC captures how a model generally performs accross different thresholds. However, it doesn't place more emphasis on one class over the other, so it does not reflect the minority class well [??? So, another class imbalance problem? Define class imbalance message early, why you investigated 5 other metrics]. Precision indicates the rate at which positive predictions are correct and can be artificially deflated by low proportions of true positives (TP), the set of genomic bins correctly predicted as containing a ground truth boundary. While F1-score is a composite metric, it can be very sensitive towards disparate values for precision and recall. Lastly, AUPRC is insensitive toward class imbalance and also omits from its calculation TN values [??? So why didn't you use it? for MD]. All of these are important considerations to make when choosing a performance metric. For these reasons we opted to report the balanced accuracy (BA). The BA benefits from incorporating all components of the confusion matrix, while also being sensitive to class imbalance, a necessary characteristic when comparing performances to models built using no data re-sampling. [??? The logic is messed when reading this paragraph.]

The performance of *preciseTAD* was found to be empirically better [??? As judged by what?] than both ARROWHEAD and Peakachu ground truth boundaries. Guided by both low-resolution Hi-C data and high-resolution genome annotation data, *preciseTAD* predicts base-level resolution boundaries, alleviating resolution limitations of Hi-C data. We show that, unlike ARROWHEAD, *preciseTAD* does not inflate the number of predicted boundaries [??? Where did you show this? TBD], instead, providing only the most biologically meaningful boundaries that demarcate regions of high inter-chromosomal interactions. *preciseTAD* boundaries were found to be more enriched for known architectural transcription factors including CTCF, RAD21, SMC3, and ZNF143 [??? So what?]. Likewise *preciseTAD* boundaries were found to be more conserved between GM12878 and K562 cell lines, further highlighting their biological significance. [??? So what?]

A limitation of *preciseTAD* is that it is dependent on "ground truth" boundaries provided by a user-defined TAD caller. Given the wide variery of TAD callers and their variable performance [@Zufferey:2018aa; @forcato2017comparison], it is hard to define "ground truth" TAD boundaries. Ideally we would benchmark *preciseTAD* against simulated boundaries. While methods for simulating Hi-C data sets wish boundary annotations exist [@forcato2017comparison; @zheng2020freehi], methods for simulating the associated genomic annotations (the main component guiding *preciseTAD* predictions) are lacking. Given *preciseTAD* can be trained on the whole-genome data, we feel that the total number of TAD/loop boundaries is sufficient to guide learning of the association between genomic annotations and boundaries for precise boundary predictions.

Another limitation of *preciseTAD* is that it does not provide hierarchical boundaries, but instead provides the coordinates of boundary points and regions. Studies have shown evidence of the hierarchical nature to the 3D architecture of the human genome [@hansen2018recent; @weinreb2016identification; @fraser2015hierarchical]. In such a hierarchy, the boundaries provided by *preciseTAD* can be interpreted as the lowest level of boundaries [??? This can be debated. We are training on and predicting certain level of boundaries. Suggesting discussing that false positives detected by preciseTAD may represent boundaries at finer resolution].

In summary, we demonstrate that TAD/loop boundary prediction is a multi-faceted problem requiring consideration of multiple statistical and biological properties of genomic data. Simply considering the properties of Hi-C contact matrices ignores the fundamental roles of known molecular drivers of the 3D chromatin structures. Instead, we propose a supervised machine learning framework that leverages both Hi-C contact matrix information and genomic annotations. Our method introduces three concepts - *shifted binning*, *distance*-type predictors, and *random undersampling* - which we use to build random forest classification models for predicting boundary regions. Our method is able to bridge the resolution gap between 1D ChIP-seq annotations and 3D Hi-C sequencing data for more precise and biologically meaningful boundary identification. We introduce *preciseTAD*, an open source R package for leveraging random forests to predict TAD/loop boundaries at base resolution. We hope that *preciseTAD* will serve as an efficient and easy-to-use tool to further explore the 3D organization of the genome.


<!--
The two proteins differ in that YY1 preferentially
occupies interacting enhancers and promoters, whereas CTCF
preferentially occupies sites distal from these regulatory elements that tend to form larger loops and participate in insulation.
Deletion of YY1 binding sites or depletion of YY1 can disrupt
enhancer-promoter contacts and normal gene expression.
Thus, YY1-mediated structuring of enhancer-promoter loops is
analogous to CTCF-mediated structuring of TADs, CTCF contact domains, and insulated neighborhoods. This model of
YY1-mediated structuring of enhancer-promoter loops accounts
for diverse functions reported previously for YY1, including contributions to both gene activation and repression and to gene
dysregulation in cancer. ["YY1 Is a Structural Regulator
of Enhancer-Promoter Loops"]
-->





# Supplementary Legends

**Additional File 1**. An example script for applying the ARROWHEAD tool to in situ Hi-C data (HIC001-HIC018) for resolutions 5kb, 10kb, 25kb, 50kb, 100kb to obtain chromosome-specific TAD boundaries on the GM12878 cell line. Prior to implementing SpectralTAD, the dump command offered by juicer [@durand2016juicer] was used to extract the contacts in sparse data matrix format.

**Supplementary Table 1.** A complete list of the Hi-C data libraries obtained from GEO GSE63525 [@rao20143d] used to obtain the locations of topologically associating domains for ARROWHEAD, as well as the locations for the cell line specific .txt files of loop boundaries obtained by Peakachu. [@salameh2019supervised].

**Supplementary Table 2.** Domain boundary and class imbalance summaries from ARROWHEAD for the K562 cell line. [???add spectralTAD]

**Supplementary Table 3.** Loop boundary and class imbalance summaries from Peakachu 10 kb resolution for both the GM12878 and K562 cell lines respectively.

**Supplementary Table 4.** A complete list of the genomic annotations used to build the predictor space for all downstream models. The GRCh37/hg19 human genome assembly was used. "Genomic Class" - broad category of genomic features, "Element" - names of genomic features, "Cell Type-Specific Source" - download URL specific to the cell line (not all annotations were provided by the same institutions).

**Supplementary Figure 1.** Density curves illustrate the normalization of distances before (red) and after (blue) performing a $log_{2}$ transformation across differing bin sizes including 10 kb, 25 kb, 50 kb, and 100 kb for both the (A) GM12878 and (B) K562 cell lines respectively. Distances are measured as the number of base pairs from the center of a genomic bin to the center of the nearest genomic annotation. Each density curve represents individual genomic annotation.


**Supplementary Figure 2. Distance-type predictors combined with random under-sampling yielded optimal TAD boundary region predictive performance for K562 ARROWHEAD TAD boundaries.** Balanced accuracy is compared across resolution, within each predictor-type: (A) Signal, (B) OC, (C) OP, and (D) Distance, and across re-sampling techniques: no re-sampling (None; red), random over-sampling (ROS; green), random under-sampling (RUS; blue), and synthetic minority over-sampling (SMOTE; purple).

**Supplementary Figure 3. Distance-type predictors combined with random under-sampling or SMOTE re-sampling yielded optimal predictive performance for A) GM12878 and B) K562 Peakachu loop boundaries.** Balanced accuracy is compared within each predictor-type: Signal, OC, OP, and Distance, and across across resampling technique: no re-sampling (None; red), random over-sampling (ROS; green), random under-sampling (RUS; blue), and synthetic minority over-sampling (SMOTE; purple). 


**Supplementary Figure 4. Binding of SMC3, Rad21, CTCF, and Znf143 transcription factors accurately predicts TAD and loop boundaries in K562 cell line.** (A) Barplots comparing performances of TAD (ARROWHEAD) and loop (Peakachu) boundary prediction models using histone modifications (HM), cis-regulated elements (BroadHMM), transcription factor binding sites (TFBS), in addition to a model containing all three classes (ALL). (B) Recursive feature elimination (RFE) analysis used to select the optimal number of predictors. Error bars represent standard deviation from the cross-validated accuracy across each chromosome. (C) Clustered heatmap of the predictive importance for the union of the top 8 chromosome-specific most predictive TFBSs.

**Supplementary Figure 8. preciseTAD boundaries are more enriched for GM12878-specific SMC3, RAD21, and ZNF143 sites.** Enriched heatmaps comparing preciseTAD boundaries with both (A) ARROWHEAD and (B) Peakachu boundaries for the GM12878 cell line.

**Supplementary Figure 9.preciseTAD boundaries are more enriched for K562-specific CTCF, SMC3, RAD21, and ZNF143 sites.** Enriched heatmaps comparing preciseTAD boundaries with both (A) ARROWHEAD and (B) Peakachu boundaries for the K562 cell line.

**Supplementary Figure 10. preciseTAD boundaries are spatially closer to GM12878-specific SMC3, RAD21, and ZNF143 sites.** Boxplots comparing the $log_{2}$ genomic distances from each preciseTAD boundary (green) and called boundary (either ARROWHEAD or Peakachu; blue) to the nearest SMC3, RAD21, and ZNF143 sites on the linear genome for GM12878.

**Supplementary Figure 11. preciseTAD boundaries are spatially closer to K572-specific CTCF, SMC3, RAD21, and ZNF143 sites.** Boxplots comparing the $log_{2}$ genomic distances from each preciseTAD boundary (green) and called boundary (either ARROWHEAD or Peakachu; blue) to the nearest CTCF, SMC3, RAD21, and ZNF143 sites on the linear genome for K562.
[??? Combine Supplementary Figure 10 and 11. Make panel A and, underneath, panel B. Remove CTCF from Y-axis and put overhead labels above each plot pair]


**Supplementary Table 5.** Median chromosome-specific Jaccard indices (IQR) for ARROWHEAD- and Peakachu-called and *preciseTAD* predicted boundaries between the GM12878 and K562 cell lines [??? Where is cell line information?] [??? What is in parentheses?]. The p-value is from a nonparametric Wilcoxon-rank sum test [??? Absent]. Note, ARROWHEAD-called and predicted boundaries were flanked by 5 kb, while Peakachu-called and predicted boundaries were flanked by 10 kb prior to calculating Jaccard indices.

**Supplementary Table 6.** Additional performance metrics when implementing a random forest using ARROWHEAD ground truth TAD boundaries.

**Supplementary Table 7.** Additional performance metrics when implementing a random forest using Peakachu ground truth chromatin loop boundaries.


# Abbreviations


# Acknowledgements

_Conflict of Interest._ None.

# Funding

# References
