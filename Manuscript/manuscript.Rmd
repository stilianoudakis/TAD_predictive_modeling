---
title: Computational Prediction of Boundaries of 3D Genomic Domains in Class Imbalance Settings
csl: styles.ref/genomebiology.csl
output:
  pdf_document: default
  word_document:
    reference_docx: styles.doc/NIH_grant_style.docx
bibliography: References/references.bib
--- 

Spiro C. Stilianoudakis^1^ (stilianoudasc@mymail.vcu.edu), Mikhail G. Dozmorov^1\*^ (mikhail.dozmorov@vcuhealth.org)

^1^ Dept. of Biostatistics, Virginia Commonwealth University, Richmond, VA, 23298, USA  
^\*^ To whom correspondence should be addressed: Virginia Commonwealth University, Richmond, VA, 23298, 804-827-2055, mikhail.dozmorov@vcuhealth.org

# ABSTRACT (Spiro version)

**Background.** Topologically Associated Domains (TADs) represent fundamental building blocks that lead to the organization and regulation of the three-dimensional (3D) genome. The enrichment of several epigenetic marks at TAD boundaries suggests a strong epigenetic component of TAD boundary formation. Several methods have been developed to leverage the growing amount of (epi)genomic annotation data for predicting TAD boundaries; however, they overlooked key characteristics of the data including spatial associations between genomic annotations and boundaries, as well as the severe imbalance in TAD-boundary vs non-TAD boundary defined genomic regions. Furthermore, resolution of Hi-C data remains well below the resolution of epigenomic assays (hundredths of bases for ChIP-seq) affecting the ability of Hi-C sequencing in discerning gene-level features of chromatin. This resolution gap between 1D and 3D genomic maps, as well as a paucity of chromatin features below the level of TADs, has significantly limited our understanding of epigenomic regulation of gene expression and its potential link to chromatin architecture.

**Methods.** We first developed an ensemble framework for optimizing data level characteristics necessary for TAD boundary prediction including combinations of 5 Hi-C data resolutions (5 kb to 100 kb), 3 spatially defined predictor types, and 4 re-sampling techniques, across the GM12878 and K562 cell lines. We then aimed to predict TAD boundary location on a 1D genomic map by validating optimally built cell line specific models at basepair resolution. 

**Results.** We demonstrate with our ensemble framework that cell line specific random forest classifiers built on 10 kb resolution Hi-C data, with distance-type predictors, using SMOTE (*Synthetic Minority Oversampling Technique*) re-sampling yield optimal predictive performances, and outperform existing methods. Cell specific transcription factor binding sites (TFBS) were the best type of genomic annotations for predicting TAD boundaries when directly compared with histone modifications and chromatin states; we identified the well-known CTCF, SMC3, RAD21, and ZNF143 TFBS known to be enriched at TAD boundaries. Additionally, TAD boundary regions predicted at basepair resolution using our optimally built cell line specific models were found to be significantly closer to known enriched epigenomic marks indicating more accurate identification of TAD boundaries than existing Hi-C sequencing technologies.

**Conclusions.** Our results outline strategies for predictive modeling of 3D genomic domains using 1D genome annotation data. The accurate modeling of TAD boundaries will improve our understanding of how epigenetics shapes the 3D structure of the genome.


# ABSTRACT (MD version)

**Background.** Topologically Associated Domains (TADs) represent fundamental building blocks of the three-dimensional (3D) genome organization and regulation. Several epigenetic marks, such as CTCF, are highly enriched at TAD boundaries, suggesting a strong epigenetic component of TAD boundary formation. Several methods have been developed to leverage the growing amount of (epi)genomic annotation data for predicting TAD boundaries; however, they overlooked key characteristics of the data, such as spatial associations between a genomic annotation and a boundary. Furthermore, the number of regions containing TAD boundaries is much smaller than the rest of the genome, creating a class imbalance problem. 

**Methods.** To investigate the problem of spatial genomic relationships and class imbalance, we developed an ensemble framework for optimizing prediction of TAD boundaries. We utilized several resampling techniques (random over- and undersampling, Synthetic Minority Over-sampling TEchnique (SMOTE)) coupled with various metrics for classifier performance evaluation (Area Under Receiver Operating Characteristics (AUROC) curve, Precision-Recall curve (AUPRC), F1, Matthews Correlation Coefficient (MCC), among others) to select the best predictive model in class imbalance settings.

**Results.** Using different feature engineering and resampling strategies, coupled with elastic net-based feature selection, we systematically compared the performance of models predicting the location of TAD boundaries (Gm12878 and K562 Hi-C data at 10kb to 100kb resolutions). Precision-Recall curves were found to be best suited for evaluating model performance in class imbalance settings. Random undersampling and SMOTE-resampled data performed best for optimal parameter selection. Transcription Factor Binding Sites (TFBSs) were the best type of genomic annotations for predicting TAD boundaries when directly compared with histone modifications and chromatin states; we identified well-known CTCF, SMC3, RAD21, and several novel TFBSs as best predictors of TAD boundaries. Importantly, spatial relationships (distance between TAD boundaries and genomic annotations) were best predictors of TAD boundaries as compared with commonly used overlap counts or percent overlap measures.

**Conclusions.** Our results outline strategies for predictive modeling of 3D genomic domains using 1D genome annotation data. The accurate modeling of TAD boundaries will improve our understanding of how epigenetics shapes the 3D structure of the genome.

# Introduction

The advent of chromosome conformation capture (3C) sequencing technologies, and its successor Hi-C, have revealed important 3-dimensional (3D) spatial constructs within the human genome such as loops [@rao20143d], Topologically Associated Domains (TADs) [@nora2012spatial;@dixon2012topological], and A/B compartments [@lieberman2009comprehensive]. Among these, TADs represent regions on the linear genome, at megabase scale, that are highly self-interacting. Emerging evidence has linked TADs to critical roles in cell dynamics like gene regulation and cell differentiation, an example being the mechanism by which enhancers loop to come into contact with distal promoters to initiate transcription within these domains [@Lupianez:2015aa; @Franke:2016aa]. Likewise, disruption of TAD boundaries has been shown to lead to developmental disorders [@lupianez2016breaking], cancer [@hnisz2016activation; @taberlay2016three] and other disorders [@Sun:2018aa; @Meaburn:2007aa]. Therefore, identifying the location of TAD boundaries remains a top priority in our goal to understand the functionality of the human genome.

A key factor in locating TAD boundaries is "resolution". Due to the high-dimensional nature of Hi-C data, genome binning has been a common strategy for dealing with a low signal-to-noise ratio problem [@li2019comparison]. Resolution, therefore, determines the bin sizes of the linear genome used to enumerate contacts caused by chromatin folding. Lower resolutions contribute to larger bin sizes, which lead to variability in the location of TAD boundaries. Due to high sequencing costs, most available Hi-C datasets have relatively low resolution, ranging from 25 kb to 100 kb. Because increasing the resolution of Hi-C data requires a quadratic increase in the total sequencing depth, obtaining high resolution remains difficult [@schmitt2016genome]. While these low resolution Hi-C datasets can be used to probe higher order genomic patterns such as A/B compartments, more refined resolutions are necessary to accurately define sub-domains and the boundaries that demarcate them [@fudenberg2016formation]. Furthermore, even at its highest (750 bp [@bonev2017multiscale]), Hi-C sequencing resolution still remains well below the resolution of ChIP-Sequencing experiments used to annotate the genome, which ranges in the tens of base pairs [@mendoza2009genome]. This resolution gap between 1D and 3D genomic maps can make it difficult to disentangle the role of genomic factors related to TAD boundaries, thereby limiting our understanding of epigenomic regulation and its potential link to chromatin architecture. We hypothesize that, by leveraging genomic annotations--defined by high resolution ChIP-Seq data--known to be enriched at TAD boundaries, we may be able more to precisely predict the locations of TAD boundaries at higher resolutions.

Several methods have been developed to predict TAD boundary location using genomic annotations. However, most ignore key characteristics of 3D genomic data that are detrimental to both model performance and accurate boundary identification. A method developed by Mourad et al [@mourad2016computational], called *HiCFeat*, used the percentage of overlap between several ChIP-seq defined transcription factor binding site (TFBS) regions and 1 kb genomic bins to build an L1-regularized multiple logistic regression model to predict TAD boundary regions. However, such high level of resolution is likely to introduce heavily imbalanced classes created from the proportionally much smaller number of TAD boundary regions compared to non-TAD boundary regions throughout the linear genome. *HiCFeat* did not the address class imbalance. Instead, model performance was evaluated using area under the receiver operating characteristic curve (AUROC) which is known to be insensitive to class imbalance, creating artificially inflated values influenced by the majority class [@prati2011survey; @wei2013role]. <!--A more appropriate evaluation tool to consider would be a composite metric such as Matthews Correlation Coefficient (MCC), which penalizes for both false positives and false negatives.--> Furthermore, by only considering the percentage of overlap in defining the feature space, *HiCFeat* is limited in its granularity given that many regions on the linear genome will not be overlapped with any genomic annotations. <!--This, likely being further exacerbated by the class imbalance.--> Two additional studies were proposed in 2015 and 2017 respectively, one using histone modifications in a Bayesian Additive Regression Trees (BART) model [@huang2015predicting] and the other using combined sets of TFBS, DNase I hypersensitive sites, and histone modifications together in an L2-based regularized linear model [@hong2017computational]. The BART model was built on relatively high resolution Hi-C data at 5 kb, while the L2-regularized model used 200 kb resolution Hi-C data. Both methods addressed class imbalance by performing random under-sampling (RUS), and used the elemental read count that appeared in each bin to describe the relationship between ChIP-seq annotations and genomic regions. Firstly, given the large disparity between the number of TAD vs non-TAD boundary regions, performing random under-sampling alone is likely to be unstable and introduce bias. Also, it is unclear how other re-sampling solutions compare to simple random under-sampling such as random over-sampling or a weighted combination of both random under- and over-sampling together. Secondly, using read count overlap as the feature space suffers from similar limitations as the percentage of overlap. Moreover, it is unclear how either of these feature engineering steps compare to enumerating the distance in base pairs between ChIP-seq annotations and genomic bins in TAD boundary prediction, which offer a more spatial measure of association. 

Given the many pitfalls encountered by previous methods we set out to establish a unified approach toward TAD boundary prediction. In this study we first developed a computational framework aimed at determining the set of data level characteristics necessary for optimal TAD boundary prediction. We assessed the Matthews Correlation Coefficient (MCC) of 10-fold cross-validated random forest classifiers with different combinations of model inputs consisting of vary data resolutions, re-sampling techniques, and feature engineering steps. We showed that 10 kb resolution data, combined with both random over- and under-sampling, and a feature space composed of distances between ChIP-seq annotations and genomic bins yielded the best model performances for TAD boundary prediction. We showed that our optimally built model was able to identify known architectural proteins CTCF, RAD21, SMC3, and ZNF143 as exhibiting high predictive importance, confirming their biological functionality near TAD boundaries. We then aimed to use our optimally built model to more precisely predict the location of TAD boundaries at base pair resolution. We showed that, compared to TAD boundaries identified by a TAD caller [@durand2016juicebox], these top ranked transcription factors were much more enriched near the predicted TAD boundaries identified by our model indicating much more precise locations throughout the linear genome. This improved precision in TAD boundary location can provide insight into the role that epigenomics has on the spatial architecture of the human genome.

<!--
Extensive research using high resolution maps (ranging from 750 bp to 1 mb) have probed much of the aspects of 3D chromatin architecture identifying several epigenomic modifications associated with TAD boundaries [@rao20143d; @bonev2017multiscale]. For instance, it is known that the CCCTC-binding factor (CTCF) is enriched at TAD boundaries acting as an insulator interfering with enhancer-promotor interactions [@ghirlando2016ctcf; @song2017ctcf; @ong2014ctcf]. Additional transcription factors including SMC1, SMC3, and RAD21 have also been shown to colocalize near TAD boundaries forming a cohesin ring under the proposed loop extrusion model, whereby loops are formed during interphase [@sanborn2015chromatin; @fudenberg2016formation; @alipour2012self]. 
-->

# Methods

## Genomic annotation and TAD boundary data

Biological replicate Hi-C data were downloaded from GEO GSE63525 [@rao20143d] (Supplementary Table 1) for the GM12878 and K562 cell lines. The autosomal genomic coordinates (GRCh37/hg19 human genome assembly) of TAD boundaries were obtained from Hi-C data at 10 kb, 25 kb, 50 kb, and 100 kb resolution using the ARROWHEAD algorithm [@durand2016juicebox]. TAD boundaries called on chromosome 9 were omitted from all downstream analyses, for all resolutions and cell lines, due to the sparsity of the contact matrix at the 10 kb resolution for the K562 cell line. 

Genomic annotation data in the form of cell type-specific cis-regulatory elements (CRE), histone modifications (HM), and transcription factor binding sites (TFBS) were obtained from the UCSC Genome Browser Database (GRCh37/hg19 human genome assembly) [@Tyner:2017aa] (Supplementary Table 2). 

## Machine learning framework for TAD boundary prediction

To make the data amenable for model training, the genome was first binned into equally sized intervals defined by the data resolution (*r*) of the corresponding contact matrix. The binning was initiated at the chromosome-specific genomic coordinate marking half of the resolution, and continued in congruent intervals until the end of the chromosome (*mod r* + *r/2*). This was to ensure that called (ground truth) TAD boundaries would be positioned in the center of genomic bins. Genomic bins were then defined as TAD boundary regions (*Y = 1*) if they contained a TAD boundary, and non-TAD boundary regions (*Y = 0*) otherwise, thus establishing the binary response vector (**Y**) used for random forest classification.

Cell type-specific genomic annotations were used to build the predictor space for of our random forest models. We created three types of predictors: *Overlap Count (OC)* - the total number of overlaps between a bin and genomic annotation regions;  *Overlap Percent (OP)* - the percent of overlap between the bin and the total width of genomic annotation regions overlapping it; *Log2 Distance* - the $log_{2}$ of the distance in bases (refered to hereafter as *Distance*), from the center of the bin to the center of the nearest genomic annotation region. 

The chromosome-specific dataset used for modeling was composed of two components: the response vector **Y**, an indicator variable separating between TAD and non-TAD boundary regions, and the predictor-type specific data matrix, **X** = {$X_1$, $X_2$, ..., $X_p$}, where $p$ was the set of genomic annotations. <!--One, or all types of predictors were used as described. The data was split into a 7:3 ratio of training and testing sets.-->

## Addressing class imbalance

Class imbalance (CI) was defined as the proportion of minority class out of the total number of observations:

$$CI = \dfrac{C_{min}}{C_{min} + C_{maj}}$$

where $C_{min}$ denotes the set of TAD boundary regions and $C_{maj}$ denotes the set non-TAD boundary regions. CI of heavily imbalanced classes approaches 0, while CI for balanced classes approaches 0.50. To assess the effect of CI on predictive performance, we first used the data with *No Sampling*, that is, the majority and minority classes were used as is. We evaluated three re-sampling techniques. For *Random Under-Sampling (RUS)*, the majority class was sampled without replacement to obtain the same number of data points in the minority class. For *Random Over-Sampling (ROS)*, the minority class was sampled with replacement to obtain the same number of data points in the majority class. For *SMOTE* (Synthetic Minority Over-Sampling Technique), under-sampling was performed without replacement from the majority class, while over-sampling was performed by creating new synthetic observations using the $k=5$ minority class nearest neighbors [@chawla2002smote] (implemented in the `DMwR` v.0.4.1 R package). We restricted the algorithm to 100% over-sampling and 200% under-sampling, which creates perfectly balanced classes. 

## Assessment of model performance

Random forest classification models (the `caret` v.6.0 R package [@kuhn2012caret]) were built to compare model performances between combinations of data resolutions, predictor types, and re-sampling techniques. Five-fold cross validation was used to tune the number of annotations, *p*, to consider at each node. The number of trees that were aggregated for each random forest model was set to the default, $n=500$. The performance of each model was compared using Matthews Correlation Coefficient (MCC), defined as <!--The MCC is, in essence, the correlation coefficient between the observed and predicted binary classifications [@brodersen2010balanced]. A value of 1 represents a perfect prediction, while a value of -1 represents total disagreement between prediction and observation. A value of 0 indicates no better than random prediction. The MCC is defined as-->

<!--
$$F1 - Score = \frac{2TP}{2TP + FP + FN}$$
-->

$$
MCC = \frac{TP \times TN - FP \times FN}{\sqrt{ (TP + FP)(TP+FN)(TN+FP)(TN+FN) }}
$$
<!--
$$Balanced \quad Accuracy = \dfrac{1}{2}\left( \dfrac{TP}{TP+FN} + \dfrac{TN}{TN+FP} \right)$$
-->

<!--
$$Informedness = \dfrac{TP}{TP+FN} + \dfrac{TN}{TN+FP} - 1$$
-->

where TP refers to the number of bins correctly identified as containing a TAD boundary (true positives), FP refers to the number of bins incorrectly identified as containing a TAD boundary (false positives), TN refers to the number of bins correctly identified as not containing a TAD boundary (true negatives), and FN refers to the number of bins incorrectly identified as not containing a TAD boundary (false negatives). Each of these quantities are obtained from the confusion matrix created by validating the model on the testing set. <!--Additional performance metrics including AUROC, accuracy, sensitivity, and specificity were [??? are?] reported in the supplementary materials.-->

## Feature reduction

Many genomic annotations, notably architectural proteins, tend to exhibit an extensive pattern of colocalization (correlation) [@van2014insulator]. To suitably reduce the feature space and prevent overfitting, we implemented recursive feature elimination to estimate the optimal number of necessary features to include in the model. The best performing subset was identified, ranging from 2 to the maximum number of features by powers of 2. We then aggregated the predictive importance of the union of the optimal set of features across chromosomes using the mean decrease in node impurity to determine the most common and top ranked annotations for predicting TAD boundaries. [??? TBD, at which stage it was done]

## Precise TAD boundary prediction at bp resolution

Next, we aimed to investigate whether we could alleviate resolution limitations that plague conventional TAD calling algorithms. To do so, we extended our optimally built TAD prediction models to obtain predictions at base pair (bp) resolution. Naturally, when dealing with such fine resolution, there will exist collections of spatially close base pairs with similar predictor profiles (i.e. similar distances), and will thus yield similar predictions. To guard against inflating the number of predicted TAD boundaries we developed a technique that combines both hierarchical clustering and partitioning techniques to identify more precise TAD boundaries throughout the linear genome. 

We first established a *predicted TAD boundary area* (PTBA) as a collection of adjacent base pairs that have been identified as being a predicted TAD boundary (using the optimal probability threshold identified by the combination of TPR and FPR closest to the point (0,1) on the ROC curve). We then performed hierarchical clustering on the pairwise distances (in base pairs) between the midpoints of each PTBA using complete linkage clustering. To identify the optimal number of clusters, *k*, we calculated the mean silhouette score over all possible sizes of clusters *m*:

$$\bar{s}_{m} = \dfrac{\sum^{m}_{i} s_{i}}{m},$$

where $s_{i}$ is the cluster-specific silhouette score defined as,

$$s_{i} = \dfrac{b_{i} - a_{i}}{max[a_{i},b_{i}]}.$$

Here, $a_{i}$ is the mean distance between each cluster entry and all other observations in the same cluster, and $b_{i}$ is the mean distance between entries within the same cluster. Therefore number of clusters, *k*, that maximized the mean silhouette score, $\bar{s}_{m}$ were used to identify groupings of PTBA, which we defined as *predicted TAD boundary regions* (PTBR).

To precisely identify the PTBA most representative of each PTBR we performed an extension of partitioning around medoids (PAM), known as CLARA (Clustering Large Applications) for better scaling and more computational efficiency [@reynolds2006clustering; @wei2000empirical]. The midpoint of the corresponding cluster medoid, in this case a particular PTBA, will be defined as a *predicted TAD boundary point* (PTBP). In the event that a particular PTBA has an even number of base pairs, then ceiling function was applied to extract the right most base pair. Thus, the hierarchical structure of our defined predicted TAD boundary objects were as follows: PTBR > PTBA > PTBP. That is, each PTBR is a collection of PTBAs, which are themselves a collection of adjacent base pairs. The uniquely identified PTBP was then the midpoint of the most representative PTBA within a PTBR.

<!--
Using optimally trained models, we established *predicted TAD boundary regions* as a collection of adjacent bases predicted as TAD boundary with the probability of 1. [??? Do not understand from here:] To guard against inflating the number of predicted TAD boundaries, we clustered the distances between the midpoints of the *predicted TAD boundary regions*. We then performed partitioning around mediods (PAM) to determine the *predicted TAD boundary region* that was most representative of the cluster. The midpoint, in this case a particular basepair, of the *predicted TAD boundary region* identified as the medoid was defined as a final *predicted TAD boundary*. [??? To here. REWRITE!]
-->


## Comparing Called vs Predicted TAD boundaries

To evaluate if our predicted TAD boundaries are biologically significant we will asssess the signal strength obtained from key ChIP-Seq peak elements known to be enriched at TAD boundaries including CTCF, RAD21, SMC3, and ZNF143. To do so we will used enrich heatmaps and Student’s t-tests to compare distances from selected ChiP-seq data to our predicted TAD boundaries compared to called TAD boundaries (ARROWHEAD). 

Furthermore, we will assess the conservation of our predicted TAD boundaries within cell types and between resolutions, as well as between cell types and within resolutions and compare with ARROWHEAD called TAD boundaries. To do so we will evaluate Jaccard Indices. Jaccard is a metric used to measure overlap between sets (genomic regions). Thus we can use it as measure of overlap between TAD boundaries. Given two sets of TAD boundaries (either between resolution or cell type) A and B, we define the Jaccard Index as,

$$J_{(A,B)} = \dfrac{A \cap B}{A \cup B}.$$
To give the sets of boundaries A and B dimensionality to enable us to calculate overlap, we flank each boundary point by a flanking factor, *f*=5000. 

# Results

## A resolution-specific approach for predicting TAD boundaries

We analyzed publically available replicate Hi-C data sets from the GM12878 and K562 cell lines (Supplementary Table 1). Topologically associating domains (TADs) were subsequently called using the ARROWHEAD pipeline [@durand2016juicer] at five data resolutions: 5 kb 10 kb, 25 kb, 50 kb, and 100 kb. <!--After removing TADs that exceeded 2 md in length (biologically plausible maximum TAD size [@dixon2012topological; @sofueva2013cohesin]),--> The results presented are for the GM12878 cell line, with K562 results presented in the Supplementary material. We obtained a total of 8052, 7676, 4670, 2349, and 1031 called TADs across each resolution respectively (Table 1). From the called TADs we obtained a total of 15468, 14253, 8363, 4224, and 1883 unique TAD boundaries (Table 2). The resolution-specific approach we developed to create TAD vs non-TAD boundary regions amenable for binary classification (See Methods) resulted in a total of 535363, 267682, 107073, 53537, and 26768 genomic bins. TAD boundary regions were defined as regions on the linear genome where a genomic bin contained a called TAD boundary ($Y = 1$), while non-TAD boundary regions were defined as genomic bins that did not contain a TAD boundary ($Y = 0$) (Figure 1A). 

## TAD vs. non-TAD boundary class imbalance is severe irrespectively of Hi-C data resolution 

Under this construction, the class imbalance among the genomic bins was found to be both severe and invariant toward resolution. Specifically, we found the imbalance between TAD boundary and non-TAD boundary regions to be 0.03, 0.05, 0.08, 0.08, and 0.07 for each resolution respectively (Table 2). Furthermore, the data summaries presented in Table 1 were found to be similar to those exibited by the K562 cell line (Supplementary Table 3).

| Resolution | Total number of called TADs | Total number of unique TAD boundaries | Total number of genomic bins | Class imbalance |
|:----------:|:---------------------------:|:-------------------------------------:|:----------------------------:|:---------------:|
|5 kb        |8052                         | 15468                                 | 535363                       | 0.03            |
|10 kb	     |7676 	                       | 14253                                 | 267682                       | 0.05            |
|25 kb	     |4670                         | 8363                                  | 107073                       | 0.08            |
|50 kb	     |2349	                       | 4224                                  | 53537                        | 0.08            |
|100 kb	     |1031                         | 1883                                  | 26768                        | 0.07            |
Table: Domain data and class imbalance summaries across resolutions for GM12878.

## Three types of predictors define the associations between TAD boundary regions and genomic annotations

A total of 78 cell type specific functional genomic annotations were used to build the feature space of downstream random forest models (Supplementary Table 1). The annotations could be broken down into three sets including histone modifications (HM), cis-regulatory elements (CRE), and transcription factor binding sites (TFBS). We constructed three different predictor types for each functional genomic annotation (Figure 1B). Counts of overlaps (**Overlap Counts**, OC) were defined as the total number of genomic annotation regions that overlapped within a given genomic bin. Percents of overlaps (**Overlap Percent**, OP) were defined as the proportion of a bin overlapped by an annotation region. **Distance** was defined as log2 transformed number of base pairs between between the centers of bins and regions defining genomic annotations. A log2-transformation of distance was used to account for the skewness present in the distributions of genomic distances (Supplementary Figure 1). These feature engineering steps were performed to improve TAD boundary predictions by accounting for direct (OC), proportional (OP), and indirect (distance) relationships between TAD boundaries and genomic annotations.


![**Illustrating the resolution-specific data construction and feature engineering used for downstream modeling.** (A) Unique boundaries are denoted by the blue dots. The linear genome was subsequently binned into resolution-specific intervals. The response vector **Y** was defined as a genomic bin that either overlapped with a TAD boundary ($Y = 1$) or did not ($Y = 0$). (B) Three types of associations between bins and genomic annotations (green shapes) used to build the feature space of random forest classification models include _Overlap Counts_ (OC), _Overlap Percent_ (OP), and ($log_{2}$) _Distance_. ](Figures/model_construction_and_predictor_types.png)


## Building an ensemble framework for TAD boundary prediction

To account for the heavily imbalanced classes reported above, we evaluated three re-sampling techniques (in addition to no re-sampling) before predicting TAD boundaries. **Random over-sampling** (ROS) was defined as sampling with replacement from TAD boundary regions. **Random under-sampling** (RUS) was defined as sampling with replacement from non-TAD boundary regions. Lastly, we considered **Synthetic minority over-sampling technique** (SMOTE), which is a combination of both random over- and under-sampling [@chawla2002smote]. 

To identify the combination of data resolution, predictor type, and re-sampling technique necessary for optimal cell line specific TAD boundary prediction, we created an ensemble framework to systematically compare performances of different model inputs (Figure 2). The framework uses data for a particular cell line *L = {GM12878, K562}*, at a given resolution *R = {5 kb, 10 kb, 25 kb, 50 kb, 100 kb}*, using a particular predictor type *P = {OC, OP, Distance}*, and re-sampling technique *B = {None, RUS, ROS, SMOTE}*. Once the model inputs were established, a random forest classifier was trained on chromosome-specific datasets using 5-fold cross validation. The different combinations of inputs were evaluated by assessing the Matthews Correlation Coefficient (MCC) of each model. Letting $|X|$ denote the cardinality of each set, we evaluated $|L| \times |R| \times |P| \times |B|$ different ensemble systems, totaling $2 \times 5 \times 3 \times 4 \times 21 = 2520$) models. <!--Additional performance metrics are reported in the Supplementary materials.-->

![**A diagram of the ensemble framework detailing the steps for combining different inputs used in the random forest model building pipeline.** Step 1 is to establish the rowise (genomic bins) and columnwise (genomic annotations) dimensions of the data matrix, **A**, by combining a resolution (5 kb, 10 kb, 25 kb, 50 kb, or 100 kb) and feature engineering procedure (overlap count (OC), overlap percent (OP), $log_{2}$ distance (Distance)). Step 2 is to split **A** into a training and testing set according to a 7:3 ratio. Step 3 is to apply a re-sampling technique to the training set (no re-sampling, random over-sampling, random under-sampling, or SMOTE re-sampling). Step 4 is to implement the random forest algorithm and perform 5-fold cross-validation to tune for the *mtry* parameter. Finally, step 5 is to validate the model on the separate test data for unbiased model evaluation.](Figures/ensemble_framework.png)


## SMOTE re-sampling, distance-based associations of TAD boundaries and genomic annotations, and 10 kb resolutions of Hi-C data provided optimal model performance

We investigated the effect of class imbalance on model performance using three re-sampling techniques. Expectedly, when using data as-is, that is, with class imbalance present, the models performed poorly. Using any of the resampling techniques improved the performance, with SMOTE-resampled data being the most optimal (Figure 3, Supplementary Figure 2). These results suggest that a combination of both random over- and under-sampling (SMOTE) can improve TAD boundary prediction.

We found that, regardless of resampling technique, random forest classifiers built using a distance-type feature space yielded consistently higher MCCs when compared to the overlap count and overlap percent predictor types (Figure 3), and these results were consistent across resolutions and cell types (Supplementary Figure 2). This indicated that models are better able to discriminate between TAD and non-TAD boundary regions when provided with spatially related associations.

Interestingly, we found that performances peaked at 10 kb resolution and then degraded as data resolution decreased. The reason for the improved performance between 5 kb and 10 kb data resolutions can be due to the sparsity in the interaction frequency matrices at finer resolutions. [??? Quantify sparsity] This sparsity may lead to inaccurate TAD calling and, subsequently, to worse model performance. These results suggest that finer resolution of Hi-C data is not always optimal for accurate TAD calling and prediction, and sparsity of the data needs to be considered. Additionally, performances tended to be much more variable between chromosomes at lower resolutions, evidenced by the wider error bars for the 50 kb and 100 kb resolutions. In summary, our results imply that using random under- and over-sampling, distance-type predictors, and the data at 10kb resolution results in an optimally performing cell line-specific random forest-based TAD boundary prediction model.

<!--
![**Models built using distance-type predictors combined with SMOTE re-sampling yielded optimal MCCs across resolution.** Barplots comparing the performances of random forest classifiers built using different combinations of data level characteristics. Within each re-sampling technique (A-D), performances are compared for each type of feature space: OC (red), OP (green), and Distance (blue), across resolutions. Performances were evaluated using MCCs and aggregated by averaging across each chromosome, with error bars representing 1 standard deviation away from the mean.](Figures/model_performances_v3_bars.png)
-->

## Transcription factor binding sites outperform other annotation-specific models

We then aimed to compare the performances of annotation-specifc models. In doing so, we inspected the proportion of predictive importance that was explained by each of the three groups of genomic annotations (histone modifications (HM), chromatin states (ChromHMM), and transcription factor binding sites (TFBS)). For optimal random forest classifiers, we found that the majority of the proportional predictive importance was obtained by transcription factor binding sites (Supplementary Figure 3). Furthermore, models build solely on TFBSs outperformed other annotation-specific models at all resolutions (Figure 4A; Supplementary Figure 4A). Notably, the TFBS-specific models outperformed models built on the combined sets of annotations, and this effect was most pronounced at lower resolutions. This indicated that the inclusion of other types of annotations contributed to additional noise rather than signal in TAD boundary prediction. In summary, these results suggest that TFBS are the primary drivers of TAD boundary formation in both the GM12878 and K562 cell lines.

## Predictive importances confirmed biological functionality of CTCF, RAD21, SMC3, and ZNF143 at TAD boundaries

Given that many TFBS are known to colocalize together on the linear genome and are therefore highly correlated, we sought to avoid overfitting by performing recursive feature elimination. We found that our models were able to obtain near-optimal performance using approximately eight TFBSs (Figure 4B; Supplementary Figure 4B). However, given that we train our models on chromosome-specific data, the most significant annotations vary for each chromosome. To determine the most common TFBSs, we clustered the predictive importance values across chromosomes (Figure 4C; Supplementary Figure 4C). We found that, similar to other studies [@sanborn2015chromatin; @fudenberg2016formation; @alipour2012self; @weintraub2017yy1; @gonzalez2017znf143], CTCF, RAD21, SMC3, and ZNF143 transcription factors were most predictive of TAD boundary regions. 

<!--
![**Assessing top ranked transcription factors in TAD boundary prediction.** (A) Barplots comparing performances of models using specific groups of functional genomic annotation as the feature space including histone modifications (HM; red), chromatin states (ChromHMM; green), transcription factor binding sites (TFBS; blue), in addition to a model with a feature space containing all three groups (Combined; purple). (B) Recursive feature elimination analysis used to reduce the number of TFBS to include in the optimally build random forest classifier. (C) Clustered heatmap of predictive importances for the union of the top 8 most predictive TFBS across chromosomes. Error bars represent standard deviation from the mean MCC across each chromosome.](Figures/annot_specific_rfe_varimps_heatmap.png)
-->

## Predictive modeling defines precise and biologically relevant location of TAD boundaries

After obtaining our optimally built random forest classifier, we investigated whether our predictive models can alleviate resolution limitations of Hi-C data by predicting TAD boundaries at base pair resolution. We were able to identify regions where the model predicted the base pair to be a TAD boundary with probability equal to 1 (Figure 5A). [??? Where is this figure? It seemed important; !!!added] By clustering the regions (see Methods), we were able to predict a comparable number of TAD boundary regions as called by the ARROWHEAD TAD caller. However, only 24% and 29% of predicted and called (and 10 kb flanked) TAD boundaries overlapped for the GM12878 and K562 cell line, respectively, suggesting differing locations in TAD boundaries throughout the linear genome (Supplementary Figure 5). [??? Need further drill down, as we discussed; !!!added distance to annotations figure in next paragraph] 

For each predicted TAD boundary region, we were able to identify the summit locations of TAD boundary location by performing partitioning around medoids (see Methods). To compare the summit locations of predicted and called TAD boundaries, we evaluated the signal strength of ChIP-seq peak regions around a 10 kb flanking region. We found that the signal strength for the CTCF, RAD21, SMC3, and ZNF143 [??? Make all in this order!; !!!fixed] TFBS peaked at our predicted TAD boudaries, while was poorly defined around the called TAD boundaries (Figure 5B; Supplementary Figure 6).  Thus, our model is able to alleviate resolution limitations and precisely locate TAD boundaries that correspond to the highest signal strength of known TAD boundary-forming TFBSs. Furthermore, when compared to called TAD boundaries, the boundaries that we predicted with our model were found to be statistically significantly closer to the top ranked TFBS, suggesting stronger enrichment profiles near predicted TAD boundaries (Supplementary Figure 7).

<!--
![**Predicted TAD boundaries are enriched in known TAD boundary-forming TFBSs.** (A) Visualizing locations of predicted and called TAD boundaries (chr 22: 17390000-18640000; GM12878). The upper triangular contact map shows the normalized number of contacts within the specified window using the JUICER toolbox.  Called TADs are outlined in blue.  The blue vertical lines represent a called TAD boundary identified by the ARROWHEAD algorithm. The black line represents the predicted probability of each base pair being a TAD boundary. Regions of adjacent base pairs with probability of 1 are represented by the green regions along the x-axis. The green vertical lines represent the subsequent base pair predicted to be a TAD boundary using medoid partitioning. (B) Enrichment heatmaps illustrate the average signal strength of ChIP-seq peak regions defined by SMC3, ZNF143, CTCF, and RAD21 around the centers of 10 kb flanked predicted and called TAD boundaries.](Figures/visualizing_boundaries_example_with_enriched_heatmaps.png) 
-->

# Discussion

In this study we developed an ensemble framework to systematically compare the effects of different combinations of Hi-C resolution, data re-sampling, and feature engineering techniques on the performance of models aimed at TAD boundary prediction. By implementing our framework across multiple cell lines, we showed that there exists a consensus approach toward precise TAD boundary prediction. We showed that random forest classification models trained on domain data extracted from 10 kb resolution maps, using random over- and under-sampling to account for class imbalance, with a distance-type predictor space yielded optimal model performances for both the GM12878 and K562 cell lines. 

Previous studies tended to focus only on specific sets of genomic annotations including chromatin states, histone modifications, or transcription factor binding sites (TFBS) alone. Using our framework, we were able to conclude that simply building random forest classifiers only on cell line specific TFBS can yield near optimal model performance, thereby significantly reducing the feature space and computational complexity of the model. Specifically, we found that the CCCTC-binding factor (CTCF) and cohesin complexes (RAD21 and SMC3) were the most important features of TAD boundary prediction, confirming their enrichment at TAD boundaries as part of the loop extrusion model [@sanborn2015chromatin; @fudenberg2016formation; @alipour2012self]. Likewise, we found the the zinc-finger protein ZNF143 was also given high predictive importance. This confirmed the known role of ZNF143 as a chromatin-looping factor that contributes to the structural foundation of the genome by providing sequence specificity at promoters connected with distal regulatory elements [@bailey2015znf143;@gonzalez2017znf143]. 

By leveraging the enrichment of these architectural proteins we were able to more precisely identify TAD boundaries at a much more refined resolution. To do so, we evaluated the ChIP-Seq signal strength between the CTCF, RAD21, SMC3, and ZNF143 transcription factors and a 10 kb flanked window of predicted TAD boundaries identified by our optimally built random forest model. We showed that the genomic signals for each TFBS was much more consolidated near the center of our flanked predicted TAD boundary then the flanked boundary identified by the ARROWHEAD TAD caller. We also evaluated the distal relationships between the same architectural proteins and found that they were statistically significantly closer in base pair distance to our predicted TAD boundaries, than to those identified by ARROWHEAD. 

# Conclusion

In summary, we have shown that TAD boundary prediction is a multi-faceted problem composed of many data irregularities and characteristics that previous methods have failed to address. Through our ensemble framework, we provide a useful guide toward the exploration of chromatin organization, while highlighting the impact of data resolution, class imbalance, and feature engineering in TAD boundary prediction. Lastly, by building models using known enriched transcription factors, we were able to bridge the resolution gap between 1D ChIP-Seq annotations and 3D Hi-C sequencing for more precise TAD boundary prediction. This improved precision in TAD boundary location offers the potential for further exploration into the 3D organization of the human genome.



<!--
The two proteins differ in that YY1 preferentially
occupies interacting enhancers and promoters, whereas CTCF
preferentially occupies sites distal from these regulatory elements that tend to form larger loops and participate in insulation.
Deletion of YY1 binding sites or depletion of YY1 can disrupt
enhancer-promoter contacts and normal gene expression.
Thus, YY1-mediated structuring of enhancer-promoter loops is
analogous to CTCF-mediated structuring of TADs, CTCF contact domains, and insulated neighborhoods. This model of
YY1-mediated structuring of enhancer-promoter loops accounts
for diverse functions reported previously for YY1, including contributions to both gene activation and repression and to gene
dysregulation in cancer. ["YY1 Is a Structural Regulator
of Enhancer-Promoter Loops"]
-->





# Supplementary Legends

**Supplementary Table 1. Hi-C and genomic annotation data.** (A) A complete list of the Hi-C data libraries used to obtain the locations of topologically associating domains. (B) A complete list of the cell line specific genomic annotations used to build the feature space for all downstream models. The GRCh37/hg19 human genome assembly was used. "Genomic Class" - broad category of genomic features, "Element" - names of genomic annotations, "Cell Type-Specific Source" - download URL specific to the cell line (not all annotations were provided by the same institutions). 

**Supplementary Figure 1. Performing $log_{2}$ transformations normalizes skewed distance densities across resolution.** When measured in basepairs, distances were highly right skewed (red lines) across all resolutions for both the GM12878 (A) and K562 (B) cell lines. After $log_{2}$ transforming the distances (blue lines), densities became much more gaussian distributed for all resolutions. 

**Supplementary Figure 2. Models built using distance-type predictors combined with SMOTE re-sampling yielded optimal MCCs across resolution on K562.** Barplots comparing the performances of random forest classifiers built using different combinations of data level characteristics for K562. Within each re-sampling technique (A-D), performances are compared for each type of feature space: OC (red), OP (green), and Distance (blue), across resolutions. Performances were evaluated using MCCs and aggregated by averaging across each chromosome, with error bars representing 1 standard deviation away from the mean.

**Supplementary Figure 3. The proportional importance of optimally built cell line specific models was outweighed by transcription factor binding sites across resolutions.** Stacked barplots illustrate the proportion of total predictive importance in cell line specific random forest classifiers for (A) GM12878 and (B) K562 respectively. Model inputs included the optimal data level characteristics determined by the ensemble framework (SMOTE re-sampling; with distance-type predictors). Predictive importance was averaged for models built on chromosome specific regions of the linear genome. Proportional importance was then calculated according to the annotation group of the feature space including histone modifications (HM), chromatin state segmentations (ChromHMM), and transcription factor binding sites (TFBS).

**Supplementary Figure 4. Assessing top ranked transcription factors in TAD boundary prediction for K562.** (A) Barplots comparing performances of models using K562-specific groups of functional genomic annotation as the feature space including histone modifications (HM; red), chromatin states (ChromHMM; green), transcription factor binding sites (TFBS; blue), in addition to a model with a feature space containing all 3 groups (Combined; purple). Error bars represent ± 1 standard deviation from the mean MCC across each chromosomal section of the linear genome. (B) Recursive feature elimination analysis used to reduce the number of TFBS to include in the optimally build random forest classifier. Error bars represent 1 standard deviation away from the mean cross-validated MCC. (C) Clustered heatmap of predictive importance for the union of the top 8 most predictive TFBS across chromosomes.

**Supplementary Figure 5. Venn diagrams illustrating the amount of overlap between predicted and called TAD boundary regions.** For each of the GM12878 (A) and K562 (B), both predicted and called TAD boundaries were flanked other either side by 10 kb and the amount of overlap was enumerated.

**Supplementary Figure 6. Predicted TAD boundaries were centered closer to peak signal regions defined by known architectural transcription factors when compared to called TAD boundaries for K562.** Enrichment
heatmaps illustrate the average signal strength of K562-specific ChIP-seq peak regions defined by (A) SMC3, (B) ZNF143, (C) CTCF, and (D) RAD21 around the centers of 10 kb flanked predicted and called TAD boundaries.

**Supplementary Figure 7. Known architectural transcription factors were statistically significantly closer to predicted TAD boundaries then called TAD boundaries.** Barplots illustrate the log2 distance in basepairs from classes of TAD boundaries to transcription factors including CTCF, RAD21, SMC3, and ZNF143 for the GM12878 (A) and K562 (B) cell lines. TAD boundaries were classified into the 3 classes. Predicted but not called (PBNC) were the set of 10 kb flanked predicted TAD boundaries the did not overlap with 10 kb flanked called TAD boundaries. Called and predicted (CAP) were the set of 10 kb flanked called and predicted TAD boundaries that overlapped with each other. Called but not predicted (CBNP) were the set of 10 kb flanked called TAD boundaries that did not overlap with 10 kb flanked predicted TAD boundaries.


# Abbreviations


# Acknowledgements

_Conflict of Interest._ None.

# Funding

# References
