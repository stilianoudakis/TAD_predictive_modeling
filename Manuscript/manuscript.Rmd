---
title: Computational Prediction of Boundaries of 3D Genomic Domains in Class Imbalance Settings
csl: styles.ref/genomebiology.csl
output:
  pdf_document: default
  word_document:
    reference_docx: styles.doc/NIH_grant_style.docx
bibliography: References/references.bib
--- 

Spiro C. Stilianoudakis^1^ (stilianoudasc@mymail.vcu.edu), Mikhail G. Dozmorov^1\*^ (mikhail.dozmorov@vcuhealth.org)

^1^ Dept. of Biostatistics, Virginia Commonwealth University, Richmond, VA, 23298, USA  
^\*^ To whom correspondence should be addressed: Virginia Commonwealth University, Richmond, VA, 23298, 804-827-2055, mikhail.dozmorov@vcuhealth.org

# ABSTRACT (Spiro version)

**Background.** Topologically Associated Domains (TADs) represent fundamental building blocks that lead to the organization and regulation of the three-dimensional (3D) genome. The enrichment of several epigenetic marks at TAD boundaries suggests a strong epigenetic component of TAD boundary formation. Several methods have been developed to leverage the growing amount of (epi)genomic annotation data for predicting TAD boundaries; however, they overlooked key characteristics of the data including spatial associations between genomic annotations and boundaries, as well as the severe imbalance in TAD-boundary vs non-TAD boundary defined genomic regions. Furthermore, resolution of Hi-C data remains well below the resolution of epigenomic assays (hundredths of bases for ChIP-seq) affecting the ability of Hi-C sequencing in discerning gene-level features of chromatin. This resolution gap between 1D and 3D genomic maps, as well as a paucity of chromatin features below the level of TADs, has significantly limited our understanding of epigenomic regulation of gene expression and its potential link to chromatin architecture.

**Methods.** We first developed an ensemble framework for optimizing data level characteristics necessary for TAD boundary prediction including combinations of 5 Hi-C data resolutions (5 kb to 100 kb), 3 spatially defined predictor types, and 4 re-sampling techniques, across the GM12878 and K562 cell lines. We then aimed to predict TAD boundary location on a 1D genomic map by validating optimally built cell line specific models at basepair resolution. 

**Results.** We demonstrate with our ensemble framework that cell line specific random forest classifiers built on 10 kb resolution Hi-C data, with distance-type predictors, using SMOTE (*Synthetic Minority Oversampling Technique*) re-sampling yield optimal predictive performances, and outperform existing methods. Cell specific transcription factor binding sites (TFBS) were the best type of genomic annotations for predicting TAD boundaries when directly compared with histone modifications and chromatin states; we identified the well-known CTCF, SMC3, RAD21, and ZNF143 TFBS known to be enriched at TAD boundaries. Additionally, TAD boundary regions predicted at basepair resolution using our optimally built cell line specific models were found to be significantly closer to known enriched epigenomic marks indicating more accurate identification of TAD boundaries than existing Hi-C sequencing technologies.

**Conclusions.** Our results outline strategies for predictive modeling of 3D genomic domains using 1D genome annotation data. The accurate modeling of TAD boundaries will improve our understanding of how epigenetics shapes the 3D structure of the genome.


# ABSTRACT (MD version)

**Background.** Topologically Associated Domains (TADs) represent fundamental building blocks of the three-dimensional (3D) genome organization and regulation. Several epigenetic marks, such as CTCF, are highly enriched at TAD boundaries, suggesting a strong epigenetic component of TAD boundary formation. Several methods have been developed to leverage the growing amount of (epi)genomic annotation data for predicting TAD boundaries; however, they overlooked key characteristics of the data, such as spatial associations between a genomic annotation and a boundary. Furthermore, the number of regions containing TAD boundaries is much smaller than the rest of the genome, creating a class imbalance problem. 

**Methods.** To investigate the problem of spatial genomic relationships and class imbalance, we developed an ensemble framework for optimizing prediction of TAD boundaries. We utilized several resampling techniques (random over- and undersampling, Synthetic Minority Over-sampling TEchnique (SMOTE)) coupled with various metrics for classifier performance evaluation (Area Under Receiver Operating Characteristics (AUROC) curve, Precision-Recall curve (AUPRC), F1, Matthews Correlation Coefficient (MCC), among others) to select the best predictive model in class imbalance settings.

**Results.** Using different feature engineering and resampling strategies, coupled with elastic net-based feature selection, we systematically compared the performance of models predicting the location of TAD boundaries (Gm12878 and K562 Hi-C data at 10kb to 100kb resolutions). Precision-Recall curves were found to be best suited for evaluating model performance in class imbalance settings. Random undersampling and SMOTE-resampled data performed best for optimal parameter selection. Transcription Factor Binding Sites (TFBSs) were the best type of genomic annotations for predicting TAD boundaries when directly compared with histone modifications and chromatin states; we identified well-known CTCF, SMC3, RAD21, and several novel TFBSs as best predictors of TAD boundaries. Importantly, spatial relationships (distance between TAD boundaries and genomic annotations) were best predictors of TAD boundaries as compared with commonly used overlap counts or percent overlap measures.

**Conclusions.** Our results outline strategies for predictive modeling of 3D genomic domains using 1D genome annotation data. The accurate modeling of TAD boundaries will improve our understanding of how epigenetics shapes the 3D structure of the genome.

# Introduction

The advent of chromosome conformation capture (3C) sequencing technologies, and its successor Hi-C, have revealed important 3-dimensional (3D) spatial constructs within the human genome such as loops [@rao20143d], Topologically Associated Domains (TADs) [@nora2012spatial;@dixon2012topological], and A/B compartments [@lieberman2009comprehensive]. Among these, TADs represent regions on the linear genome, at megabase scale, that are highly self-interacting. Emerging evidence has linked TADs to critical roles in cell dynamics like gene regulation and cell differentiation, an example being the mechanism by which enhancers loop to come into contact with distal promoters to initiate transcription within these domains [@Lupianez:2015aa; @Franke:2016aa]. Likewise, disruption of TAD boundaries has been shown to lead to developmental disorders [@lupianez2016breaking], such as cancer [@hnisz2016activation; @taberlay2016three] and other disorders [@Sun:2018aa; @Meaburn:2007aa]. Therefore, identifying the location of TAD boundaries remains a top priority in our goal to understand the functionality of the human genome.

A key factor in locating TAD boundaries is Hi-C data "resolution". Resolution determines the bin sizes of the linear genome used to enumerate contacts caused by chromatin folding. Lower resolutions contribute to larger bin sizes, which lead to variability in the location of TAD boundaries. Due to high sequencing costs, most available Hi-C datasets have relatively low resolution, ranging from 25 kb to 100 kb. To increase the resolution of Hi-C data requires a quadratic increase in the total sequencing depth [@schmitt2016genome]. While these low resolution Hi-C datasets can be used to probe higher order genomic patterns such as A/B compartments, more refined resolutions are necessary to define sub-domains and the boundaries that demarcate them. Furthermore, even at its highest (750 bp [@bonev2017multiscale]), Hi-C sequencing resolution still remains well below the resolution of ChIP-Sequencing experiments used to annotate the genome, which ranges in the tens of base pairs. This resolution gap between 1D and 3D genomic maps can make it difficult to disentangle the role of additional factors related to TAD boundaries, thereby limiting our understanding of epigenomic regulation and its potential link to chromatin architecture. We hypothesize that, by leveraging genomic annotations--defined by high resolution ChIP-Seq data--known to be enriched at TAD boundaries, we may be able more precisely predict the locations of TAD boundaries on the linear genome.

Several methods have been developed to predict TAD boundary location using genomic annotations. However, most ignore key characteristics of 3D genomic data that are detrimental to model performance. A method developed by Mourad et al [@mourad2016computational], called *HiCFeat*, used the percentage of overlap between several ChIP-seq defined transcription factor binding site (TFBS) regions and 1 kb genomic bins to build an L1-regularized multiple logistic regression model to predict TAD boundary regions. However, the high level of resolution is likely to introduce heavily imbalanced classes created from the proportionally much smaller number of TAD boundary regions compared to non-TAD boundary regions throughout the linear genome. *HiCFeat* did not the address class imbalance. Instead, model performance was evaluated using area under the receiver operating characteristic curve (AUROC) which is known to be insensitive to class imbalance, creating artificially inflated values influenced by the majority class [@prati2011survey; @wei2013role]. <!--A more appropriate evaluation tool to consider would be a composite metric such as Matthews Correlation Coefficient (MCC), which penalizes for both false positives and false negatives.--> Furthermore, by only considering the percentage of overlap in defining the feature space, *HiCFeat* is limited in its granularity given that many regions on the linear genome will not be overlapped with any genomic annotations, resulting in a zero inflated model. <!--This, likely being further exacerbated by the class imbalance.--> Two additional studies were proposed in 2015 and 2017 respectively, one using histone modifications in a Bayesian Additive Regression Trees (BART) model [@huang2015predicting] and the other using combined sets of TFBS, DNase I hypersensitive sites, and histone modifications together in an L2-based regularized linear model [@hong2017computational]. The BART model was built on relatively high resolution Hi-C data at 5 kb, while the L2-regularized model used 200 kb resolution Hi-C data. Both methods addressed class imbalance by performing random under-sampling (RUS), and used the elemental read count that appeared in each bin to describe the relationship between ChIP-seq annotations and genomic regions. Firstly, given the large disparity between the number of TAD vs non-TAD boundary regions, performing random under-sampling alone is likely to be unstable and introduce bias. Also, it is unclear how other data level solutions compare to simple random under-sampling such as random over-sampling or a weighted combination of both random under- and over-sampling together. Secondly, using read count overlap as the feature space suffers from similar limitations as the percentage of overlap. Moreover, it is unclear how either of these feature engineering steps compare to enumerating the distance in basepairs between ChIP-seq annotations and genomic bins in TAD boundary prediction. 

Therefore, given the many pitfalls encountered by previous methods we set out to establish a unified approach toward TAD boundary prediction. In this study we first developed a computational framework aimed at determining the set of data level characteristics necessary for optimal TAD boundary prediction. We assessed the Matthews Correlation Coefficient (MCC) of 10-fold cross-validated random forest classifiers with different combinations of model inputs consisting of vary data resolutions, re-sampling techniques, and feature engineering steps. We showed that 10 kb resolution data, combined with both random over- and under-sampling, and a feature space composed of distances between ChIP-seq annotations and genomic bins yielded the best model performances for TAD boundary prediction. We showed that our optimally built model was able to identify known architectural proteins CTCF, RAD21, SMC3, and ZNF143 as exhibiting high predictive importance, confirming their biological functionality near TAD boundaries. We then aimed to use our optimally built model to more precisely predict the location of TAD boundaries at base pair resolution. We showed that, compared to TAD boundaries identified by a TAD caller, these top ranked transcription factors were much more enriched near the predicted TAD boundaries identified by our model indicating much more precise locations throughout the linear genome. This improved precision in TAD boundary location can provide insight into the role that epigenomics has on the spatial architecture of the human genome.

<!--
Extensive research using high resolution maps (ranging from 750 bp to 1 mb) have probed much of the aspects of 3D chromatin architecture identifying several epigenomic modifications associated with TAD boundaries [@rao20143d; @bonev2017multiscale]. For instance, it is known that the CCCTC-binding factor (CTCF) is enriched at TAD boundaries acting as an insulator interfering with enhancer-promotor interactions [@ghirlando2016ctcf; @song2017ctcf; @ong2014ctcf]. Additional transcription factors including SMC1, SMC3, and RAD21 have also been shown to colocalize near TAD boundaries forming a cohesin ring under the proposed loop extrusion model, whereby loops are formed during interphase [@sanborn2015chromatin; @fudenberg2016formation; @alipour2012self]. 
-->

# Methods

## Genomic annotation and TAD boundary data

Biological replicate Hi-C data were downloaded from GEO GSE63525 [@rao20143d] (Supplementary Table 1) for the GM12878 and K562 cell lines. The autosomal genomic coordinates (GRCh37/hg19 human genome assembly) of TAD boundaries were obtained from data at 10 kb, 25 kb, 50 kb, and 100 kb resolution using the Arrowhead algorithm [@durand2016juicebox]. TAD boundaries called on chromosome 9 were omitted from all downstream analyses, for all resolutions and cell lines, due to the sparsity of the contact matrix at the 10 kb resolution for the K562 cell line. 

Genomic annotation data in the form of cell type specific chromatin states (ChromHMM), histone modifications (HM), and transcription factor binding sites (TFBS) were obtained from the UCSC Genome Browser Database (GRCh37/hg19 human genome assembly) [@Tyner:2017aa] (Supplementary Table 1). 

## Machine learning framework for TAD boundary prediction

To make the data amenable for model training, the genome was binned into equally sized intervals defined by the data resolution of the corresponding contact matrix. As an example, for domain data obtained from a 100 kb resolution contact matrix, the genome was binned into 100 kb intervals. To accommodate for the uncertainty in exact boundary location, the boundary points were flanked on both sides by the size of the resolution of the corresponding contact matrix. A genomic bin was defined as a TAD boundary region ($Y = 1$) if it overlapped with at least one flanked TAD boundary, and a non-TAD boundary region ($Y = 0$) otherwise. Random forest models were used to train on Arrowhead-predicted TAD boundary regions. Training was performed separately for each cell line, data resolution, and chromosome.

Cell line-specific genomic annotations were used to built the predictors for of our random forest models. We created three types of predictors (Figure 1): **Overlap Count (OC)** - the total number of overlaps between a bin and genomic annotation regions;  **Overlap Percent (OP)** - the percent of overlap between the bin and the total width of genomic annotation regions overlapping it; **Log2 Distance** - the $log_{2}$ of the distance in bases (refered to hereafter as *Distance*), from the center of the bin to the center of the nearest genomic annotation region. 

The complete dataset used for modeling was composed of two components: the response vector **Y**, an indicator variable separating between TAD and non-TAD boundary regions, and the predictor-type specific data matrix, **X** = {$X_1$, $X_2$, ..., $X_p$}, where $p$ was the set of predictors. One, or all types of predictors were used as described. The data was split into a 7:3 ratio of training and testing sets.

### Addressing class imbalance

Class imbalance (CI) was defined as the proportion of minority class out of the total number of observations:

$$CI = \dfrac{C_{min}}{C_{min} + C_{maj}}$$

where $C_{min}$ denotes the set of TAD boundary regions and $C_{maj}$ denotes the set non-TAD boundary regions. CI of heavily imbalanced classes approaches 0, while CI for balanced classes approaches 0.50. To assess the effect of CI on predictive performance, we first used the data with **No Sampling**, that is, the majority and minority classes were used as is. We evaluated three re-sampling techniques. For **Random Under-Sampling (RUS)**, the majority class was sampled without replacement to obtain the same number of data points in the minority class. For **Random Over-Sampling (ROS)**, the minority class was sampled with replacement to obtain the same number of data points in the majority class. For **SMOTE** (Synthetic Minority Over-Sampling Technique), under-sampling was performed without replacement from the majority class, while over-sampling was performed by creating new synthetic observations using the $k=5$ minority class nearest neighbors [@chawla2002smote] (implemented in the `DMwR` v.0.4.1 R package). We restricted the algorithm to 100% over-sampling and 200% under-sampling, which creates perfectly balanced classes. 

### Assessment of model performance

Random forest classification models (the `caret` v.6.0 R package [@kuhn2012caret]) were built to compare model performances between combinations of data resolutions, predictor types, and re-sampling techniques. Ten-fold cross validation was used to tune the number of annotations, *p*, to consider at each node. [??? Isn't it used for preventing overfitting? TBD] The number of trees that were aggregated for each random forest model was set to $n=500$. 

The performance of each model was compared using Matthews Correlation Coefficient (MCC), defined as <!--The MCC is, in essence, the correlation coefficient between the observed and predicted binary classifications [@brodersen2010balanced]. A value of 1 represents a perfect prediction, while a value of -1 represents total disagreement between prediction and observation. A value of 0 indicates no better than random prediction. The MCC is defined as-->

<!--
$$F1 - Score = \frac{2TP}{2TP + FP + FN}$$
-->

$$
MCC = \frac{TP \times TN - FP \times FN}{\sqrt{ (TP + FP)(TP+FN)(TN+FP)(TN+FN) }}
$$
<!--
$$Balanced \quad Accuracy = \dfrac{1}{2}\left( \dfrac{TP}{TP+FN} + \dfrac{TN}{TN+FP} \right)$$
-->

<!--
$$Informedness = \dfrac{TP}{TP+FN} + \dfrac{TN}{TN+FP} - 1$$
-->

where TP refers to the number of bins correctly identified as containing a TAD boundary (true positives), FP refers to the number of bins incorrectly identified as containing a TAD boundary (false positives), TN refers to the number of bins correctly identified as not containing a TAD boundary (true negatives), and FN refers to the number of bins incorrectly identified as not containing a TAD boundary (false negatives). Each of these quantities are obtained from the confusion matrix created by validating the model on the testing set. <!--Additional performance metrics including AUROC, accuracy, sensitivity, and specificity were [??? are?] reported in the supplementary materials.-->

### Feature reduction

Many genomic annotations, notably architectural proteins, tend to exhibit an extensive pattern of colocalization (correlation) [@van2014insulator]. To suitably reduce the feature space and prevent overfitting, we implemented recursive feature elimination to estimate the optimal number of necessary features to include in the model. The best performing subset was identified, ranging from 2 to the maximum number of features by powers of 2. We then aggregated the predictive importance of the union of the optimal set of features across chromosomes using the mean decrease in node impurity to determine the most common and top ranked annotations for predicting TAD boundaries. [??? TBD, at which stage it was done]

## Using optimally built random forest classifiers for more precise TAD boundary prediction

Using optimally trained models, we established *predicted TAD boundary regions* as a collection of adjacent bases predicted as TAD boundary with the probability of 1. [??? Do not understand from here:] To guard against inflating the number of predicted TAD boundaries, we clustered the distances between the midpoints of the *predicted TAD boundary regions*. We then performed partitioning around mediods (PAM) to determine the *predicted TAD boundary region* that was most representative of the cluster. The midpoint, in this case a particular basepair, of the *predicted TAD boundary region* identified as the medoid was defined as a final *predicted TAD boundary*. [??? To here. REWRITE!]

# Results

## A resolution-specific approach for predicting TAD boundaries

We analyzed publically available replicate Hi-C data sets from the GM12878 and K562 cell lines (Supplementary Table 1). Topologically associating domains (TADs) were subsequently called using the ARROWHEAD pipeline [@durand2016juicer] at five data resolutions: 5 kb 10 kb, 25 kb, 50 kb, and 100 kb. After removing TADs that exceeded 2 md in length (biologically plausible maximum TAD size [@dixon2012topological; @sofueva2013cohesin]), we obtained a total of 16133, 14824, 8081, 3560, and 919 unique TAD boundaries for the GM12878 cell line, across each of the five resolutions respectively (Table 1). Similar numbers of TAD boundaries were found for the K562 cell line. To account for the variability in boundary location due to varying resolution, we developed a resolution-specific approach toward constructing TAD versus non-TAD boundary regions on the linear genome (See Methods), labeled as a response vector **Y** (Figure 1A). TAD boundary regions were defined as regions on the linear genome where a genomic bin overlapped with a flanked TAD boundary ($Y = 1$), while non-TAD boundary regions were defined as the regions that did not overlap with a flanked TAD boundary ($Y = 0$). On average, we found that only $18.0 \pm 4.6 \%$ of TAD boundary regions overlapped between both cell lines. Given the cell type specificity of TAD boundaries, we opted to build cell line specific models for predicting TAD boundary regions. The results presented are for the GM12878 cell line, with K562 results presented in the Supplementary material. In summary, we developed a framework enabling resolution-specific prediction of TAD boundaries, with resolution-specific bins defining the response variable.

| Resolution | Total number of called TADs | Total number of unique TAD boundaries | Average Class Imbalance ($\pm$ SD) |
|:----------:|:---------------------------:|:-------------------------------------:|:----------------------------------:|
|5 kb        |8043 (4750)                  | 16133 (9314)                          | 0.06 $\pm$ 0.02 (0.04 $\pm$ 0.02)  |
|10 kb	     |7650 (5796) 	               | 14824 (10881)                         | 0.10 $\pm$ 0.01 (0.08 $\pm$ 0.02)  |
|25 kb	     |4208 (3675)                  | 8081 (6923)                           | 0.14 $\pm$ 0.01 (0.12 $\pm$ 0.01)  |   
|50 kb	     |1772 (1617)	                 | 3560	(3197)                           | 0.12 $\pm$ 0.01 (0.11 $\pm$ 0.01)  |
|100 kb	     |444	(399)                    | 919	(831)                            | 0.06 $\pm$ 0.01 (0.06 $\pm$ 0.01)  |    
Table: Domain data and class imbalance summaries across resolutions for GM12878 (K562).

## Three types of predictors define the associations between TAD boundary regions and genomic annotations

A total of 78 cell type specific functional genomic annotations for the GM12878 and K562 cell line were used to build the feature space of downstream predictive models (Supplementary Table 1). The annotations could be broken down into three sets including histone modifications (HM), chromatin state segmentations (ChromHMM), and transcription factor binding sites (TFBS). We constructed three different predictor types for each functional genomic annotation (Figure 1B). Counts of overlaps (**overlap count**, OC) were defined as the total number of genomic annotation regions that overlapped within a given genomic bin. Percents of overlaps (**overlap percent**, OP) were defined as the proportion of a bin overlapped by an annotation region. **Distance** was defined as log2 transformed number of base pairs between between the centers of bins and regions defining genomic annotations. A log2-transformation of distance was used to account for the skewness present in the distributions of distances (Supplementary Figure 1). These feature engineering steps were performed to improve TAD boundary predictions by accounting for direct (OC), proportional (OP), and indirect (distance) relationships between TAD boundaries and genomic annotations.

![**Illustrating the resolution-specific data construction and feature engineering used for downstream modeling.** (A) Unique boundaries are denoted by the blue dots. The yellow regions denote the flanked boundary regions according to the Hi-C data resolution (i.e., 100 kb resolution corresponded to a 100 kb flank for a total boundary region of 200 kb). The linear genome was subsequently binned into resolution-specific intervals. The response vector **Y** was defined as a genomic bin that either overlapped with a flanked TAD boundary ($Y = 1$) or did not ($Y = 0$). (B) Three types of associations between bins and genomic annotations (green shapes) used to build the feature space include _Overlap Counts_ (OC), _Overlap Percent_ (OP), and ($log_{2}$) _Distance_. ](Figures/model_construction_and_predictor_types.png)

## TAD vs. non-TAD boundary class imbalance is severe irrespectively of Hi-C data resolution 

Given that the number of bins annotated as TAD boundaries (TAD boundary regions) is much smaller than the number of non-TAD boundary bins, we investigated the class imbalance (CI) featured at each resolution. The CI was defined as the ratio of TAD boundary regions ($Y=1$) versus the sum of both TAD and non-TAD boundary regions and ranging from 0 to 0.50. The CI was found to be invariant to resolution, remaining consistently low across chromosomes, with an averages of 0.06, 0.10, 0.14, 0.12, and 0.06 across each resolutions for GM12878 (Table 1). Similar class imbalances were found for the K562 cell line. To account for such imbalance, we evaluated three re-sampling techniques (in addition to no re-sampling) before predicting TAD boundaries. **Random over-sampling** (ROS) was defined as sampling with replacement from TAD boundary regions. **Random under-sampling** (RUS) was defined as sampling with replacement from non-TAD boundary regions. Lastly, we considered **Synthetic minority over-sampling technique** (SMOTE), which is a combination of both random over- and under-sampling [@chawla2002smote]. 

## Ensemble framework for TAD boundary prediction

To identify the combination of data resolution, predictor type, and re-sampling technique necessary for optimal cell line specific TAD boundary prediction, we created an ensemble framework to systematically compare performances of different model inputs (Figure 2). The framework uses data for a particular cell line *L = {GM12878, K562}*, at a given resolution *R = {5 kb, 10 kb, 25 kb, 50 kb, 100 kb}*, using one of the predictor type *P = {OC, OP, Distance}*, and the re-sampling technique *B = {None, RUS, ROS, SMOTE}*. Once the model inputs were established, a random forest classifier was trained on chromosome-specific datasets using 10-fold cross validation. The different combinations of inputs were evaluated by assessing the Matthews Correlation Coefficient (MCC) of each model. Letting $|X|$ denote the cardinality of each set, we evaluated $|L| \times |R| \times |P| \times |B|$ different ensemble systems, totaling $2 \times 5 \times 3 \times 4 \times 21 = 2520$) models. <!--Additional performance metrics are reported in the Supplementary materials.-->

![**A diagram of the ensemble framework detailing the combination of inputs used in the model building pipeline.** Each cell line (GM12878, K562) specific model was composed of a combination of different data level characteristics including resolution (5 kb, 10 kb, 25 kb, 50 kb, 100 kb), predictor type (overlap count (OC), overlap percent (OP), $log_{2}$ distance (Distance)), and re-sampling technique (no re-sampling (None), random over-sampling (ROS), random under-sampling (RUS), synthetic minority over-sampling technique (SMOTE)). The three types of genomic annotations, histone modification (HM), chromating state segmentations (ChromHMM), transcription factor binding sites (TFBS), were used as predictors.](Figures/figure3_ensemble_framework_V3.png)

## SMOTE re-sampling, distance-based associations of TAD boundaries and genomic annotations, and 10 kb resolutions of Hi-C data provided optimal model performance

We investigated the effect of class imbalance on model performance using three re-sampling techniques. Expectedly, when using data as-is, that is, with class imbalance present, the models performed poorly. Using any of the resampling techniques improved the performance, with SMOTE-resampled data being the most optimal (Figure 3, Supplementary Figure 2). These results suggest that a combination of both random over- and under-sampling (SMOTE) can improve TAD boundary prediction.

We found that, regardless of resampling technique, random forest classifiers built using a distance-type feature space yielded consistently higher MCCs when compared to the overlap count and overlap percent predictor types (Figure 3), and these results were consistent across resolutions and cell types (Supplementary Figure 2). This indicated that models are better able to discriminate between TAD and non-TAD boundary regions when provided with spatially related associations.

Interestingly, we found that performances peaked at 10 kb resolution and then degraded as data resolution decreased. The reason for the improved performance between 5 kb and 10 kb data resolutions can be due to the sparsity in the interaction frequency matrices at finer resolutions. [??? Quantify sparsity] This sparsity may lead to inaccurate TAD calling and, subsequently, to worse model performance. These results suggest that finer resolution of Hi-C data is not always optimal for accurate TAD calling and prediction, and sparsity of the data needs to be considered. Additionally, performances tended to be much more variable between chromosomes at lower resolutions, evidenced by the wider error bars for the 50 kb and 100 kb resolutions. In summary, our results imply that using random under- and over-sampling, distance-type predictors, and the data at 10kb resolution results in an optimally performing cell line-specific random forest-based TAD boundary prediction model.

![**Models built using distance-type predictors combined with SMOTE re-sampling yielded optimal MCCs across resolution.** Barplots comparing the performances of random forest classifiers built using different combinations of data level characteristics. Within each re-sampling technique (A-D), performances are compared for each type of feature space: OC (red), OP (green), and Distance (blue), across resolutions. Performances were evaluated using MCCs and aggregated by averaging across each chromosome, with error bars representing 1 standard deviation away from the mean.](Figures/model_performances_v3_bars.png)

## Transcription factor binding sites outperform other annotation-specific models

We then aimed to compare the performances of annotation-specifc models. In doing so, we inspected the proportion of predictive importance that was explained by each of the three groups of genomic annotations (histone modifications (HM), chromatin states (ChromHMM), and transcription factor binding sites (TFBS)). For optimal random forest classifiers, we found that the majority of the proportional predictive importance was obtained by transcription factor binding sites (Supplementary Figure 3). Furthermore, models build solely on TFBSs outperformed other annotation-specific models at all resolutions (Figure 4A; Supplementary Figure 4A). Notably, the TFBS-specific models outperformed models built on the combined sets of annotations, and this effect was most pronounced at lower resolutions. This indicated that the inclusion of other types of annotations contributed to additional noise rather than signal in TAD boundary prediction. In summary, these results suggest that TFBS are the primary drivers of TAD boundary formation in both the GM12878 and K562 cell lines.

## Predictive importances confirmed biological functionality of CTCF, RAD21, SMC3, and ZNF143 at TAD boundaries

Given that many TFBS are known to colocalize together on the linear genome and are therefore highly correlated, we sought to avoid overfitting by performing recursive feature elimination. We found that our models were able to obtain near-optimal performance using approximately eight TFBSs (Figure 4B; Supplementary Figure 4B). However, given that we train our models on chromosome-specific data, the most significant annotations vary for each chromosome. To determine the most common TFBSs, we clustered the predictive importance values across chromosomes (Figure 4C; Supplementary Figure 4C). We found that, similar to other studies [@sanborn2015chromatin; @fudenberg2016formation; @alipour2012self; @weintraub2017yy1; @gonzalez2017znf143], CTCF, RAD21, SMC3, and ZNF143 transcription factors were most predictive of TAD boundary regions. 

![**Assessing top ranked transcription factors in TAD boundary prediction.** (A) Barplots comparing performances of models using specific groups of functional genomic annotation as the feature space including histone modifications (HM; red), chromatin states (ChromHMM; green), transcription factor binding sites (TFBS; blue), in addition to a model with a feature space containing all three groups (Combined; purple). (B) Recursive feature elimination analysis used to reduce the number of TFBS to include in the optimally build random forest classifier. (C) Clustered heatmap of predictive importances for the union of the top 8 most predictive TFBS across chromosomes. Error bars represent standard deviation from the mean MCC across each chromosome.](Figures/annot_specific_rfe_varimps_heatmap.png)


## Predictive modeling defines precise and biologically relevant location of TAD boundaries

After obtaining our optimally built random forest classifier, we investigated whether our predictive models can alleviate resolution limitations of Hi-C data by predicting TAD boundaries at base pair resolution. We were able to identify regions where the model predicted the base pair to be a TAD boundary with probability equal to 1 (Figure 5A). [??? Where is this figure? It seemed important; !!!added] By clustering the regions (see Methods), we were able to predict a comparable number of TAD boundary regions as called by the ARROWHEAD TAD caller. However, only 24% and 29% of predicted and called (and 10 kb flanked) TAD boundaries overlapped for the GM12878 and K562 cell line, respectively, suggesting differing locations in TAD boundaries throughout the linear genome (Supplementary Figure 5). [??? Need further drill down, as we discussed; !!!added distance to annotations figure in next paragraph] 

For each predicted TAD boundary region, we were able to identify the summit locations of TAD boundary location by performing partitioning around medoids (see Methods). To compare the summit locations of predicted and called TAD boundaries, we evaluated the signal strength of ChIP-seq peak regions around a 10 kb flanking region. We found that the signal strength for the CTCF, RAD21, SMC3, and ZNF143 [??? Make all in this order!; !!!fixed] TFBS peaked at our predicted TAD boudaries, while was poorly defined around the called TAD boundaries (Figure 5B; Supplementary Figure 6).  Thus, our model is able to alleviate resolution limitations and precisely locate TAD boundaries that correspond to the highest signal strength of known TAD boundary-forming TFBSs. Furthermore, when compared to called TAD boundaries, the boundaries that we predicted with our model were found to be statistically significantly closer to the top ranked TFBS, suggesting stronger enrichment profiles near predicted TAD boundaries (Supplementary Figure 7).

ChIP-seq assays offer much higher resolutions (often in the tens of bases) compared to Hi-C sequenced data, which can be in the hundreds of kilobases. This disparity in resolution can affect a TAD caller's ability to precisely locate TADs.[??? This is for the introduction, justifying motives for your work]

![**Predicted TAD boundaries are enriched in known TAD boundary-forming TFBSs.** (A) Visualizing locations of predicted and called TAD boundaries (chr 22: 17390000-18640000; GM12878). The upper triangular contact map shows the normalized number of contacts within the specified window using the JUICER toolbox.  Called TADs are outlined in blue.  The blue vertical lines represent a called TAD boundary identified by the ARROWHEAD algorithm. The black line represents the predicted probability of each base pair being a TAD boundary. Regions of adjacent base pairs with probability of 1 are represented by the green regions along the x-axis. The green vertical lines represent the subsequent base pair predicted to be a TAD boundary using medoid partitioning. (B) Enrichment heatmaps illustrate the average signal strength of ChIP-seq peak regions defined by SMC3, ZNF143, CTCF, and RAD21 around the centers of 10 kb flanked predicted and called TAD boundaries.](Figures/visualizing_boundaries_example_with_enriched_heatmaps.png) 

# DISCUSSION

In this study we developed an ensemble framework to systematically compare model performances for different combinations of re-sampling and feature engineering techniques aimed at determining a consensus approach to predicting TAD boundary formation using genomic annotations. We provide direct comparisons of cell line specific random forest models built on a variety of different data dependent characteristics, including 4 contact matrix resolutions ($\{\textit{10 kb}, \textit{25 kb}, \textit{50 kb}, \textit{100 kb\}}$), 3 predictor-types ($\{\textit{OC}, \textit{OP}, \textit{Distance}\}$), and 4 re-sampling techniques ($\{\textit{None}, \textit{RUS}, \textit{ROS}, \textit{SMOTE}\}$), for both the GM12878 and K562 cell lines. [??? Learn Markdown] [??? What's the summary of your work?]

The experiments derived from our ensemble framework provide a useful guide toward the exploration of chromatin organization, while highlighting the impact of both class imbalance and feature engineering in TAD boundary prediction. Using the framework we demonstrated that random forest models built on imbalanced data exhibited poor performance, regardless of cell line, resolution, or predictor type. In our framework, [??? Too much "framework" mentioning] we opted to leave the test set as a completely untouched holdout set, only performing the re-sampling, and subsequent learning, on the training set. This was done so as to incur the least amount of bias and so that all conclusions could be made soley between model characteristics. As a result, we showed that Matthews Correlation Coefficient was much more sensitive to the imbalance present in the test set, compared to more popular metrics like AUROC, which attain artificially high values by correctly predicting majority class samples [??? I don't see results for it]. When comparing re-sampling techniques, we found that SMOTE re-sampling outperformed models built on both simple ROS or RUS, implying that, in fact, a combination of both random under-sampling and random over-sampling is preferred in TAD boundary prediction. Furthermore, the most improvement [??? In what?] was seen when combining SMOTE resampling on distance-type features when building random forest classifiers. These two characteristics exhibited consistently better performance results across both the GM12878 and K562 cell lines. This confirmed our hypothesis that the most granular and spatially informative representation of the relationship between TAD boundaries and annotations resulted in the best performing model.

When applying SMOTE re-sampling, with distance-type predictors, on transcription factor binding sites alone, we found that random forest classifiers performed better when compared to other annotation-specific models, including histone modifications and chromatin state segmentations. Likewise the performance of TFBS specific models was comparable to models with all annotations combined, across both cell line and resolution. This suggests that the majority of the key molecular drivers aiding in the formation of TAD boundaryies are transctiption factors, and that modifications at histone tails such as acetylation or methylation play less of a role.

We also observed that, while the best set of data characteristics were consistent across resolutions, performances of classifiers built on said characteristics tended to decline as resolution decreased. For both cell lines, top performance was achieved at the 10 kb data resolution, while the worst performance was obtained at the 50 kb and 100 kb resolution for the GM12878 and K562 cell line respectively. This suggests that TAD boundary prediction is intimately related to the resolution that boundaries are called on. This result can be attributed to one of two factors in the scheme of our framework. First, at higher resolutions, by model construction genomic bins were smaller, thereby resulting in more accurate profiles for the genomic annotations [?? Don't understand this sentence ??]. Secondly, because we are mainly concerned with TAD boundaries, and not the hierarchical structure of domains as a whole, the sparsity of contact matrices at higher resolutions does not impair boundary prediction [?? Doesn't this contradict your results about low resolution causing worse boundary prediction ??]. Conversely, lower resolutions imply larger bin windows and lead to less specificity in boundary location on the linear genome, resulting in worse performances. Given the trend in performances across resolution, future research is necessary in determining the optimal resolution to use when predicting TAD boundaries [?? Might want to qualify the statement in results about 10kb data being best by saying that it only applies to your data ??]. [??? This paragraph is a mess]

Given the formulation of our framework, we were not able to make direct comparisons between cell lines. This was due to the fact that we opted to use cell line specific annotations, and there existed some annotations that were available on the K562 cell line that were not available to GM12878, and vice versa. [??? Did they provide additional advantage?] However, we were able to confirm that final models built on the optimal set of data characteristics identified consistent and well known proteins related to the 3D structure of chromatin, for both cell lines. Our results indicated that the zinc finger protein CTCF, as well components of the cohesin complex, SMC3 and RAD21, were found to be the key molecular drivers most predictive of TAD boundary formation, consistent across cell line and resolution. In addition, models derived from our framework recognized known mediaters of long range enhancer-promoter interactions, the ZNF143 and YY1 transcription factors, as being highly predictive of TAD boundaries. 

In summary, we have shown that TAD boundary prediction is a multi-faceted problem composed of many data irregularities and characteristics that previous model have failed to address. We have shown that our proposed framework suitably addresses each of these components, while also providing the optimal considerations to make in an effort to build consensus classifiers used to predict TAD boundary formation [?? formation or location. Formation implies some temporal element ??] from functional genomic annotations. Given the stability of our results, this opens up the possibility of widening our framework to include a broader set of classifiers, cell lines, and Hi-C contact matix resolutions that will inevitably assist us in gaining a better understanding of the mechanisms associated with the architecture of the human genome.

# Supplementary Legends

**Supplementary Table 1. Hi-C and genomic annotation data.** (A) A complete list of the Hi-C data libraries used to obtain the locations of topologically associating domains. (B) A complete list of the cell line specific genomic annotations used to build the feature space for all downstream models. The GRCh37/hg19 human genome assembly was used. "Genomic Class" - broad category of genomic features, "Element" - names of genomic annotations, "Cell Type-Specific Source" - download URL specific to the cell line (not all annotations were provided by the same institutions). 

**Supplementary Figure 1. Performing $log_{2}$ transformations normalizes skewed distance densities across resolution.** When measured in basepairs, distances were highly right skewed (red lines) across all resolutions for both the GM12878 (A) and K562 (B) cell lines. After $log_{2}$ transforming the distances (blue lines), densities became much more gaussian distributed for all resolutions. 

**Supplementary Figure 2. Models built using distance-type predictors combined with SMOTE re-sampling yielded optimal MCCs across resolution on K562.** Barplots comparing the performances of random forest classifiers built using different combinations of data level characteristics for K562. Within each re-sampling technique (A-D), performances are compared for each type of feature space: OC (red), OP (green), and Distance (blue), across resolutions. Performances were evaluated using MCCs and aggregated by averaging across each chromosome, with error bars representing 1 standard deviation away from the mean.

**Supplementary Figure 3. The proportional importance of optimally built cell line specific models was outweighed by transcription factor binding sites across resolutions.** Stacked barplots illustrate the proportion of total predictive importance in cell line specific random forest classifiers for (A) GM12878 and (B) K562 respectively. Model inputs included the optimal data level characteristics determined by the ensemble framework (SMOTE re-sampling; with distance-type predictors). Predictive importance was averaged for models built on chromosome specific regions of the linear genome. Proportional importance was then calculated according to the annotation group of the feature space including histone modifications (HM), chromatin state segmentations (ChromHMM), and transcription factor binding sites (TFBS).

**Supplementary Figure 4. Assessing top ranked transcription factors in TAD boundary prediction for K562.** (A) Barplots comparing performances of models using K562-specific groups of functional genomic annotation as the feature space including histone modifications (HM; red), chromatin states (ChromHMM; green), transcription factor binding sites (TFBS; blue), in addition to a model with a feature space containing all 3 groups (Combined; purple). Error bars represent Â± 1 standard deviation from the mean MCC across each chromosomal section of the linear genome. (B) Recursive feature elimination analysis used to reduce the number of TFBS to include in the optimally build random forest classifier. Error bars represent 1 standard deviation away from the mean cross-validated MCC. (C) Clustered heatmap of predictive importance for the union of the top 8 most predictive TFBS across chromosomes.

**Supplementary Figure 5. Venn diagrams illustrating the amount of overlap between predicted and called TAD boundary regions.** For each of the GM12878 (A) and K562 (B), both predicted and called TAD boundaries were flanked other either side by 10 kb and the amount of overlap was enumerated.

**Supplementary Figure 6. Predicted TAD boundaries were centered closer to peak signal regions defined by known architectural transcription factors when compared to called TAD boundaries for K562.** Enrichment
heatmaps illustrate the average signal strength of K562-specific ChIP-seq peak regions defined by (A) SMC3, (B) ZNF143, (C) CTCF, and (D) RAD21 around the centers of 10 kb flanked predicted and called TAD boundaries.

**Supplementary Figure 7. Known architectural transcription factors were statistically significantly closer to predicted TAD boundaries then called TAD boundaries.** Barplots illustrate the log2 distance in basepairs from classes of TAD boundaries to transcription factors including CTCF, RAD21, SMC3, and ZNF143 for the GM12878 (A) and K562 (B) cell lines. TAD boundaries were classified into the 3 classes. Predicted but not called (PBNC) were the set of 10 kb flanked predicted TAD boundaries the did not overlap with 10 kb flanked called TAD boundaries. Called and predicted (CAP) were the set of 10 kb flanked called and predicted TAD boundaries that overlapped with each other. Called but not predicted (CBNP) were the set of 10 kb flanked called TAD boundaries that did not overlap with 10 kb flanked predicted TAD boundaries.


# Abbreviations


# Acknowledgements

_Conflict of Interest._ None.

# Funding

# References
